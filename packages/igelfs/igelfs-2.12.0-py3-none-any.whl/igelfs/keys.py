"""RSA public keys for signature verification."""

import tempfile

import rsa

from igelfs.utils import run_process

# OS 12 First Party Apps
OS12_APP_PUBLIC_KEY = rsa.PublicKey(
    n=0xC944BC09AF01A7E3D637FAF2F2EC63FC5569918B9BB32FE933BBC396BCF62BEA469D90358AF5A5BA574D9EFB636009ECAFB437FA1FF740801BD4C6F6CDA153C954FFB8CD4A4872E849E7BC7A19EC9052646F73E0F8A886074A5B545A74513119B7712675F6D5F1E0A8BAD9026AE520B7F21F53475BDFD15C68787708E187962B169DD502B4F6B27E744294EEB87CA71A2261C0110BCA9840B2EB2B4825E066F33BB3B3F4E34F36FDB64F9931A419734A3D21A19CAF01A2D3D4E9DE53F0E09C3A830B7EBE7210D11367F7F317B1B148DB633DDD74F371C0E4E0C11F04520F973C5A0E28B94515BD9E3490C7F212A0E78606D35449E28E3925DF437F105B0EB7F7B30DC59EE2ADD5D41C663D62AF80F15F2CF0425E791B85F137B7E15DC11C4DA6CB0E5986A61C589B760387ABB1058D308C85C49DDA375B0DE32E7D86B0B9CD30EC73E93AC77ACF0F73DFDE7A5114A4E14D8C0979BB24EFF821E27738AFB46EF13964A31879CC4DFB65496BE7B5235305CFF08DCD3EBA04CF60BFA49550E57B8A7C687BED254882D5328CB0B97C4B3F8366D6B4B53D2FB514AB454A672250D805E560B1A82AFF935ACBE82B2AD7A3707F66A9458FC10B2108C4DD77D3A78D6010E31535C4C27E0111ED6976E7402877E21E7B105DF85B7E2B2335D7319BDE4A01B924E43C152F3D021DFBD51B187A3F71955297CB748160E43D23BF5DAB33D7C1,
    e=0x010001,
)

# OS 12 Third Party Apps
OS12_THIRD_PARTY_PUBLIC_KEY = rsa.PublicKey(
    n=0x8416BC0FB1F0DB9CBC95BBA805646581B1383336044D24668406C46BE2457FFE06D5BA7F1D3C529DF05B446504E304A826076C8AAC3610D12599EE33683EC0D301309737B166AF73A628E3FCCAFBB49E4B9CCCC99770434C14CB66BB37302A3CFBD2C4C511AC06B69769F445DD18427BF075D501E39F14D82E6E309033AE68BE9A64016EC1B5C9DFBB7EB4D2B88DBAB7B5CBF2D68C1E5B1227A493BE871BEB1F77596252D699B7A905A0926771545E5413388AC30FE358EE84A48F578D7B0B1C4B30328EF44BA4C5C25F895AC9194AD86ADAFEBA5E8ADCEF4D1BD2F34B142816DEB147ECC258591238233FB43BB881D30E9FBA20A4CD6DCEE25B4E71FDE93B1200E4DEB0B42BB1643C698F4C22AD79A5413B202C68107D3E8A887D617CDFB551817F5B60D362A3BD01AF1B12E372D85379823B76BAA5EDBDF76A896765242BBAEA9584B54FC62ED3109EE3669131045BC998AE72E38008ADC94758FA277A127BD9AAC6AB851785D2F1CE0800FAA9A2CB6D3866CFAD47BD796354561DA01C38AD18607A1558072B756A52BBEC735FE7D1DCE22925BDD7EEF28B4A6C43E9B5938A641111A6BA5FEFDA4DC5E1D457AFCAC6B44054C3F0C626ECBA2DD3A0579875A92954F22F7D486921485D77647E685CB7D6A0F0540513C5ECF8A2E15F69610680EAE2DD7D2487F202AF9B726F06DC3599E9BD22511BA2E172AEE43BE1EF4557AD,
    e=0x010001,
)

# OS 12 Base System
OS12_BASE_PUBLIC_KEY = rsa.PublicKey(
    n=0x91FC6001CF64F48D8D0B1EF2CCCD4F9453DFAC4A7F94528F870A449357458806E75315B8F47730985188B35F41AD02543BA77A9C2F99FCFDBCD79EAA54547A4262204A49C3C7C453EF431E8367EEE6E7D2A2D4583C0FF49E776774DD1F0CA7906B2CD3A9AEF6062496B7368B0C55DE32974E623AE109FC0E8C4C8C241B26312382DEC0F5A794C4272ED762FE48785DA7FE74BC4FF9C880F4BEAACCF6A9B550E73D9CA699E67D89009A1DF3911A6F1D9266835AD78CDC9EF6984949DF0F012B1C72C73AB93807AF636BED2A6E92D3944DF22BC8A01ED1BA3B7123115DC6AB07C2921B2FCF63A40972EFF644B90431D92CC3D473B913CAB738E0BE871D736C1B9B3B7218F30B0D2717C0E893DB5B5AB3E788927619F199E004D7FBAAA183C586E9CBECA416CAB2B2132CE0CB7DA6585D107E4E4C2749AD7648669CA21D0B9D089EEC0CC421E841576DC9EC9D07EE7774A9CC42930F022E4128A1751466D2F20CCA129337455AE3F1BB33A0F512409E78B68B6438A0FC290DC019958C5909972E869D50C1565CFB6B69E43F22901856E113DA39A1C7135799B63A824BCB61B3509DB88D2FE85CEAA6683DB3A3E1170315C0F90E205CE44AE4AE79C0E4349F497449451351971FB35DFD9DC6272838CCB56DB75A14EF1ACFF97401DBDF47932559718FD982B9F0E5A0697D6240DB005DECE60E7A19158AD33362543A45C2FFDE5225,
    e=0x010001,
)

# OS 12 SDK Partner Apps
OS12_SDK_PUBLIC_KEY = rsa.PublicKey(
    n=0xE3562E61F278DBF27B76434AA6632C119D02261191D0A082F223CB23A529073555CE9602AD327ABA6EF93E46B7BC78B884C6F466C7EC35B141EDAC2EAE4E06967816F3CF1CE53E7DB69E3F932770F028B8B14870A74AF0127F9E1CA20F8FA952CFC1DF8DA8A396A6346554F9C8DE76CF44A1173377A93366CD0E11915B4BC2197CA8A31C40AD112BF93CB4E3853B7A240A0A50A61D1F807C1EBA2B34EFD126127D129D32BC41EE0F0621EF7392AF0226A91BD381A53990BFB49E7BDBBDE7E37CE77DD450A86FDEA1316D6903016C15D4161590DFC9354C04208076C5EF0702D717245BEFC7C0A43FDD894319BC57D20C29BC19ECB820310378848B43E16307CD7B75630F9629EF47140FE4ACEA4A2236EC3FE106CB485EE0521F90D883CB5187F1B132E1E2EC8B63D4E9B944F94A0064D9787852A9AE0B001AF3F51A5B7C6B5BBB6769300C59B83A3636F7104129AB279C3CDECD92FA5EA487BAAA911D7FDAD8D0C9870E3D2B0147F58152147851AED7C46D19AEE8C42C5F8D214002166ED717E1C14EB716962A844F567CD35116F4CFDA869D3C2F509D411CEE9B3D040160A0F8A8A9DFAEA21166C4266265C092C71D85D08E0A8EF8EDF857B17D79CA82D1C09D0441BC061FBD6EF5237FF49A5CBAB401D5F1C6AB50CEB0180E6482B0B0758AEF2E03A458081D552F87C33E15339040CD552A04FB94C3F6CFCFFB504F910715,
    e=0x010001,
)

# OS 11
HSM_PUBLIC_KEY = rsa.PublicKey(
    n=0xC297056539F4E2D0D0BA205965D5C9F49F836E8E83E560A6D43ED45720FAB2D0BA383B3BBEFD9EACA76ADFC7B5948D884DAB29333C5D0665098DC1F82BE50D5B874F3B664D895C7DF5ECAC7C099A76B9CB635928E4CD94D8052E95EDADAF7E5484ADB16465A661B4C0CBA79FFDC343C92A536A4940FE39EDEEF4A87C3E37D8E26227FDD031783698E8B996759E31A5B87E9DB9A7AEDFEAE24FDCD5C91E0799544859DBDEC3252B5C574A581A0BBFA950BF89FBED14C53318C0C962192C7B37C3CCC39C5E26F811BEE69B5A29A5A58D0D2636F1ADF8AEB4F3DA57278DE0FE62AAE39393DCFD3AA3B638AE0DB82E279F93A5A2D47CBEA6ED0D76918A82C2116535,
    e=0x010001,
)

# Test Key
TEST_PUBLIC_KEY = rsa.PublicKey(
    n=0xDEF3B906C78355F5E643AE4BA9C9BB51BFC4BCB7F7B2F392EDCBF20169EDFC659B3EB16F10902920D7BA67CAE90C90AE334031319EA8F5BCCBE28577CBA7C67DA14F9AF9C4310F50AE9F38A9C8EF0B3149EE6196FA69D46B208674EE7A3A0AD6D3F57C38F620F0808D7D91C13013A25B429FEE9111965527A36926953E9687ED84E57125A51525AE40DDEC4F7CCF0FDAAC144227CD4D7399E913F8875963141AA6134E9F704E7A846586284FCAF8CFD6097D4E4B153C04E55332508A5B7E01C3DF5AE1EE1C7B30F3375C86027BF7FC4F0B25E215B1C5890C0106D6A675E74CCF88740227D7F1E9FCCF2492AA955661F7C609F3429AF440DBD8264ADCBECAB013,
    e=0x010001,
)

IGEL_PUBLIC_KEYS = [
    OS12_APP_PUBLIC_KEY,
    OS12_THIRD_PARTY_PUBLIC_KEY,
    OS12_BASE_PUBLIC_KEY,
    OS12_SDK_PUBLIC_KEY,
    HSM_PUBLIC_KEY,
    TEST_PUBLIC_KEY,
]


def get_modulus_from_key(data: bytes | list[int]) -> int:
    """Get modulus for public RSA key from bytes."""
    if isinstance(data, list):
        data = bytes(data)
    with tempfile.NamedTemporaryFile(delete_on_close=False) as fd:
        fd.write(data)
        fd.close()
        return int(
            run_process(
                ["openssl", "rsa", "-in", fd.name, "-pubin", "-modulus", "-noout"]
            ).split("=")[1],
            16,
        )
