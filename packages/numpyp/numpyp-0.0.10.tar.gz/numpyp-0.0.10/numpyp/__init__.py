# numpyp/__init__.py

import os
from dotenv import load_dotenv

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–ª–∞—Å—Å
from .telegram_handler import _TelegramHandler

# --- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram ---

# –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–¥—É–ª—è, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä.
# –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –æ–Ω–∞ –ø—É—Å—Ç–∞—è.
_telegram_instance: _TelegramHandler | None = None


def _auto_initialize_if_needed():
    """
    –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è "–º–∞–≥–∏—á–µ—Å–∫–∞—è" —Ñ—É–Ω–∫—Ü–∏—è.
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –±—ã–ª –ª–∏ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–¥—É–ª—å. –ï—Å–ª–∏ –Ω–µ—Ç - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –µ–≥–æ,
    –∑–∞–≥—Ä—É–∂–∞—è –¥–∞–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞.
    """
    global _telegram_instance
    # –ï—Å–ª–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º.
    if _telegram_instance:
        return

    print("üîß –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ –≤—ã–∑–æ–≤–∞ Telegram-—Ñ—É–Ω–∫—Ü–∏–∏. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞...")

    # –ò—â–µ–º –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º .env —Ñ–∞–π–ª –∏–∑ –ø–∞–ø–∫–∏, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω –≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
    # find_dotenv() –Ω–∞–π–¥–µ—Ç .env –ø–æ–¥–Ω–∏–º–∞—è—Å—å –ø–æ –ø–∞–ø–∫–∞–º –≤–≤–µ—Ä—Ö
    from dotenv import find_dotenv
    dotenv_path = find_dotenv()

    if not dotenv_path:
        raise FileNotFoundError(
            "–ù–µ –Ω–∞–π–¥–µ–Ω .env —Ñ–∞–π–ª! –°–æ–∑–¥–∞–π—Ç–µ .env —Ä—è–¥–æ–º —Å –≤–∞—à–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ –≤ –Ω–µ–≥–æ TELEGRAM_TOKEN –∏ TELEGRAM_CHAT_ID.")

    load_dotenv(dotenv_path)

    token = os.getenv("TELEGRAM_TOKEN")
    chat_id = os.getenv("TELEGRAM_CHAT_ID")

    if not token or not chat_id:
        raise ValueError("TELEGRAM_TOKEN –∏–ª–∏ TELEGRAM_CHAT_ID –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ .env —Ñ–∞–π–ª–µ.")

    # –°–æ–∑–¥–∞–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
    _telegram_instance = _TelegramHandler(token=token, chat_id=chat_id)
    print("‚úÖ Telegram —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏–∑ .env —Ñ–∞–π–ª–∞.")


def call(text: str):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ .env —Ñ–∞–π–ª—É Telegram-—á–∞—Ç.
    """
    # –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–∞–º–∞ –≤—ã–∑–æ–≤–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
    _auto_initialize_if_needed()
    _telegram_instance.send_message(text)


def ans():
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≤—ã–≤–æ–¥–∏—Ç –µ–≥–æ –≤ –∫–æ–Ω—Å–æ–ª—å.
    """
    # –ò —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–∞–º–∞ –≤—ã–∑–æ–≤–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É, –µ—Å–ª–∏ call() –Ω–µ –≤—ã–∑—ã–≤–∞–ª—Å—è –ø–µ—Ä–≤—ã–º
    _auto_initialize_if_needed()

    reply = _telegram_instance.check_for_reply()

    if reply:
        print(f"–û—Ç–≤–µ—Ç: {reply}")
    else:
        print("–û—Ç–≤–µ—Ç–∞ –ø–æ–∫–∞ –Ω–µ—Ç.")