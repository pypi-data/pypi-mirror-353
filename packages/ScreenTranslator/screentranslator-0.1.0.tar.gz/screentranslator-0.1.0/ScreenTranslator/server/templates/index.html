<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>ScreenTranslator</title>
    <!-- Inline Manifest (No Icons) -->
    <script type="application/json" id="manifest">
        {
            "name": "ScreenTranslator",
            "short_name": "Medipy",
            "description": "Text recognition and translation for images and videos",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#3498db",
            "scope": "/translator"
        }
    </script>
    <script>
        // Inline Manifest Injection
        const manifestEl = document.getElementById('manifest');
        if (manifestEl) {
            const manifestLink = document.createElement('link');
            manifestLink.rel = 'manifest';
            manifestLink.href = 'data:application/json,' + encodeURIComponent(manifestEl.textContent);
            document.head.appendChild(manifestLink);
        }
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <header>
        <h1>ScreenTranslator</h1>
        <p>Upload an image or video for text recognition and translation</p>
    </header>

    <main class="container">
        <div class="button-group-container">
            <div class="button-group">
                <button type="button" id="apidocs-btn">API documentation</button>
                <button type="button" id="upload-btn">Upload file</button>
                <button type="button" id="process-btn" disabled>Process</button>
                <button type="button" id="save-btn" disabled>Save</button>
            </div>
            <div id="status" class="status" role="status" aria-live="polite">Status will be shown here.</div>
        </div>

        <details class="params-section">
            <summary>Processing settings</summary>
            <form id="params-form">
                <table class="params-table">
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><label for="size">size</label></td>
                        <td><input type="number" id="size" name="size" value="1500" min="256" max="4096"></td>
                        <td class="help-text">Inference image size          (256 - 4096)</td>
                    </tr>
                    <tr>
                        <td><label for="conf">conf</label></td>
                        <td><input type="number" id="conf" name="conf" value="0.2" min="0" max="1" step="0.1"></td>
                        <td class="help-text">NMS confidence threshold      (0 - 1)</td>
                    </tr>
                    <tr>
                        <td><label for="iou">iou</label></td>
                        <td><input type="number" id="iou" name="iou" value="0.3" min="0" max="1" step="0.1"></td>
                        <td class="help-text">NMS IoU threshold             (0 - 1)</td>
                    </tr>
                    <tr>
                        <td><label for="agnostic">agnostic</label></td>
                        <td><input type="checkbox" id="agnostic" name="agnostic" checked></td>
                        <td class="help-text">NMS class-agnostic            (True/False)</td>
                    </tr>
                    <tr>
                        <td><label for="multi_label">multi_label</label></td>
                        <td><input type="checkbox" id="multi_label" name="multi_label"></td>
                        <td class="help-text">NMS multiple labels per box   (True/False)</td>
                    </tr>
                    <tr>
                        <td><label for="max_det">max_det</label></td>
                        <td><input type="number" id="max_det" name="max_det" value="3000" min="0" max="10000" step="10"></td>
                        <td class="help-text">Max detections per image      (0 - 10000)</td>
                    </tr>
                    <tr>
                        <td><label for="amp">amp</label></td>
                        <td><input type="checkbox" id="amp" name="amp" checked></td>
                        <td class="help-text">Automatic Mixed Precision     (True/False)</td>
                    </tr>
                    <tr>
                        <td><label for="half_precision">half_precision</label></td>
                        <td><input type="checkbox" id="half_precision" name="half_precision" checked></td>
                        <td class="help-text">Floating Point 16             (True/False)</td>
                    </tr>
                </table>
            </form>
        </details>

        <div class="radio-groups">
            <div class="radio-group">
                <fieldset>
                    <legend>Texts to display</legend>
                    <div class="radio-option">
                        <input type="radio" id="text-corrected-translated" name="text-display" value="text-corrected" checked>
                        <label for="text-corrected-translated">Corrected recognized/translated text</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="text-rough-corrected" name="text-display" value="text-rough">
                        <label for="text-rough-corrected">Rough recognized/translated text</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="text-char-word-markup" name="text-display" value="text-bboxes">
                        <label for="text-char-word-markup">Character/word bounding boxes JSON</label>
                    </div>
                </fieldset>
            </div>
            <div class="radio-group">
                <fieldset>
                    <legend>Processed file to display</legend>
                    <div class="radio-option">
                        <input type="radio" id="processed-corrected" name="processed-file" value="corrected" checked>
                        <label for="processed-corrected">Corrected text with translation overlay</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="processed-rough" name="processed-file" value="rough">
                        <label for="processed-rough">Rough text with translation overlay</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="processed-word-bb" name="processed-file" value="word-bb">
                        <label for="processed-word-bb">Word bounding boxes</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="processed-char-bb" name="processed-file" value="char-bb">
                        <label for="processed-char-bb">Character bounding boxes</label>
                    </div>
                </fieldset>
            </div>
        </div>
        
        <section class="controls">
            <fieldset>
                <legend>Texts</legend>
                <form id="upload-form" enctype="multipart/form-data">
                    <label for="upload" class="visually-hidden">Upload file</label>
                    <input type="file" class="visually-hidden" id="upload" accept=".bmp,.jpeg,.jpg,.png,.mp4" aria-describedby="file-help">
                </form>
                <div class="output">
                    <div class="text-field">
                        <div class="hint" id="text1-hint">Corrected recognized text will appear here</div>
                        <textarea id="text1" readonly></textarea>
                    </div>
                    <div class="text-field">
                        <div class="hint" id="text2-hint">Corrected translated text will appear here</div>
                        <textarea id="text2" readonly></textarea>
                    </div>
                </div>
            </fieldset>
        </section>

        <section class="media-section">
            <fieldset>
                <legend>Files</legend>
                <div class="media-box" id="original-media" aria-label="Original file">
                    <div class="hint" id="original-hint">Original file will appear here</div>
                    <img id="original-image" alt="Original image" style="display: none;">
                    <video id="original-video" controls style="display: none;" aria-label="Original video"></video>
                </div>
                <div class="media-box" id="processed-media" aria-label="Processed file">
                    <div class="hint" id="processed-hint">Corrected text with translation overlay will appear here</div>
                    <img id="processed-image" alt="Processed image" style="display: none;">
                    <video id="processed-video" controls style="display: none;" aria-label="Processed video"></video>
                </div>
            </fieldset>
        </section>
    </main>
    <footer>
        <p id="footer-text" class="watermark">TRUE DESIGN. Content over form.</p>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>