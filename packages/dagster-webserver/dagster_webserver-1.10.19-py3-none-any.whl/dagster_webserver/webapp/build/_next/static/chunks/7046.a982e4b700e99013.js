"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7046],{17046:function(e,n,t){t.d(n,{Wi:function(){return U},dP:function(){return M},rA:function(){return q}});var r=t(73235),i=t(52322),s=t(48177),l=t(18984),o=t(76154),c=t(60206),d=t(94466),a=t(20940),u=t(97077),x=t(96832),h=t(3217),p=t(99564),j=t(39361),m=t(50683),y=t(26834),g=t(15997),f=t(58351),v=t(2784),b=t(7267),C=t(47933),I=t(4760),w=t(43863),S=t(14284),k=t(29872),_=t(98933),K=t(96798),z=t(84991),R=t(93781),F=t(87933),P=t(20913),T=t(86224),$=t(41349),D=t(69706);function O(){let e=(0,r._)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]);return O=function(){return e},e}function E(){let e=(0,r._)(["\n  mutation DeleteConcurrencyLimit($concurrencyKey: String!) {\n    deleteConcurrencyLimit(concurrencyKey: $concurrencyKey)\n  }\n"]);return E=function(){return e},e}function L(){let e=(0,r._)(["\n  mutation FreeConcurrencySlots($runId: String!, $stepKey: String) {\n    freeConcurrencySlots(runId: $runId, stepKey: $stepKey)\n  }\n"]);return L=function(){return e},e}function N(){let e=(0,r._)(["\n  query RunsForConcurrencyKeyQuery($filter: RunsFilter, $limit: Int) {\n    pipelineRunsOrError(filter: $filter, limit: $limit) {\n      ... on Runs {\n        results {\n          id\n          status\n        }\n      }\n    }\n  }\n"]);return N=function(){return e},e}let U=e=>{var n,t;let{concurrencyKey:r}=e;(0,K.Px)(),(0,R.j)("Pool: ".concat(r));let[j,m]=v.useState(),[y,g]=v.useState(!1),f=(0,I.aM)(w.l,{variables:{pool:r}}),{data:S,refetch:z}=f,F=null==S?void 0:S.instance.concurrencyLimit,T=null==S?void 0:S.instance.runQueuingSupported,$=(0,_.C4)(f,_.dT),D=(0,b.k6)(),O=null==S?void 0:null===(n=S.instance.poolConfig)||void 0===n?void 0:n.poolGranularity;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{overflowY:"auto"},children:F?(0,i.jsxs)(s.x,{children:[(0,i.jsxs)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},border:"bottom",children:[(0,i.jsx)(l.X6,{children:(0,i.jsxs)(s.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(C.rU,{to:"/deployment/concurrency",children:"Pools"})}),(0,i.jsx)("div",{children:"/"}),(0,i.jsx)("div",{children:r})]})}),(0,i.jsxs)(s.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)(_.xi,{refreshState:$}),(0,i.jsx)(o.J2,{position:"bottom-right",content:(0,i.jsx)(c.v2,{children:(0,i.jsx)(c.sN,{icon:"delete",text:"Delete",intent:"danger",onClick:()=>g(!0)})}),children:(0,i.jsx)(d.zx,{icon:(0,i.jsx)(a.JO,{name:"expand_more"})})})]})]}),(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},children:(0,i.jsx)(l.pm,{children:"Pool info"})}),T||"op"===O?null:(0,i.jsx)(s.x,{margin:{horizontal:20,bottom:20},children:(0,i.jsx)(u.b,{intent:"warning",title:"Run granularity for pools not supported",description:(0,i.jsxs)(i.Fragment,{children:["The pool granularity is set to ",(0,i.jsx)(l.fv,{children:"run"}),", but run-level concurrency is not supported with this run coordinator. To enable run granularity for pools, configure your instance to use the default ",(0,i.jsx)(l.fv,{children:"QueuedRunCoordinator"})," ","in your ",(0,i.jsx)(l.fv,{children:"dagster.yaml"}),". See the"," ",(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://docs.dagster.io/deployment/dagster-instance#queuedruncoordinator",children:"QueuedRunCoordinator documentation"})," ","for more information."]})})}),(0,i.jsx)(s.x,{padding:{bottom:24},children:(0,i.jsx)(x.fJ,{style:{marginLeft:-1},children:(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{verticalAlign:"middle"},children:"Granularity"}),(0,i.jsx)("td",{children:"run"===O?"Run":"Op"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{verticalAlign:"middle"},children:"Limit"}),(0,i.jsx)("td",{children:(0,i.jsxs)(s.x,{flex:{justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)(s.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)("div",{children:F.slotCount?F.slotCount:null===F.limit?(0,i.jsx)(i.Fragment,{children:"—"}):F.limit}),F.usingDefaultLimit?(0,i.jsx)(l.YS,{color:h.Aw(),children:"(default)"}):null]}),(0,i.jsx)(d.zx,{icon:(0,i.jsx)(a.JO,{name:"edit"}),onClick:()=>m(!0),children:"Edit limit"})]})})]})]})})}),(null==S?void 0:null===(t=S.instance.poolConfig)||void 0===t?void 0:t.poolGranularity)!=="run"?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"In progress steps"})}),(0,i.jsx)(s.x,{style:{marginLeft:-1},children:(0,i.jsx)(V,{keyInfo:F,refresh:z})}),(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"Queued runs"})}),(0,i.jsx)(J,{pool:r,runStatuses:P.sy})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"In progress"})}),(0,i.jsx)(J,{pool:r,runStatuses:P.Ys}),(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"Queued"})}),(0,i.jsx)(J,{pool:r,runStatuses:P.sy})]})]}):(0,i.jsx)(s.x,{flex:{direction:"column",alignItems:"center"},padding:{vertical:64},children:(0,i.jsx)(p.f,{label:"Loading…"})})}),(0,i.jsx)(A,{concurrencyKey:r,open:!!j,onClose:()=>m(!1),onComplete:z,minValue:(null==S?void 0:S.instance.minConcurrencyLimitValue)||0,maxValue:(null==S?void 0:S.instance.maxConcurrencyLimitValue)||1e3}),(0,i.jsx)(Q,{concurrencyKey:r,open:!!y,onClose:()=>g(!1),onComplete:()=>{D.push("/deployment/concurrency"),(0,k.B)({icon:"trash",intent:"success",message:"Deleted pool limit"})}})]})},q=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(!e)return!1;let r=parseInt(e);return!isNaN(r)&&String(r)===e.trim()&&r>=n&&r<=t},A=e=>{let{concurrencyKey:n,open:t,onClose:r,onComplete:o,minValue:c,maxValue:a}=e,[u,x]=v.useState(!1),[h,p]=v.useState("");v.useEffect(()=>{p("")},[t]);let[y]=(0,I.Db)(Y),g=async()=>{x(!0),await y({variables:{concurrencyKey:n,limit:parseInt(h.trim())}}),x(!1),o(),r()};return(0,i.jsxs)(j.Vq,{isOpen:t,title:(0,i.jsxs)("span",{children:["Edit ",(0,i.jsx)(l.fv,{children:n})]}),onClose:r,children:[(0,i.jsxs)(j.a7,{children:[(0,i.jsx)(s.x,{margin:{bottom:4},children:"Pool:"}),(0,i.jsx)(s.x,{margin:{bottom:16},children:(0,i.jsx)("strong",{children:n})}),(0,i.jsxs)(s.x,{margin:{bottom:4},children:["Pool limit (",c,"-",a,"):"]}),(0,i.jsx)(s.x,{children:(0,i.jsx)(m.oi,{value:h||"",onChange:e=>p(e.target.value),placeholder:"".concat(c," - ").concat(a)})})]}),(0,i.jsxs)(j.cN,{children:[(0,i.jsx)(d.zx,{intent:"none",onClick:r,children:"Close"}),u?(0,i.jsx)(d.zx,{intent:"primary",disabled:!0,children:"Updating…"}):(0,i.jsx)(d.zx,{intent:"primary",onClick:g,disabled:!q(h.trim(),c,a),children:"Update limit"})]})]})},Q=e=>{let{concurrencyKey:n,open:t,onClose:r,onComplete:s}=e,[o,c]=v.useState(!1),[a]=(0,I.Db)(H),u=async()=>{c(!0),await a({variables:{concurrencyKey:n}}),c(!1),s(),r()},x=(0,i.jsxs)(i.Fragment,{children:["Delete ",(0,i.jsx)(l.fv,{children:n})]});return(0,i.jsxs)(j.Vq,{isOpen:t,title:x,onClose:r,children:[(0,i.jsxs)(j.a7,{children:["Delete concurrency limit\xa0",(0,i.jsx)("strong",{children:n}),"?"]}),(0,i.jsxs)(j.cN,{children:[(0,i.jsx)(d.zx,{onClick:r,children:"Close"}),(0,i.jsx)(d.zx,{intent:"danger",disabled:o,onClick:u,children:o?"Deleting…":"Delete limit"})]})]})},B=e=>{let{pendingStep:n,onUpdate:t}=e,[r]=(0,I.Db)(M);return(0,i.jsx)(o.J2,{content:(0,i.jsxs)(c.v2,{children:[(0,i.jsx)(c.sN,{icon:"status",text:"Free concurrency slot for step",onClick:async()=>{var e;(null===(e=(await r({variables:{runId:n.runId,stepKey:n.stepKey}})).data)||void 0===e?void 0:e.freeConcurrencySlots)&&(t(),await (0,k.B)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slot"}))}},"free-concurrency-slots-step"),(0,i.jsx)(c.sN,{icon:"status",text:"Free all concurrency slots for run",onClick:async()=>{var e;await (0,k.B)({intent:"primary",message:"Freeing concurrency slots..."}),(null===(e=(await r({variables:{runId:n.runId}})).data)||void 0===e?void 0:e.freeConcurrencySlots)&&(t(),await (0,k.B)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slots"}))}},"free-concurrency-slots-run")]}),position:"bottom-right",children:(0,i.jsx)(d.zx,{rightIcon:(0,i.jsx)(a.JO,{name:"expand_more"}),children:"Actions"})})},J=e=>{let{pool:n,runStatuses:t}=e,r={statuses:Array.from(t),tags:[{key:"".concat(T.H.PoolTagPrefix,"/").concat(n),value:"true"}]};return(0,i.jsx)(S.g,{filter:r,includeRunsFromBackfills:!0,emptyState:()=>(0,i.jsx)(s.x,{padding:{vertical:24},flex:{direction:"column",alignItems:"center"},children:t.has(z.VOA.STARTED)?"No matching runs in progress.":"No matching runs in queue."})})},V=e=>{var n;let{keyInfo:t,refresh:r}=e,l=[...new Set(t.pendingSteps.map(e=>e.runId))],o=(0,I.aM)(W,{variables:{filter:{runIds:l}},skip:!t.pendingSteps.length}),c={};((null===(n=o.data)||void 0===n?void 0:n.pipelineRunsOrError.__typename)==="Runs"?o.data.pipelineRunsOrError.results:[]).forEach(e=>{c[e.id]=e.status});let d=[...t.pendingSteps];d.sort((e,n)=>e.priority&&n.priority&&e.priority!==n.priority?e.priority-n.priority:e.enqueuedTimestamp-n.enqueuedTimestamp);let u=d.filter(e=>!!e.assignedTimestamp),x=d.filter(e=>!e.assignedTimestamp),p=(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Run ID"}),(0,i.jsx)("th",{children:"Step key"}),(0,i.jsx)("th",{children:"Assigned"}),(0,i.jsx)("th",{children:"Queued"}),(0,i.jsx)("th",{children:(0,i.jsxs)(s.x,{flex:{alignItems:"center",direction:"row",gap:4},children:["Priority",(0,i.jsx)(y.u,{placement:"top",content:"Priority can be set on each op/asset using the 'dagster/priority' tag. Higher priority steps will be assigned slots first.",children:(0,i.jsx)(a.JO,{name:"info",color:h.md()})})]})}),(0,i.jsx)("th",{})]})});return d.length?(0,i.jsxs)(f.i,{children:[p,(0,i.jsx)("tbody",{style:{backgroundColor:h.B5()},children:u.map(e=>(0,i.jsx)(G,{step:e,statusByRunId:c,onUpdate:r},e.runId+e.stepKey))}),(0,i.jsx)("tbody",{children:x.map(e=>(0,i.jsx)(G,{step:e,statusByRunId:c,onUpdate:r},e.runId+e.stepKey))})]}):(0,i.jsx)(g.t,{icon:"no-results",title:"No active steps",description:"There are no active or pending steps for this pool."})},G=e=>{let{step:n,statusByRunId:t,onUpdate:r}=e,o=t[n.runId];return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:o?(0,i.jsx)(C.rU,{to:"/runs/".concat(n.runId),children:(0,i.jsxs)(s.x,{flex:{direction:"row",alignItems:"center",gap:8},children:[(0,i.jsx)(F.O_,{status:o,size:10}),(0,i.jsx)(l.fv,{children:(0,$.EI)({id:n.runId})}),P.hd.has(o)?(0,i.jsx)(y.u,{placement:"top",content:"Slots for canceled / failed runs can automatically be freed by configuring a run monitoring setting.",children:(0,i.jsx)(a.JO,{name:"info",color:h.md()})}):null]})}):(0,i.jsx)(l.fv,{children:(0,$.EI)({id:n.runId})})}),(0,i.jsx)("td",{children:(0,i.jsx)(l.fv,{children:n.stepKey})}),(0,i.jsx)("td",{children:n.assignedTimestamp?(0,i.jsx)(D.Q,{startUnix:n.assignedTimestamp,endUnix:null}):"-"}),(0,i.jsx)("td",{children:n.enqueuedTimestamp?(0,i.jsx)(D.Q,{startUnix:n.enqueuedTimestamp,endUnix:null}):"-"}),(0,i.jsx)("td",{children:n.priority}),(0,i.jsx)("td",{children:(0,i.jsx)(B,{pendingStep:n,onUpdate:r})})]})},Y=(0,I.Ps)(O()),H=(0,I.Ps)(E()),M=(0,I.Ps)(L()),W=(0,I.Ps)(N())}}]);
//# sourceMappingURL=7046.a982e4b700e99013.js.map