"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[810],{8637:function(n,e,t){t.d(e,{T:function(){return r}});let r=t(35505).ZP.div.withConfig({componentId:"sc-2cf5acf-0"})(["height:100%;overflow-y:auto;padding-bottom:64px;width:100%;"])},810:function(n,e,t){t.r(e),t.d(e,{ConcurrencyLimits:function(){return G},INSTANCE_CONCURRENCY_LIMITS_QUERY:function(){return nt},InstanceConcurrencyIndexContent:function(){return U},InstanceConcurrencyPage:function(){return W},InstanceConcurrencyPageContent:function(){return M},RunConcurrencyContent:function(){return B},default:function(){return X}});var r=t(73235),i=t(52322),o=t(48177),c=t(99564),s=t(8637),l=t(71018),u=t(18984),a=t(96832),d=t(15997),x=t(54123),m=t(50683),h=t(94466),y=t(20940),j=t(39361),f=t(11170),g=t(2784),p=t(7267),C=t(44537);let b=n=>{let{activeTab:e,onChange:t}=n;return(0,i.jsxs)(C.mQ,{selectedTabId:e,onChange:t,children:[(0,i.jsx)(C.OK,{title:"Pools",id:"key-concurrency",selected:"key-concurrency"===e}),(0,i.jsx)(C.OK,{title:"Run tag concurrency",id:"run-concurrency",selected:"run-concurrency"===e})]})};var v=t(17046),w=t(283),S=t(98834),I=t(66135),L=t(88510),R=t(47933),K=t(35505),N=t(4760),k=t(98933),Q=t(97373),_=t(14500);function T(){let n=(0,r._)(["\n  query SingleConcurrencyKeyQuery($concurrencyKey: String!) {\n    instance {\n      id\n      concurrencyLimit(concurrencyKey: $concurrencyKey) {\n        concurrencyKey\n        slotCount\n        claimedSlots {\n          runId\n          stepKey\n        }\n        pendingSteps {\n          runId\n          stepKey\n          enqueuedTimestamp\n          assignedTimestamp\n          priority\n        }\n      }\n    }\n  }\n"]);return T=function(){return n},n}let P="1fr 1fr",q=n=>{let{concurrencyKeys:e}=n,t=(0,g.useRef)(null),r=(0,L.MG)({count:e.length,getScrollElement:()=>t.current,estimateSize:()=>64,overscan:10}),o=r.getTotalSize(),c=r.getVirtualItems();return(0,i.jsx)("div",{style:{overflow:"hidden"},children:(0,i.jsxs)(Q.W2,{ref:t,children:[(0,i.jsx)(O,{}),(0,i.jsx)(Q.Nh,{$totalHeight:o,children:c.map(n=>{let{index:t,key:r,size:o,start:c}=n,s=e[t];return(0,i.jsx)(V,{concurrencyKey:s,height:o,start:c},r)})})]})})},O=()=>(0,i.jsxs)(Q.VJ,{templateColumns:P,sticky:!0,children:[(0,i.jsx)(Q.qN,{children:"Pool"}),(0,i.jsx)(Q.qN,{children:"Limit"})]}),V=n=>{let{concurrencyKey:e,height:t,start:r}=n,c=(0,I.F)(100),s=(0,N.aM)(z,{variables:{concurrencyKey:e},skip:!c});(0,k.C4)(s,k.dT);let{data:l}=s,u=null==l?void 0:l.instance.concurrencyLimit,a="/deployment/concurrency/".concat(encodeURIComponent(e));return(0,i.jsx)(Q.X2,{$height:t,$start:r,children:(0,i.jsxs)($,{border:"bottom",children:[(0,i.jsx)(Q.E5,{children:(0,i.jsxs)(o.x,{flex:{gap:4,alignItems:"center"},children:[(0,i.jsx)(y.JO,{name:"dynamic_feed"}),(0,i.jsx)(R.rU,{to:a,children:e})]})}),(0,i.jsx)(Q.E5,{children:u?(0,i.jsx)("div",{children:u.slotCount}):(0,i.jsx)(_.mq,{queryResult:s})})]})})},z=(0,N.Ps)(T()),$=(0,K.ZP)(o.x).withConfig({componentId:"sc-c6d13853-0"})(["display:grid;grid-template-columns:",";height:100%;"],P);var E=t(6317),A=t(96798),F=t(93781);function Y(){let n=(0,r._)(["\n  fragment RunQueueConfigFragment on RunQueueConfig {\n    maxConcurrentRuns\n    tagConcurrencyLimitsYaml\n  }\n"]);return Y=function(){return n},n}function Z(){let n=(0,r._)(["\n  query InstanceConcurrencyLimitsQuery {\n    instance {\n      id\n      supportsConcurrencyLimits\n      runQueuingSupported\n      runQueueConfig {\n        ...RunQueueConfigFragment\n      }\n      minConcurrencyLimitValue\n      maxConcurrencyLimitValue\n      concurrencyLimits {\n        concurrencyKey\n      }\n    }\n  }\n\n  ","\n"]);return Z=function(){return n},n}function J(){let n=(0,r._)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]);return J=function(){return n},n}let M=g.memo(()=>{let{concurrencyKey:n}=(0,p.UO)();if(!n)return(0,i.jsx)(U,{});let e=decodeURIComponent(n);return(0,i.jsx)(v.Wi,{concurrencyKey:e})}),U=g.memo(()=>{(0,A.Px)(),(0,F.j)("Concurrency");let n=(0,N.aM)(nt,{notifyOnNetworkStatusChange:!0}),[e,t]=g.useState("key-concurrency"),{data:r}=n;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(D,{activeTab:e,onChange:t}),r?"run-concurrency"===e?(0,i.jsx)("div",{style:{overflowY:"auto"},children:(0,i.jsx)(B,{hasRunQueue:!!(null==r?void 0:r.instance.runQueuingSupported),runQueueConfig:null==r?void 0:r.instance.runQueueConfig})}):(0,i.jsx)("div",{style:{overflowY:"hidden"},children:(0,i.jsx)(G,{concurrencyKeys:r.instance.concurrencyLimits.map(n=>n.concurrencyKey),hasSupport:r.instance.supportsConcurrencyLimits,refetch:n.refetch,minValue:r.instance.minConcurrencyLimitValue,maxValue:r.instance.maxConcurrencyLimitValue})}):(0,i.jsx)(o.x,{padding:{vertical:64},flex:{direction:"column",alignItems:"center"},children:(0,i.jsx)(c.f,{label:"Loading concurrency informationâ€¦"})})]})}),W=()=>{let{pageTitle:n}=g.useContext(w.N);return(0,i.jsxs)(s.T,{style:{padding:0},children:[(0,i.jsx)(l.m,{title:(0,i.jsx)(u.X6,{children:n}),tabs:(0,i.jsx)(S.Z,{tab:"concurrency"})}),(0,i.jsx)(U,{})]})};var X=W;let B=n=>{let{hasRunQueue:e,runQueueConfig:t}=n;if(!e)return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.x,{padding:{vertical:16,horizontal:24},border:"bottom",flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(u.pm,{children:"Run tag concurrency"})}),(0,i.jsxs)(o.x,{padding:{vertical:16,horizontal:24},children:["Run concurrency is not supported with this run coordinator. To enable run concurrency limits, configure your instance to use the ",(0,i.jsx)(u.fv,{children:"QueuedRunCoordinator"})," in your"," ",(0,i.jsx)(u.fv,{children:"dagster.yaml"}),". See the"," ",(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://docs.dagster.io/deployment/dagster-instance#queuedruncoordinator",children:"QueuedRunCoordinator documentation"})," ","for more information."]})]});let r=(0,i.jsxs)(o.x,{padding:{vertical:24,horizontal:24},children:["Run tag concurrency can be set in your deployment settings. See the"," ",(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://docs.dagster.io/guides/limiting-concurrency-in-data-pipelines#configuring-run-level-concurrency",children:"concurrency documentation"})," ","for more information."]}),c=t?(0,i.jsx)(a.fJ,{style:{marginLeft:-1},children:(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Max concurrent runs:"}),(0,i.jsx)("td",{children:t.maxConcurrentRuns})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Tag concurrency limits:"}),(0,i.jsx)("td",{children:t.tagConcurrencyLimitsYaml?(0,i.jsx)(f.u,{value:t.tagConcurrencyLimitsYaml,options:{readOnly:!0,lineNumbers:!0,mode:"yaml"}}):"-"})]})]})}):null;return(0,i.jsxs)(o.x,{children:[r,c]})},D=n=>{let{activeTab:e,onChange:t}=n;return(0,i.jsx)(o.x,{flex:{justifyContent:"space-between",alignItems:"center"},padding:{horizontal:24},border:"bottom",children:(0,i.jsx)(b,{activeTab:e,onChange:t})})},G=n=>{let{hasSupport:e,concurrencyKeys:t,refetch:r,minValue:c,maxValue:s}=n,[l,u]=g.useState(!1),[a,m]=g.useState(""),h=()=>u(!0),y=g.useMemo(()=>[...t].filter(n=>n.includes(a)).sort((n,e)=>E.Bl.compare(n,e)),[t,a]);return e?(0,i.jsxs)(o.x,{flex:{direction:"column"},style:{overflow:"auto",height:"100%"},children:[(0,i.jsx)(H,{onAdd:h,search:a,setSearch:m}),0===t.length?(0,i.jsx)(o.x,{margin:24,children:(0,i.jsx)(d.t,{icon:"error",title:"No pool limits",description:(0,i.jsxs)(i.Fragment,{children:["No pool limits have been configured for this instance.\xa0",(0,i.jsx)(x.Z,{onClick:()=>h(),children:"Add a pool limit"}),"."]})})}):y.length?(0,i.jsx)(q,{concurrencyKeys:y}):(0,i.jsx)(o.x,{padding:16,children:(0,i.jsx)(d.t,{icon:"no-results",title:"No pool limits",description:"No pool limits matching the filter."})}),(0,i.jsx)(nn,{open:!!l,onClose:()=>u(!1),onComplete:r,minValue:null!=c?c:1,maxValue:null!=s?s:1e3})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(H,{}),(0,i.jsx)(o.x,{margin:24,children:(0,i.jsx)(d.t,{icon:"error",title:"No concurrency support",description:"This instance does not currently support pool-based concurrency limits. You may need to run `dagster instance migrate` to add the necessary tables to your dagster storage to support this feature."})})]})},H=n=>{let{onAdd:e,setSearch:t,search:r}=n;return(0,i.jsx)(o.x,{flex:{direction:"column"},children:t?(0,i.jsxs)(o.x,{flex:{direction:"row",justifyContent:"space-between"},padding:{vertical:16,horizontal:24},border:"bottom",children:[(0,i.jsx)(m.oi,{value:r||"",style:{width:"30vw",minWidth:150,maxWidth:400},placeholder:"Filter pools",onChange:n=>t(n.target.value)}),e?(0,i.jsx)(h.zx,{icon:(0,i.jsx)(y.JO,{name:"add_circle"}),onClick:()=>e(),children:"Add pool limit"}):null]}):null})},nn=n=>{let{open:e,onClose:t,onComplete:r,maxValue:c,minValue:s}=n,[l,u]=g.useState(!1),[a,d]=g.useState(""),[x,y]=g.useState("");g.useEffect(()=>{d(""),y("")},[e]);let[f]=(0,N.Db)(nr),p=async()=>{u(!0),await f({variables:{concurrencyKey:x,limit:parseInt(a.trim())}}),u(!1),r(),t()};return(0,i.jsxs)(j.Vq,{isOpen:e,title:"Add pool limit",onClose:t,children:[(0,i.jsxs)(j.a7,{children:[(0,i.jsx)(o.x,{margin:{bottom:4},children:"Pool:"}),(0,i.jsx)(o.x,{margin:{bottom:16},children:(0,i.jsx)(m.oi,{value:x||"",onChange:n=>y(n.target.value),placeholder:"Pool"})}),(0,i.jsxs)(o.x,{margin:{bottom:4},children:["Pool limit (",s,"-",c,"):"]}),(0,i.jsx)(o.x,{children:(0,i.jsx)(m.oi,{value:a||"",onChange:n=>d(n.target.value),placeholder:"".concat(s," - ").concat(c)})})]}),(0,i.jsxs)(j.cN,{children:[(0,i.jsx)(h.zx,{intent:"none",onClick:t,children:"Cancel"}),(0,i.jsx)(h.zx,{intent:"primary",onClick:p,disabled:!(0,v.rA)(a.trim(),s,c)||!x||l,children:l?"Adding...":"Add limit"})]})]})},ne=(0,N.Ps)(Y()),nt=(0,N.Ps)(Z(),ne),nr=(0,N.Ps)(J())},98834:function(n,e,t){t.d(e,{Z:function(){return p}});var r=t(52322),i=t(48177),o=t(44537),c=t(2784),s=t(283),l=t(98012),u=t(98933),a=t(20940),d=t(3217),x=t(25997),m=t(56330);let h=(0,c.memo)(()=>{let{daemons:n}=(0,c.useContext)(m.Z);return n?(0,r.jsx)(x.a,{content:n.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,r.jsx)(a.JO,{name:"warning",color:d.qr()})}):null});var y=t(26834),j=t(74741);let f=(0,c.memo)(n=>{let{placeholder:e}=n,{codeLocations:t}=(0,c.useContext)(m.Z);return t?"spinner"===t.type?(0,r.jsx)(y.u,{content:t.content,placement:"bottom",children:(0,r.jsx)(j.$,{purpose:"body-text",fillColor:d.md()})}):(0,r.jsx)(x.a,{content:t.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,r.jsx)(a.JO,{name:"warning",color:d.qr()})}):e?(0,r.jsx)("div",{style:{width:"16px"}}):null});var g=t(74597);let p=n=>{let{refreshState:e,tab:t}=n,{healthTitle:a}=(0,c.useContext)(s.N),d=(0,l._)();return(0,r.jsxs)(i.x,{flex:{direction:"row",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,r.jsxs)(o.mQ,{selectedTabId:t,children:[(0,r.jsx)(g.f,{id:"locations",title:"Code locations",to:"/locations",icon:(0,r.jsx)(f,{placeholder:!1})}),(0,r.jsx)(g.f,{id:"health",title:a,to:"/health",icon:(0,r.jsx)(h,{})}),d?(0,r.jsx)(g.f,{id:"concurrency",title:"Concurrency",to:"/concurrency"}):null,d?(0,r.jsx)(g.f,{id:"config",title:"Configuration",to:"/config"}):null]}),e?(0,r.jsx)(i.x,{padding:{bottom:8},children:(0,r.jsx)(u.xi,{refreshState:e})}):null]})}}}]);
//# sourceMappingURL=810.c1c65952e4d29931.js.map