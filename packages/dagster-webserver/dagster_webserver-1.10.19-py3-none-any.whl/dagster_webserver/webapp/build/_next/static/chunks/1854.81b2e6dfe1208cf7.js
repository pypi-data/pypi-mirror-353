"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1854],{71854:function(e,t,n){n.r(t),n.d(t,{MergedAutomationRoot:function(){return e4},default:function(){return e9}});var s,r,o=n(52322),a=n(48177),i=n(99564),l=n(15997),c=n(18984),d=n(20940),u=n(3217),h=n(71018),p=n(50683),m=n(26834),x=n(2784),g=n(76154),f=n(60206),j=n(94466),y=n(15358),S=n(56876),v=n(39361),w=n(4760),b=n(6317);let N={step:"initial",completion:{completed:0,errors:{}}},E=(e,t)=>{switch(t.type){case"reset":return N;case"start":return{...e,step:"updating"};case"update-success":{let{completion:t}=e;return{step:"updating",completion:{...t,completed:t.completed+1}}}case"update-error":{let{completion:n}=e;return{step:"updating",completion:{...n,completed:n.completed+1,errors:{...n.errors,[t.name]:t.error}}}}case"complete":return{...e,step:"completed"}}},k=()=>(0,x.useReducer)(E,N);var C=n(98015),T=n(77937),A=n(2602);let M=e=>{let{openWithIntent:t,onClose:n,automations:s}=e,r=s.length,[a,i]=k();(0,x.useEffect)(()=>{"not-open"===t&&i({type:"reset"})},[t,i]);let[l]=(0,w.Db)(A.VE),[c]=(0,w.Db)(A.Xu),[h]=(0,w.Db)(T.Wz),[p]=(0,w.Db)(T.d0),m=async e=>{let{repoAddress:t,name:n,type:s}=e,r={repositoryLocationName:t.location,repositoryName:t.name};switch(s){case"sensor":{let{data:e}=await l({variables:{sensorSelector:{...r,sensorName:n}}});switch(null==e?void 0:e.startSensor.__typename){case"Sensor":i({type:"update-success"});return;case"SensorNotFoundError":case"UnauthorizedError":case"PythonError":i({type:"update-error",name:n,error:e.startSensor.message})}break}case"schedule":{let{data:e}=await h({variables:{scheduleSelector:{...r,scheduleName:n}}});switch(null==e?void 0:e.startSchedule.__typename){case"ScheduleStateResult":i({type:"update-success"});return;case"UnauthorizedError":case"PythonError":i({type:"update-error",name:n,error:e.startSchedule.message})}break}default:(0,b.UT)(s)}},g=async e=>{let{name:t,type:n,instigationState:s}=e,r={id:s.id};switch(n){case"sensor":{let{data:e}=await c({variables:r});switch(null==e?void 0:e.stopSensor.__typename){case"StopSensorMutationResult":i({type:"update-success"});return;case"UnauthorizedError":case"PythonError":i({type:"update-error",name:t,error:e.stopSensor.message})}break}case"schedule":{let{data:e}=await p({variables:r});switch(null==e?void 0:e.stopRunningSchedule.__typename){case"ScheduleStateResult":i({type:"update-success"});return;case"UnauthorizedError":case"PythonError":i({type:"update-error",name:t,error:e.stopRunningSchedule.message})}break}default:(0,b.UT)(n)}},f=async()=>{if("not-open"!==t){for(let e of(i({type:"start"}),s))"start"===t?await m(e):await g(e);i({type:"complete"})}},N="updating"!==a.step;return(0,o.jsxs)(v.Vq,{isOpen:"not-open"!==t,title:"start"===t?"Start automations":"Stop automations",canEscapeKeyClose:N,canOutsideClickClose:N,onClose:n,children:[(0,o.jsx)(v.a7,{children:(0,o.jsxs)(S.Z,{direction:"column",spacing:24,children:[(()=>{if("not-open"===t)return null;switch(a.step){case"initial":if("stop"===t)return(0,o.jsx)("div",{children:"".concat(1===r?"1 automation":"".concat(r," automations")," will be stopped. Do you want to continue?")});return(0,o.jsx)("div",{children:"".concat(1===r?"1 automation":"".concat(r," automations")," will be started. Do you want to continue?")});case"updating":case"completed":let e=r>0?a.completion.completed/r:1;return(0,o.jsxs)(S.Z,{direction:"column",spacing:8,children:[(0,o.jsx)(y.k,{intent:"primary",value:Math.max(.1,e),animate:e<1}),"updating"===a.step?(0,o.jsx)(C.c,{message:"Automations are being updated, please do not navigate away yet."}):null]});default:return null}})(),(()=>{if("not-open"===t||"initial"===a.step)return null;if("updating"===a.step)return(0,o.jsx)("div",{children:"Please do not close the window or navigate away while automations are being updated."});let e=a.completion.errors,n=Object.keys(e).length,s=a.completion.completed-n;return(0,o.jsxs)(S.Z,{direction:"column",spacing:8,children:[s?(0,o.jsxs)(S.Z,{direction:"row",spacing:8,alignItems:"flex-start",children:[(0,o.jsx)(d.JO,{name:"check_circle",color:u.fA()}),(0,o.jsx)("div",{children:"start"===t?"Successfully started ".concat(1===s?"1 automation":"".concat(s," automations"),"."):"Successfully stopped ".concat(1===s?"1 automation":"".concat(s," automations"),".")})]}):null,n?(0,o.jsxs)(S.Z,{direction:"column",spacing:8,children:[(0,o.jsxs)(S.Z,{direction:"row",spacing:8,alignItems:"flex-start",children:[(0,o.jsx)(d.JO,{name:"warning",color:u.qr()}),(0,o.jsx)("div",{children:"start"===t?"Could not start ".concat(1===n?"1 automation":"".concat(n," automations"),":"):"Could not stop ".concat(1===n?"1 automation":"".concat(n," automations"),":")})]}),(0,o.jsx)("ul",{style:{margin:"8px 0"},children:Object.keys(e).map(t=>(0,o.jsx)("li",{children:(0,o.jsxs)(S.Z,{direction:"row",spacing:8,children:[(0,o.jsxs)("strong",{children:[t,":"]}),e[t]?(0,o.jsx)("div",{children:e[t]}):null]})},t))})]}):null]})})()]})}),(0,o.jsx)(v.cN,{children:(()=>{if("not-open"===t)return null;switch(a.step){case"initial":return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(j.zx,{onClick:n,children:"Cancel"}),(0,o.jsx)(j.zx,{intent:"primary",onClick:f,children:"start"===t?"Start ".concat(1===r?"1 automation":"".concat(r," automations")):"Stop ".concat(1===r?"1 automation":"".concat(r," automations"))})]});case"updating":return(0,o.jsx)(j.zx,{intent:"primary",disabled:!0,children:"start"===t?"Starting ".concat(1===r?"1 automation":"".concat(r," automations")):"Stopping ".concat(1===r?"1 automation":"".concat(r," automations"))});case"completed":return(0,o.jsx)(j.zx,{intent:"primary",onClick:n,children:"Done"})}})()})]})};var z=n(84991);let _=e=>{let t=!1,n=!1;for(let s of e){let{status:e}=s;if(e===z.ynu.RUNNING?n=!0:e===z.ynu.STOPPED&&(t=!0),n&&t)break}return{anyOff:t,anyOn:n}},O=e=>{let{automations:t}=e,n=t.length,[s,r]=(0,x.useState)("not-open"),{anyOff:a,anyOn:i}=(0,x.useMemo)(()=>_(t.map(e=>{let{instigationState:t}=e;return t})),[t]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g.J2,{content:(0,o.jsxs)(f.v2,{children:[(0,o.jsx)(f.sN,{text:"Start ".concat(1===n?"1 automation":"".concat(n," automations")),disabled:!a,"aria-disabled":!a,icon:"toggle_on",onClick:()=>{r("start")}}),(0,o.jsx)(f.sN,{text:"Stop ".concat(1===n?"1 automation":"".concat(n," automations")),disabled:!i,"aria-disabled":!i,icon:"toggle_off",onClick:()=>{r("stop")}})]}),placement:"bottom-end",children:(0,o.jsx)(j.zx,{disabled:!n,intent:"primary",rightIcon:(0,o.jsx)(d.JO,{name:"expand_more"}),children:"Actions"})}),(0,o.jsx)(M,{openWithIntent:s,automations:t,onClose:()=>r("not-open")})]})};var U=n(73528),R=n(54854),L=n(88510),I=n(35505),P=n(97373);let q="60px minmax(400px, 1.5fr) 240px 1fr 200px 200px",D=e=>{let{checkbox:t}=e;return(0,o.jsxs)(P.VJ,{templateColumns:q,sticky:!0,children:[(0,o.jsx)(P.qN,{children:(0,o.jsx)("div",{style:{position:"relative",top:"-1px"},children:t})}),(0,o.jsx)(P.qN,{children:"Name"}),(0,o.jsx)(P.qN,{children:"Type"}),(0,o.jsx)(P.qN,{children:"Target"}),(0,o.jsx)(P.qN,{children:"Last tick"}),(0,o.jsx)(P.qN,{children:"Last run"})]})},F=(0,I.ZP)(a.x).withConfig({componentId:"sc-40d0a0cf-0"})(["display:grid;grid-template-columns:",";height:100%;"],q);var Y=n(66135),Z=n(35025),V=n(2636),$=n(47933),G=n(39427),J=n(98933),K=n(59784),W=n(96832);let X=e=>{var t;let n=null===(t=Intl.DateTimeFormat(navigator.language,{timeZone:e,timeZoneName:"shortOffset"}).formatToParts(new Date).find(e=>"timeZoneName"===e.type))||void 0===t?void 0:t.value,s=null==n?void 0:n.replace("GMT","");if(!s)return 0;let[r="0",o="0"]=s.split(":"),a=parseInt(r,10),i=parseInt(o,10)/60*(a<0?-1:1);return a+i};var H=n(41902),Q=n(64827),B=n(35175);let ee=e=>{let{cronSchedule:t,executionTimezone:n}=e,{timezone:[s]}=(0,x.useContext)(Q.JB),r=n||"UTC",a=(0,H.A)(t,{longTimezoneName:r}),i="Automatic"===s?(0,B.cw)():s,l=X(i),d=X(r),u=(0,H.A)(t,{longTimezoneName:i,tzOffset:l-d}),h=(0,o.jsx)(W.nZ,{rows:[{key:"Cron value",value:(0,o.jsx)(c.aU,{children:t})},{key:"Your time",value:(0,o.jsx)("span",{children:u})}]});return(0,o.jsx)(et,{children:(0,o.jsx)(m.u,{content:h,placement:"top",children:(0,o.jsx)(R.V,{icon:"schedule",children:a})})})},et=I.ZP.div.withConfig({componentId:"sc-2128f2f4-0"})([".bp5-popover-target{max-width:100%;:focus{outline:none;}}"]);var en=n(90325),es=n(50643);let er=(e,t)=>{if(e===z.ynu.STOPPED&&0===t||e===z.ynu.RUNNING&&1===t)return null;let n=[];return e===z.ynu.RUNNING&&0===t?n.push("Schedule is set to be running, but either the scheduler is not configured or the scheduler is not running the schedule"):e===z.ynu.STOPPED&&t>0&&n.push("Schedule is set to be stopped, but the scheduler is still running the schedule"),t>0&&n.push("Duplicate cron job for schedule found."),(0,o.jsx)(g.J2,{interactionKind:"hover",popoverClassName:"bp5-popover-content-sizing",position:"right",content:(0,o.jsxs)(a.x,{flex:{direction:"column",gap:8},padding:12,children:[(0,o.jsx)("strong",{children:"There are errors with this schedule."}),(0,o.jsx)("div",{children:"Errors:"}),(0,o.jsx)("ul",{children:n.map((e,t)=>(0,o.jsx)("li",{children:e},t))})]}),children:(0,o.jsx)(R.V,{fill:!0,interactive:!0,intent:"danger",children:"Error"})})};var eo=n(26893),ea=n(88322),ei=n(73235),el=n(14500);n(32549);var ec=n(18328),ed=n(8375),eu=n(41349),eh=n(86253);function ep(){let e=(0,ei._)(["\n  query SingleScheduleQuery($selector: ScheduleSelector!) {\n    scheduleOrError(scheduleSelector: $selector) {\n      ... on Schedule {\n        id\n        name\n        pipelineName\n        description\n        scheduleState {\n          id\n          runningCount\n          hasStartPermission\n          hasStopPermission\n          ticks(limit: 1) {\n            id\n            ...TickTagFragment\n          }\n          runs(limit: 1) {\n            id\n            ...RunTimeFragment\n          }\n          nextTick {\n            timestamp\n          }\n        }\n        partitionSet {\n          id\n          name\n        }\n        ...ScheduleSwitchFragment\n      }\n    }\n  }\n\n  ","\n  ","\n  ","\n"]);return ep=function(){return e},e}n(50911);let em="1.2fr 1fr 1fr 76px 148px 210px 92px",ex="60px ".concat(em);(0,I.ZP)(a.x).withConfig({componentId:"sc-a6a9a2ca-0"})(["display:grid;grid-template-columns:",";height:100%;"],e=>{let{$showCheckboxColumn:t}=e;return t?ex:em});let eg=(0,w.Ps)(ep(),ed.dY,eu.$X,eh.J),ef=(0,x.forwardRef)((e,t)=>{var n;let{index:s,name:r,repoAddress:i,checked:l,onToggleChecked:d}=e,u=(0,Y.F)(100),h=(0,w.aM)(eg,{variables:{selector:{repositoryName:i.name,repositoryLocationName:i.location,scheduleName:r}},skip:!u,notifyOnNetworkStatusChange:!0}),p=(0,w.aM)(en.d,{variables:{scheduleSelector:{repositoryName:i.name,repositoryLocationName:i.location,scheduleName:r}},skip:!u});(0,J.C4)(h,J.dT),(0,J.C4)(p,J.dT);let{data:g}=h,f=(0,x.useMemo)(()=>(null==g?void 0:g.scheduleOrError.__typename)!=="Schedule"?null:g.scheduleOrError,[g]),j=null==f?void 0:f.scheduleState,y=(0,x.useMemo)(()=>{if(!j)return{disabled:!0};let{hasStartPermission:e,hasStopPermission:t,status:n}=j;return n!==z.ynu.RUNNING||t?n!==z.ynu.STOPPED||e?{disabled:!1}:{disabled:!0,message:"You do not have permission to start this schedule"}:{disabled:!0,message:"You do not have permission to stop this schedule"}},[j]),S=null==f?void 0:f.scheduleState.ticks[0],v=(null==f?void 0:f.pipelineName)?[{pipelineName:f.pipelineName}]:null,b=(null===(n=p.data)||void 0===n?void 0:n.scheduleOrError.__typename)==="Schedule"?p.data.scheduleOrError.assetSelection:null;return(0,o.jsx)("div",{ref:t,"data-index":s,children:(0,o.jsxs)(F,{border:"bottom",children:[(0,o.jsx)(P.E5,{children:(0,o.jsx)(m.u,{canShow:y.disabled,content:y.message||"",placement:"top",children:(0,o.jsx)(Z.X,{disabled:y.disabled,checked:l,onChange:e=>{if(d&&e.target instanceof HTMLInputElement){let{checked:t}=e.target;d({checked:t,shiftKey:e.nativeEvent instanceof MouseEvent&&e.nativeEvent.getModifierState("Shift")})}}})})}),(0,o.jsx)(P.E5,{children:(0,o.jsx)(a.x,{flex:{direction:"row",gap:8,alignItems:"flex-start",justifyContent:"space-between"},children:(0,o.jsxs)(a.x,{flex:{grow:1,gap:8},children:[f?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(es.M,{repoAddress:i,schedule:f},r),er(f.scheduleState.status,f.scheduleState.runningCount)]}):(0,o.jsx)("div",{style:{width:30}}),(0,o.jsx)($.rU,{to:(0,ec.$U)(i,"/schedules/".concat(r)),children:(0,o.jsx)(V.g,{text:r})})]})})}),(0,o.jsx)(P.E5,{children:f?(0,o.jsxs)(a.x,{flex:{direction:"column",gap:4},children:[(0,o.jsx)(ee,{cronSchedule:f.cronSchedule,executionTimezone:f.executionTimezone}),f.scheduleState.nextTick&&f.scheduleState.status===z.ynu.RUNNING?(0,o.jsx)(c.YS,{children:(0,o.jsxs)("div",{style:{overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%",textOverflow:"ellipsis"},children:["Next tick:\xa0",(0,o.jsx)(eo.v,{timestamp:f.scheduleState.nextTick.timestamp,timezone:f.executionTimezone,timeFormat:{showSeconds:!1,showTimezone:!0}})]})}):null]}):(0,o.jsx)(el.mq,{queryResult:h})}),(0,o.jsx)(P.E5,{children:(0,o.jsx)("div",{children:(0,o.jsx)(G.p,{repoAddress:i,automationType:"schedule",targets:v,assetSelection:b})})}),(0,o.jsx)(P.E5,{children:S?(0,o.jsx)("div",{children:(0,o.jsx)(ea.a,{tick:S,tickResultType:"runs"})}):(0,o.jsx)(el.mq,{queryResult:h})}),(0,o.jsx)(P.E5,{children:(null==f?void 0:f.scheduleState)&&(null==f?void 0:f.scheduleState.runs[0])?(0,o.jsx)(K.Z,{run:f.scheduleState.runs[0],name:r,showButton:!1,showHover:!0,showSummary:!1}):(0,o.jsx)(el.mq,{queryResult:h})})]})})});var ej=n(31188),ey=n(84345);n(53761);var eS=n(65298);function ev(){let e=(0,ei._)(["\n  query SingleSensorQuery($selector: SensorSelector!) {\n    sensorOrError(sensorSelector: $selector) {\n      ... on Sensor {\n        id\n        description\n        name\n        targets {\n          pipelineName\n        }\n        metadata {\n          assetKeys {\n            path\n          }\n        }\n        minIntervalSeconds\n        description\n        sensorState {\n          id\n          runningCount\n          hasStartPermission\n          hasStopPermission\n          ticks(limit: 1) {\n            id\n            ...TickTagFragment\n          }\n          runs(limit: 1) {\n            id\n            ...RunTimeFragment\n          }\n          nextTick {\n            timestamp\n          }\n        }\n        ...SensorSwitchFragment\n      }\n    }\n  }\n\n  ","\n  ","\n  ","\n"]);return ev=function(){return e},e}let ew="1.5fr 180px 1fr 76px 120px 148px 180px",eb="60px ".concat(ew);(0,I.ZP)(a.x).withConfig({componentId:"sc-92b4a7c3-0"})(["display:grid;grid-template-columns:",";height:100%;"],e=>{let{$showCheckboxColumn:t}=e;return t?eb:ew});let eN={[z.dEY.ASSET]:{name:"Asset sensor",icon:"sensors",description:"Asset sensors instigate runs when a materialization occurs"},[z.dEY.AUTO_MATERIALIZE]:{name:"Automation condition sensor",icon:"automation_condition",description:"Automation condition sensors trigger runs based on conditions defined on assets or checks."},[z.dEY.AUTOMATION]:{name:"Automation condition sensor",icon:"automation_condition",description:"Automation condition sensors trigger runs based on conditions defined on assets or checks."},[z.dEY.FRESHNESS_POLICY]:{name:"Freshness policy sensor",icon:"sensors",description:"Freshness sensors check the freshness of assets on each tick, then perform an action in response to that status"},[z.dEY.MULTI_ASSET]:{name:"Multi-asset sensor",icon:"sensors",description:"Multi asset sensors trigger job executions based on multiple asset materialization event streams"},[z.dEY.RUN_STATUS]:{name:"Run status sensor",icon:"sensors",description:"Run status sensors react to run status"},[z.dEY.STANDARD]:{name:"Standard sensor",icon:"sensors",description:null},[z.dEY.UNKNOWN]:{name:"Standard sensor",icon:"sensors",description:null}},eE=(0,w.Ps)(ev(),ed.dY,eu.$X,eS.U),ek=(0,x.forwardRef)((e,t)=>{var n;let{index:s,name:r,repoAddress:i,checked:l,onToggleChecked:c}=e,d=(0,Y.F)(100),u=(0,w.aM)(eE,{variables:{selector:{repositoryName:i.name,repositoryLocationName:i.location,sensorName:r}},skip:!d}),h=(0,w.aM)(ej.Z,{variables:{sensorSelector:{repositoryName:i.name,repositoryLocationName:i.location,sensorName:r}},skip:!d});(0,J.C4)(u,J.dT),(0,J.C4)(h,J.dT);let{data:p}=u,g=(0,x.useMemo)(()=>(null==p?void 0:p.sensorOrError.__typename)!=="Sensor"?null:p.sensorOrError,[p]),f=null==g?void 0:g.sensorState,j=(0,x.useMemo)(()=>{if(!f)return{disabled:!0};let{hasStartPermission:e,hasStopPermission:t,status:n}=f;return n!==z.ynu.RUNNING||t?n!==z.ynu.STOPPED||e?{disabled:!1}:{disabled:!0,message:"You do not have permission to start this sensor"}:{disabled:!0,message:"You do not have permission to stop this sensor"}},[f]),y=null==g?void 0:g.sensorState.ticks[0],S=null==g?void 0:g.sensorType,v=S?eN[S]:null,b=(null===(n=h.data)||void 0===n?void 0:n.sensorOrError.__typename)==="Sensor"?h.data.sensorOrError.assetSelection:null;return(0,o.jsx)("div",{ref:t,"data-index":s,children:(0,o.jsxs)(F,{border:"bottom",children:[(0,o.jsx)(P.E5,{children:(0,o.jsx)(m.u,{canShow:j.disabled,content:j.message||"",placement:"top",children:(0,o.jsx)(Z.X,{disabled:j.disabled,checked:l,onChange:e=>{if(c&&e.target instanceof HTMLInputElement){let{checked:t}=e.target;c({checked:t,shiftKey:e.nativeEvent instanceof MouseEvent&&e.nativeEvent.getModifierState("Shift")})}}})})}),(0,o.jsx)(P.E5,{children:(0,o.jsx)(a.x,{flex:{direction:"row",gap:8,alignItems:"flex-start",justifyContent:"space-between"},children:(0,o.jsxs)(a.x,{flex:{grow:1,gap:8},children:[g?(0,o.jsx)(ey.c,{repoAddress:i,sensor:g},r):(0,o.jsx)("div",{style:{width:30}}),(0,o.jsx)($.rU,{to:(0,ec.$U)(i,"/sensors/".concat(r)),children:(0,o.jsx)(V.g,{text:r})})]})})}),(0,o.jsx)(P.E5,{children:(0,o.jsx)("div",{children:v?v.description?(0,o.jsx)(m.u,{content:(0,o.jsx)("div",{style:{maxWidth:"300px"},children:v.description}),placement:"top",children:(0,o.jsx)(R.V,{icon:v.icon,children:v.name})}):(0,o.jsx)(R.V,{icon:v.icon,children:v.name}):null})}),(0,o.jsx)(P.E5,{children:g?(0,o.jsx)("div",{children:(0,o.jsx)(G.p,{targets:g.targets||null,repoAddress:i,assetSelection:b,automationType:g.sensorType})}):(0,o.jsx)(el.mq,{queryResult:h})}),(0,o.jsx)(P.E5,{children:y?(0,o.jsx)("div",{children:(0,o.jsx)(ea.a,{tick:y,tickResultType:"runs"})}):(0,o.jsx)(el.mq,{queryResult:u})}),(0,o.jsx)(P.E5,{children:(null==g?void 0:g.sensorState)&&(null==g?void 0:g.sensorState.runs[0])?(0,o.jsx)(K.Z,{run:g.sensorState.runs[0],name:r,showButton:!1,showHover:!0,showSummary:!1}):(0,o.jsx)(el.mq,{queryResult:u})})]})})});var eC=n(9774),eT=n(27450);let eA=(e,t)=>"".concat((0,eT.Uz)(e),"-").concat(t);var eM=n(29134),ez=n(81942);let e_=e=>{let{repos:t,headerCheckbox:n,checkedKeys:s,onToggleCheckFactory:r}=e,i=x.useRef(null),l=x.useMemo(()=>t.map(e=>{let{repoAddress:t}=e;return(0,eT.Uz)(t)}),[t]),{expandedKeys:c,onToggle:d,onToggleAll:u}=(0,ez.N)(eC.y,l),h=x.useMemo(()=>{let e=[];return t.forEach(t=>{let{repoAddress:n,schedules:s,sensors:r}=t;e.push({type:"header",repoAddress:n,scheduleCount:s.length,sensorCount:r.length});let o=(0,eT.Uz)(n);if(c.includes(o)){let t=new Set(r),o=new Set(s);[...r,...s].sort((e,t)=>b.Bl.compare(e,t)).forEach(s=>{t.has(s)?e.push({type:"sensor",repoAddress:n,sensor:s}):o.has(s)&&e.push({type:"schedule",repoAddress:n,schedule:s})})}}),e},[t,c]),p=(0,eM.w)(t.map(e=>{let{repoAddress:t}=e;return t.name})),g=(0,L.MG)({count:h.length,getScrollElement:()=>i.current,estimateSize:e=>{let t=h[e];return(null==t?void 0:t.type)==="header"?32:64},overscan:15}),f=g.getTotalSize(),j=g.getVirtualItems();return(0,o.jsx)("div",{style:{overflow:"hidden"},children:(0,o.jsxs)(P.W2,{ref:i,children:[(0,o.jsx)(D,{checkbox:n}),(0,o.jsx)(P.Nh,{$totalHeight:f,children:j.map(e=>{let{index:t,key:n,size:i,start:l}=e,x=h[t],f=x.type;if("header"===f)return(0,o.jsx)(U.X2,{$height:i,$start:l,children:(0,o.jsx)(el._$,{repoAddress:x.repoAddress,ref:g.measureElement,index:t,onToggle:d,onToggleAll:u,expanded:c.includes((0,eT.Uz)(x.repoAddress)),showLocation:p.has(x.repoAddress.name),rightElement:(0,o.jsxs)(a.x,{flex:{direction:"row",gap:4},children:[(0,o.jsx)(m.u,{content:1===x.sensorCount?"1 sensor":"".concat(x.sensorCount," sensors"),placement:"top",children:(0,o.jsx)(R.V,{icon:"sensors",children:x.sensorCount})}),(0,o.jsx)(m.u,{content:1===x.scheduleCount?"1 schedule":"".concat(x.scheduleCount," schedules"),placement:"top",children:(0,o.jsx)(R.V,{icon:"schedule",children:x.scheduleCount})})]})},n)},n);if("sensor"===f){let e=eA(x.repoAddress,x.sensor);return(0,o.jsx)(U.X2,{$height:i,$start:l,children:(0,o.jsx)(ek,{index:t,ref:g.measureElement,name:x.sensor,checked:s.has(e),onToggleChecked:r(e),repoAddress:x.repoAddress},n)},n)}if("schedule"===f){let e=eA(x.repoAddress,x.schedule);return(0,o.jsx)(U.X2,{$height:i,$start:l,children:(0,o.jsx)(ef,{index:t,ref:g.measureElement,name:x.schedule,checked:s.has(e),onToggleChecked:r(e),repoAddress:x.repoAddress},n)},n)}return(0,o.jsx)("div",{},n)})})]})})};var eO=n(96798),eU=n(93781),eR=n(22710),eL=n(49278);let eI=e=>e.hasStartPermission&&e.status===z.ynu.STOPPED||e.hasStopPermission&&e.status===z.ynu.RUNNING;var eP=n(39916),eq=n(39282),eD=n(12286),eF=n(40299),eY=n(3855),eZ=n(813),eV=n(69135),e$=n(30733),eG=n.n(e$);n(33766);var eJ=n(76188),eK=n(60228);let eW=[],eX=e=>{let{allTags:t,tags:n,setTags:s}=e,r=(0,x.useMemo)(()=>null==n?void 0:n.map(eQ),[n]);return(0,eF.im)({...eB,allValues:(0,x.useMemo)(()=>t.map(e=>({value:e,match:[e.key+":"+e.value]})),[t]),menuWidth:"300px",state:null!=r?r:eW,onStateChanged:e=>{let t=Array.from(e);null==s||s(t)},canSelectAll:!1})},eH=e=>{let{allTags:t}=e,[n,s]=(0,eR.q)({queryKey:"tags"});return eX({allTags:t,tags:n,setTags:s})},eQ=eG()(e=>e,e=>[e.key,e.value].join("|@-@|")),eB={name:"Tag",icon:"tag",renderLabel:e=>{let{value:t}=e;return(0,o.jsx)(eJ.rd,{text:(0,eK.w)({key:t.key,value:t.value})})},getStringValue:e=>{let{value:t,key:n}=e;return"".concat(n,": ").concat(t)},matchType:"all-of"},e0=()=>{let[e,t]=(0,eR.q)({encode:e=>({instigationStatus:e.size?Array.from(e).join(","):void 0}),decode:e=>{let t=e.instigationStatus;return"string"==typeof t?new Set(t.split(",")):new Set}});return(0,eF.im)({name:"Running state",icon:"toggle_off",allValues:[{value:z.ynu.RUNNING,match:["on","running"]},{value:z.ynu.STOPPED,match:["off","stopped"]}],getKey:e=>e,renderLabel:e=>{let{value:t}=e;return(0,o.jsx)("span",{children:t===z.ynu.RUNNING?"Running":"Stopped"})},state:e,onStateChanged:t,getStringValue:e=>e})};var e1=n(630),e2=n(91987);(s=r||(r={})).Schedules="schedules",s.Sensors="sensors";let e8={schedules:{label:"Schedules",value:{type:"schedules",label:"Schedules"},match:["schedules"]},sensors:{label:"Sensors",value:{type:"sensors",label:"Sensors"},match:["sensors"]}},e5=Object.values(e8),e3=new Set(Object.values(r)),e4=()=>{var e;(0,eO.Px)(),(0,eU.j)("Automation");let{allRepos:t,visibleRepos:n,loading:s,data:r}=(0,x.useContext)(e1.C5),[g,f]=(0,eR.q)({queryKey:"search",defaults:{search:""}}),[j,y]=(0,eR.q)({encode:e=>({automationType:e.size?Array.from(e).join(","):void 0}),decode:e=>"string"==typeof e.automationType?new Set(e.automationType.split(",").filter(e=>e3.has(e))):new Set}),S=(0,x.useMemo)(()=>new Set(Array.from(j).map(e=>e8[e].value)),[j]),v=(0,eV.A)(),w=e0(),b=(0,eF.im)({name:"Automation type",allValues:e5,icon:"automation_condition",getStringValue:e=>e.label,state:S,renderLabel:e=>{let{value:t}=e;return(0,o.jsx)("span",{children:t.label})},onStateChanged:e=>{y(new Set(Array.from(e).map(e=>e.type)))}}),N=(0,x.useMemo)(()=>{let e=Object.values(r).filter(e=>"WorkspaceLocationEntry"===e.__typename),t=(0,eq.S)(n);return e6(e).filter(e=>{let{repoAddress:n}=e;return t.has((0,eT.Uz)(n))})},[r,n]),E=eH({allTags:(e=(0,x.useCallback)(e=>[...e.schedules.flatMap(e=>e.tags),...e.sensors.flatMap(e=>e.tags)],[]),(0,x.useMemo)(()=>Array.from(new Set(N.flatMap(t=>{var n;return null!==(n=e(t).map(e=>JSON.stringify(e)))&&void 0!==n?n:[]}).filter(e=>e))).map(e=>eQ(JSON.parse(e))).sort((e,t)=>0===e.key.localeCompare(t.key)?e.value.localeCompare(t.value):e.key.localeCompare(t.key)),[N,e]))}),{state:k}=E,C=(0,x.useMemo)(()=>[v,w,b,E],[v,w,b,E]),{button:T,activeFiltersJsx:A}=(0,eD.m)({filters:C}),{state:M}=w,z=(0,x.useMemo)(()=>N.map(e=>{let{sensors:t,schedules:n,...s}=e;return{...s,sensors:t.filter(e=>{let{sensorState:t,tags:n}=e;return(!k.size||!!(0,eZ.w)(Array.from(k),n))&&(!M.size||!!M.has(t.status))&&(!j.size||!!j.has("sensors"))}),schedules:n.filter(e=>{let{scheduleState:t,tags:n}=e;return(!k.size||!!(0,eZ.w)(Array.from(k),n))&&(!M.size||!!M.has(t.status))&&(!j.size||!!j.has("schedules"))})}}),[N,k,M,j]),_=g.trim().toLocaleLowerCase(),U=_.length>0,R=(0,x.useMemo)(()=>{let e=_.toLocaleLowerCase();return z.map(t=>{let{repoAddress:n,schedules:s,sensors:r}=t;return{repoAddress:n,schedules:s.filter(t=>{let{name:n}=t;return n.toLocaleLowerCase().includes(e)}).map(e=>{let{name:t}=e;return t}),sensors:r.filter(t=>{let{name:n}=t;return n.toLocaleLowerCase().includes(e)}).map(e=>{let{name:t}=e;return t})}}).filter(e=>{let{sensors:t,schedules:n}=e;return t.length>0||n.length>0})},[z,_]),L=(0,x.useMemo)(()=>z.map(e=>{let{repoAddress:t,schedules:n,sensors:s}=e;return[...s.filter(e=>{let{sensorState:t}=e;return eI(t)}).map(e=>{let{name:n,sensorState:s}=e;return{repoAddress:t,name:n,type:"sensor",instigationState:s}}),...n.filter(e=>{let{scheduleState:t}=e;return eI(t)}).map(e=>{let{name:n,scheduleState:s}=e;return{repoAddress:t,name:n,type:"schedule",instigationState:s}})]}).flat(),[z]),I=(0,x.useMemo)(()=>L.map(e=>{let{repoAddress:t,name:n}=e;return eA(t,n)}),[L]),[{checkedIds:P},{onToggleFactory:q,onToggleAll:D}]=(0,eL.a)(I),F=(0,x.useMemo)(()=>{let e=new Set(R.map(e=>{let{repoAddress:t,schedules:n,sensors:s}=e;return[...n,...s].map(e=>eA(t,e))}).flat());return I.filter(t=>e.has(t))},[I,R]),Y=(0,x.useMemo)(()=>{let e=new Set(F.filter(e=>P.has(e)));return L.filter(t=>{let{repoAddress:n,name:s}=t;return e.has(eA(n,s))})},[F,L,P]),Z=I.length>0,V=Y.length,$=F.length>0;return(0,o.jsxs)(a.x,{flex:{direction:"column"},style:{height:"100%",overflow:"hidden"},children:[(0,o.jsx)(h.m,{title:(0,o.jsx)(c.X6,{children:"Automation"})}),(0,o.jsxs)(a.x,{padding:{horizontal:24,vertical:12},flex:{direction:"row",alignItems:"center",justifyContent:"space-between",gap:12,grow:0},children:[(0,o.jsxs)(a.x,{flex:{direction:"row",gap:12},children:[T,(0,o.jsx)(p.oi,{icon:"search",value:g,onChange:e=>f(e.target.value),placeholder:"Filter by name…",style:{width:"340px"}})]}),(0,o.jsx)(m.u,{content:"You do not have permission to start or stop these schedules",canShow:$&&!Z,placement:"top-end",useDisabledButtonTooltipFix:!0,children:(0,o.jsx)(O,{automations:Y})})]}),A.length?(0,o.jsx)(a.x,{padding:{vertical:8,horizontal:24},border:"top-and-bottom",flex:{direction:"row",gap:8},children:A}):null,(()=>{if(s)return(0,o.jsx)(a.x,{flex:{direction:"row",justifyContent:"center"},padding:{top:64},children:(0,o.jsx)(i.f,{label:"Loading automations…"})});let e=t.length>n.length;return R.length?(0,o.jsx)(e_,{headerCheckbox:Z?(0,o.jsx)(eY.W,{checkedCount:V,totalCount:F.length,onToggleAll:D}):void 0,repos:R,checkedKeys:P,onToggleCheckFactory:q}):U?(0,o.jsx)(a.x,{padding:{top:20},children:(0,o.jsx)(l.t,{icon:"search",title:"No matching automations",description:e?(0,o.jsxs)("div",{children:["No automations matching ",(0,o.jsx)("strong",{children:g})," were found in the selected code locations"]}):(0,o.jsxs)("div",{children:["No automations matching ",(0,o.jsx)("strong",{children:g})," were found in your definitions"]})})}):(0,o.jsx)(a.x,{padding:{top:20},children:(0,o.jsx)(l.t,{icon:"search",title:"No automations",description:e?"No automations were found in the selected code locations":(0,o.jsxs)(c.pN,{children:["There are no automations in this deployment."," ",(0,o.jsx)("a",{href:"https://docs.dagster.io/concepts/automation",target:"_blank",rel:"noreferrer",children:(0,o.jsxs)(a.x,{flex:{direction:"row",gap:4,alignItems:"center"},children:["Learn more about automations",(0,o.jsx)(d.JO,{name:"open_in_new",color:u.Es()})]})})]})})})})()]})};var e9=e4;let e6=e=>{let t=e.map(e=>e.locationOrLoadError),n=[];for(let e of t)if((null==e?void 0:e.__typename)==="RepositoryLocation")for(let t of e.repositories){let{name:s,schedules:r,sensors:o}=t,a=(0,e2.kQ)(s,e.name);(o.length>0||r.length>0)&&n.push({repoAddress:a,schedules:r,sensors:o})}return(0,eP.S)(n)}},39916:function(e,t,n){n.d(t,{S:function(){return r}});var s=n(27450);let r=e=>[...e].sort((e,t)=>{let n=(0,s.Uz)(e.repoAddress),r=(0,s.Uz)(t.repoAddress);return n.localeCompare(r)})},39282:function(e,t,n){n.d(t,{S:function(){return o}});var s=n(91987),r=n(27450);let o=e=>new Set(e.map(e=>(0,r.Uz)((0,s.kQ)(e.repository.name,e.repositoryLocation.name))))},69135:function(e,t,n){n.d(t,{A:function(){return d}});var s=n(52322),r=n(2784),o=n(76188),a=n(630),i=n(91987),l=n(27450),c=n(40299);let d=function(){let{codeLocations:e,setCodeLocations:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codeLocations:void 0,setCodeLocations:void 0},{allRepos:n,visibleRepos:s,setVisible:o,setHidden:d}=(0,r.useContext)(a.C5),u=(0,r.useMemo)(()=>n.map(e=>(0,i.kQ)(e.repository.name,e.repositoryLocation.name)),[n]),p=(0,r.useMemo)(()=>s.length===n.length?[]:s.map(e=>(0,i.kQ)(e.repository.name,e.repositoryLocation.name)),[n,s]),m=(0,r.useCallback)(e=>{if(0===e.size){o(u);return}d(u.filter(t=>!e.has(t))),o(Array.from(e))},[u,d,o]);return(0,c.im)({state:e||p,allValues:(0,r.useMemo)(()=>u.map(e=>({value:e,match:[(0,l.Uz)(e)]})),[u]),onStateChanged:e=>{t?t(Array.from(e)):m(e)},menuWidth:"500px",...h})},u=e=>(0,l.Uz)(e),h={name:"Code location",icon:"folder",renderLabel:e=>{let{value:t}=e;return(0,s.jsx)(o.rd,{text:(0,l.Uz)(t)})},getStringValue:u,getKey:u}}}]);
//# sourceMappingURL=1854.81b2e6dfe1208cf7.js.map