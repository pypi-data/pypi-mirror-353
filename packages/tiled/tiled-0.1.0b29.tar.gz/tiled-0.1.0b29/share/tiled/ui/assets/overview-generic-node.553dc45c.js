import{i as A,r as m,_ as v,j as l,b as I,c as N,p as $,d as z,I as O,E as R,O as C,H as G,n as F}from"./index.72e24882.js";import{B as K,s as U}from"./browse.0916686d.js";import{u as T,g as V,a as L,b as E,c as W,G as j,d as H,e as S,f as Z,h as q,i as J,j as Q,D as X}from"./DataGrid.b013c811.js";import{M as Y,b as ee}from"./TextField.8d6efd58.js";import{L as te}from"./ListItemIcon.fcfd88bf.js";import{u as P}from"./FormLabel.a3eda031.js";import"./toPropertyKey.012fc217.js";import"./Input.ed778d26.js";import"./Checkbox.841ff07f.js";import"./FormControlLabel.93f22896.js";const se=["className","children"],oe=e=>{const{classes:a}=e;return $({root:["toolbarContainer"]},V,a)},ne=A("div",{name:"MuiDataGrid",slot:"ToolbarContainer",overridesResolver:(e,a)=>a.toolbarContainer})(({theme:e})=>({display:"flex",alignItems:"center",flexWrap:"wrap",padding:e.spacing(.5,.5,0)})),ae=m.exports.forwardRef(function(a,x){const{className:u,children:s}=a,i=v(a,se),t=T(),o=oe(t);return s?l.exports.jsx(ne,I({ref:x,className:N(u,o.root),ownerState:t},i,{children:s})):null}),re=["onClick"],le=m.exports.forwardRef(function(a,x){var u;const{onClick:s}=a,i=v(a,re),t=L(),o=T(),{open:b,openedPanelValue:y}=E(t,W),n=d=>{b&&y===j.columns?t.current.hidePreferences():t.current.showPreferences(j.columns),s==null||s(d)};return o.disableColumnSelector?null:l.exports.jsx(o.components.BaseButton,I({ref:x,size:"small","aria-label":t.current.getLocaleText("toolbarColumnsLabel"),startIcon:l.exports.jsx(o.components.ColumnSelectorIcon,{})},i,{onClick:n},(u=o.componentsProps)==null?void 0:u.baseButton,{children:t.current.getLocaleText("toolbarColumns")}))}),ie=["onClick"],ce=m.exports.forwardRef(function(a,x){var u;const{onClick:s}=a,i=v(a,ie),t=L(),o=T(),b=E(t,H),y=P(),n=P(),[d,p]=m.exports.useState(!1),f=m.exports.useRef(null),D=z(x,f),c=[{icon:l.exports.jsx(o.components.DensityCompactIcon,{}),label:t.current.getLocaleText("toolbarDensityCompact"),value:S.Compact},{icon:l.exports.jsx(o.components.DensityStandardIcon,{}),label:t.current.getLocaleText("toolbarDensityStandard"),value:S.Standard},{icon:l.exports.jsx(o.components.DensityComfortableIcon,{}),label:t.current.getLocaleText("toolbarDensityComfortable"),value:S.Comfortable}],h=m.exports.useMemo(()=>{switch(b){case S.Compact:return l.exports.jsx(o.components.DensityCompactIcon,{});case S.Comfortable:return l.exports.jsx(o.components.DensityComfortableIcon,{});default:return l.exports.jsx(o.components.DensityStandardIcon,{})}},[b,o]),g=r=>{p(w=>!w),s==null||s(r)},_=r=>{var w;f.current===r.target||(w=f.current)!=null&&w.contains(r.target)||p(!1)},k=r=>{t.current.setDensity(r),p(!1)},B=r=>{J(r.key)&&r.preventDefault(),Q(r.key)&&p(!1)};if(o.disableDensitySelector)return null;const M=c.map((r,w)=>l.exports.jsxs(Y,{onClick:()=>k(r.value),selected:r.value===b,children:[l.exports.jsx(te,{children:r.icon}),r.label]},w));return l.exports.jsxs(m.exports.Fragment,{children:[l.exports.jsx(o.components.BaseButton,I({ref:D,size:"small",startIcon:h,"aria-label":t.current.getLocaleText("toolbarDensityLabel"),"aria-expanded":d?"true":void 0,"aria-haspopup":"menu","aria-controls":n,id:y},i,{onClick:g},(u=o.componentsProps)==null?void 0:u.baseButton,{children:t.current.getLocaleText("toolbarDensity")})),l.exports.jsx(Z,{open:d,target:f.current,onClickAway:_,position:"bottom-start",children:l.exports.jsx(ee,{id:n,className:q.menuList,"aria-labelledby":y,onKeyDown:B,autoFocusItem:d,children:M})})]})});function ue(){return C.createElement(ae,null,C.createElement(le,{}),C.createElement(ce,{}))}const de=10,me=e=>{let a=O();const x=[{field:"id",headerName:"ID",flex:1,hide:!e.defaultColumns.includes("id")}];e.columns.map(n=>x.push({field:n.field,headerName:n.header,flex:1,hide:!e.defaultColumns.includes(n.field)}));const u=m.exports.useContext(R),[s,i]=m.exports.useState({page:0,pageSize:de,rows:[],loading:!1}),[t,o]=m.exports.useState({}),[b,y]=m.exports.useState(0);return m.exports.useEffect(()=>{let n=!0;async function d(){var p,f;const D=new AbortController;e.columns.length===0?(f=[],p=null):(f=["metadata"],p="{"+e.columns.map(g=>`${g.field}:${g.select_metadata}`).join(",")+"}");var c=await U(u.api_url,e.segments,D.signal,f,p,s.pageSize*s.page,s.pageSize);return y(c.meta.count),c.data}return(async()=>{i(c=>({...c,loading:!0}));const p=await d();var f={};p.map(c=>(f[c.id]=c.attributes.ancestors,null));const D=p.map(c=>{const h={};return h.id=c.id,e.columns.map(g=>(h[g.field]=c.attributes.metadata[g.field],null)),h});!n||(o(f),i(c=>({...c,loading:!1,rows:D})))})(),()=>{n=!1}},[s.page,s.pageSize,e.columns,e.segments]),C.createElement(K,{sx:{my:4}},C.createElement(G,{maxWidth:"lg"},C.createElement(X,{columns:x,pagination:!0,rowCount:b,...s,paginationMode:"server",rowsPerPageOptions:[10,30,100],onPageChange:n=>i(d=>({...d,page:n})),onPageSizeChange:n=>{i(d=>({...d,pageSize:n}))},onRowClick:n=>{a(`/browse${t[n.id].map(function(d){return"/"+d}).join("")}/${n.id}`)},components:{Toolbar:ue},disableColumnFilter:!0,autoHeight:!0})))},Se=e=>{const u=(m.exports.useContext(R).specs||[]).find(t=>e.item.data.attributes.specs.includes(t.spec));var s,i;return u===void 0?(s=[],i=["id"]):(s=u.columns,i=u.default_columns),C.createElement(G,{maxWidth:"lg"},C.createElement(F,{id:"table-title",variant:"h6",component:"h2"},"Contents"),C.createElement(me,{segments:e.segments,specs:e.item.data.attributes.specs,columns:s,defaultColumns:i}))};export{Se as default};
