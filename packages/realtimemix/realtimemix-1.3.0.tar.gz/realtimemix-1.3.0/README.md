# realtimemix

![Python](https://img.shields.io/badge/python-3.9+-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Version](https://img.shields.io/badge/version-1.1.1-orange.svg)

ä¸€ä¸ªé«˜æ€§èƒ½çš„Pythonå®æ—¶éŸ³é¢‘æ··éŸ³å¼•æ“ï¼Œä¸“ä¸ºä¸“ä¸šéŸ³é¢‘åº”ç”¨ã€è¯­éŸ³å¤„ç†å’Œå¤šåª’ä½“é¡¹ç›®è®¾è®¡ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸµ å®æ—¶éŸ³é¢‘å¤„ç†
- **ä½å»¶è¿Ÿæ··éŸ³** - å¯é…ç½®ç¼“å†²åŒºå¤§å°ï¼Œæ”¯æŒä¸“ä¸šçº§éŸ³é¢‘å»¶è¿Ÿæ§åˆ¶
- **å¤šè½¨å¹¶è¡Œå¤„ç†** - åŒæ—¶å¤„ç†å¤šè¾¾32+ä¸ªéŸ³é¢‘è½¨é“ï¼Œçº¿ç¨‹å®‰å…¨è®¾è®¡
- **é›¶å»¶è¿Ÿåˆ‡æ¢** - æ”¯æŒç¬æ—¶éŸ³é¢‘åˆ‡æ¢ï¼Œæ— æ·¡å…¥æ·¡å‡ºå»¶è¿Ÿ
- **é«˜è´¨é‡é‡é‡‡æ ·** - é›†æˆlibrosa/scipyé«˜çº§éŸ³é¢‘å¤„ç†ç®—æ³•

### ğŸšï¸ ä¸“ä¸šéŸ³é¢‘åŠŸèƒ½
- **Matcheringé›†æˆ** - å†…ç½®ä¸“ä¸šéŸ³é¢‘åŒ¹é…æŠ€æœ¯ï¼Œè‡ªåŠ¨å‡è¡¡ã€å“åº¦å’Œé¢‘ç‡åŒ¹é…
- **å“åº¦åˆ†æä¸åŒ¹é…** - RMSå“åº¦è®¡ç®—ï¼Œè‡ªåŠ¨éŸ³é‡çº§åˆ«åŒ¹é…
- **äº¤å‰æ·¡å…¥æ·¡å‡º** - ä¸“ä¸šçº§éŸ³é¢‘è¿‡æ¸¡æ•ˆæœ
- **æ¸©å’ŒEQå¤„ç†** - å‡å°‘é‡‘å±éŸ³è‰²çš„æ™ºèƒ½éŸ³é¢‘å¤„ç†

### ğŸ’¾ å¤§æ–‡ä»¶æ”¯æŒ
- **æµå¼æ’­æ”¾** - æ”¯æŒGBçº§å¤§æ–‡ä»¶çš„å†…å­˜é«˜æ•ˆæ’­æ”¾
- **æ™ºèƒ½ç¼“å­˜** - ä¼˜åŒ–çš„ç¼“å†²æ± å’Œå†…å­˜ç®¡ç†
- **å¼‚æ­¥åŠ è½½** - éé˜»å¡éŸ³é¢‘æ–‡ä»¶åŠ è½½ï¼Œæ”¯æŒè¿›åº¦å›è°ƒ
- **é™éŸ³å¡«å……** - ç²¾ç¡®çš„éŸ³é¢‘æ—¶åºæ§åˆ¶å’Œå¯¹é½

### ğŸ”Š éŸ³é¢‘æ•ˆæœä¸æ§åˆ¶
- **å®æ—¶éŸ³é‡æ§åˆ¶** - åŠ¨æ€éŸ³é‡è°ƒèŠ‚ï¼Œæ”¯æŒæ¸å˜æ•ˆæœ
- **å˜é€Ÿæ’­æ”¾** - ä¿æŒéŸ³è°ƒçš„é€Ÿåº¦è°ƒèŠ‚ï¼ˆå¯é€‰pyrubberbandæ”¯æŒï¼‰
- **å¾ªç¯æ’­æ”¾** - æ— ç¼å¾ªç¯ï¼Œæ”¯æŒç²¾ç¡®å¾ªç¯ç‚¹æ§åˆ¶
- **å¤šç§éŸ³é¢‘æ ¼å¼** - é€šè¿‡soundfileæ”¯æŒWAVã€FLACã€MP3ç­‰æ ¼å¼

## ğŸ› ï¸ å®‰è£…

### åŸºç¡€å®‰è£…
```bash
pip install realtimemix
```

### é«˜è´¨é‡éŸ³é¢‘å¤„ç†ï¼ˆæ¨èï¼‰
```bash
pip install realtimemix[high-quality]
```

### Matcheringä¸“ä¸šéŸ³é¢‘åŒ¹é…
```bash
pip install matchering
```

### æ—¶é—´æ‹‰ä¼¸åŠŸèƒ½
```bash
pip install realtimemix[time-stretch]
```

### å®Œæ•´åŠŸèƒ½å®‰è£…
```bash
pip install realtimemix[all]
pip install matchering
```

### å¼€å‘ç¯å¢ƒ
```bash
git clone https://github.com/birchkwok/realtimemix.git
cd realtimemix
pip install -e .[dev]
pip install matchering
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€éŸ³é¢‘æ’­æ”¾

```python
import numpy as np
from realtimemix import AudioEngine

# åˆå§‹åŒ–éŸ³é¢‘å¼•æ“
engine = AudioEngine(
    sample_rate=48000,    # é«˜é‡‡æ ·ç‡
    buffer_size=1024,     # ä½å»¶è¿Ÿç¼“å†²
    channels=2            # ç«‹ä½“å£°
)

# å¯åŠ¨å¼•æ“
engine.start()

# åŠ è½½éŸ³é¢‘æ–‡ä»¶
engine.load_track("background", "music.wav", auto_normalize=True)
engine.load_track("voice", "speech.wav")

# æ’­æ”¾æ§åˆ¶
engine.play("background", loop=True, fade_in=True)
engine.play("voice", volume=0.8)

# å®æ—¶æ§åˆ¶
engine.set_volume("background", 0.3)  # é™ä½èƒŒæ™¯éŸ³ä¹
engine.crossfade("background", "voice", duration=1.5)  # äº¤å‰æ·¡å…¥æ·¡å‡º

# æ¸…ç†
engine.shutdown()
```

### ä¸“ä¸šéŸ³é¢‘åŒ¹é…ï¼ˆMatcheringï¼‰

```python
from realtimemix import AudioEngine

engine = AudioEngine()
engine.start()

# 1. åŠ è½½ä¸»éŸ³è½¨ï¼ˆå‚è€ƒéŸ³è½¨ï¼‰
engine.load_track("main_audio", "ä¸»éŸ³é¢‘.wav")

# 2. ä½¿ç”¨MatcheringåŠ è½½å¹¶åŒ¹é…å‰¯éŸ³è½¨
success = engine.load_track_with_matchering(
    track_id="sub_audio",
    file_path="å‰¯éŸ³é¢‘.wav",
    reference_track_id="main_audio",
    reference_start_sec=10.0,      # ä»ä¸»éŸ³é¢‘10ç§’å¤„å¼€å§‹å‚è€ƒ
    reference_duration_sec=5.0,    # å‚è€ƒ5ç§’ç‰‡æ®µ
    gentle_matchering=True         # ä½¿ç”¨æ¸©å’Œå¤„ç†å‡å°‘é‡‘å±éŸ³è‰²
)

if success:
    # æ’­æ”¾åŒ¹é…åçš„éŸ³é¢‘ï¼ŒéŸ³è´¨å’Œå“åº¦å·²è‡ªåŠ¨åŒ¹é…
    engine.play("main_audio")
    # åœ¨åˆé€‚æ—¶æœºåˆ‡æ¢åˆ°å‰¯éŸ³è½¨ï¼ŒéŸ³è´¨å®Œç¾è¡”æ¥
    engine.crossfade("main_audio", "sub_audio", duration=0.1)

engine.shutdown()
```

### è¯­éŸ³æ— ç¼èåˆåº”ç”¨

```python
from realtimemix import AudioEngine

class SpeechFusion:
    def __init__(self):
        self.engine = AudioEngine(sample_rate=48000, channels=2)
        self.engine.start()
    
    def fuse_speech(self, main_file: str, insert_file: str, insert_at: float):
        """åœ¨æŒ‡å®šæ—¶é—´ç‚¹æ— ç¼æ’å…¥è¯­éŸ³ç‰‡æ®µ"""
        
        # åŠ è½½ä¸»è¯­éŸ³
        self.engine.load_track("main", main_file)
        
        # ä½¿ç”¨MatcheringåŠ è½½æ’å…¥è¯­éŸ³ï¼Œè‡ªåŠ¨åŒ¹é…ä¸»è¯­éŸ³ç‰¹å¾
        success = self.engine.load_track_with_matchering(
            track_id="insert",
            file_path=insert_file,
            reference_track_id="main",
            reference_start_sec=insert_at,
            reference_duration_sec=3.0,
            silent_lpadding_ms=100  # 100mså‰ç½®é™éŸ³å¯¹é½
        )
        
        if success:
            # æ’­æ”¾ä¸»è¯­éŸ³åˆ°åˆ‡æ¢ç‚¹
            self.engine.play("main")
            self._wait_to_position(insert_at)
            
            # é›¶å»¶è¿Ÿç¬æ—¶åˆ‡æ¢
            self.engine.set_volume("main", 0.0)
            self.engine.play("insert", volume=0.8)
            
            # æ’å…¥è¯­éŸ³æ’­æ”¾å®Œæ¯•åæ¢å¤ä¸»è¯­éŸ³
            insert_duration = self._get_track_duration("insert")
            self._wait_duration(insert_duration)
            self.engine.set_volume("insert", 0.0)
            self.engine.set_volume("main", 0.8)
    
    def _wait_to_position(self, seconds: float):
        import time
        time.sleep(seconds)
    
    def _wait_duration(self, seconds: float):
        import time
        time.sleep(seconds)
    
    def _get_track_duration(self, track_id: str) -> float:
        info = self.engine.get_track_info(track_id)
        return info.get('duration', 0.0) if info else 0.0

# ä½¿ç”¨ç¤ºä¾‹
fusion = SpeechFusion()
fusion.fuse_speech("é•¿ç¯‡è¯­éŸ³.wav", "æ’å…¥ç‰‡æ®µ.wav", insert_at=30.0)
```

### å¤§æ–‡ä»¶æµå¼æ’­æ”¾

```python
from realtimemix import AudioEngine

# é’ˆå¯¹å¤§æ–‡ä»¶ä¼˜åŒ–çš„é…ç½®
engine = AudioEngine(
    enable_streaming=True,
    streaming_threshold_mb=50,    # 50MBä»¥ä¸Šå¯ç”¨æµå¼æ’­æ”¾
    max_tracks=8                  # é™åˆ¶å¹¶å‘è½¨é“æ•°
)

engine.start()

# åŠ è½½å¤§æ–‡ä»¶ï¼ˆè‡ªåŠ¨å¯ç”¨æµå¼æ’­æ”¾ï¼‰
def on_progress(track_id, progress, message=""):
    print(f"åŠ è½½è¿›åº¦ {track_id}: {progress:.1%} - {message}")

def on_complete(track_id, success, error=None):
    if success:
        print(f"å¤§æ–‡ä»¶ {track_id} åŠ è½½æˆåŠŸï¼Œå¼€å§‹æ’­æ”¾")
        engine.play(track_id)
    else:
        print(f"åŠ è½½å¤±è´¥: {error}")

engine.load_track(
    "large_audio", 
    "å¤§éŸ³é¢‘æ–‡ä»¶.wav",
    progress_callback=on_progress,
    on_complete=on_complete
)

# å¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
print("ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡...")
```

## ğŸ“š æ ¸å¿ƒAPIå‚è€ƒ

### AudioEngine

#### æ„é€ å‡½æ•°

```python
AudioEngine(
    sample_rate=48000,           # é‡‡æ ·ç‡
    buffer_size=1024,            # ç¼“å†²åŒºå¤§å°
    channels=2,                  # å£°é“æ•°
    max_tracks=32,               # æœ€å¤§è½¨é“æ•°
    device=None,                 # éŸ³é¢‘è®¾å¤‡
    stream_latency='low',        # å»¶è¿Ÿçº§åˆ«
    enable_streaming=True,       # å¯ç”¨æµå¼æ’­æ”¾
    streaming_threshold_mb=100   # æµå¼æ’­æ”¾é˜ˆå€¼
)
```

#### æ ¸å¿ƒæ–¹æ³•

##### éŸ³è½¨ç®¡ç†

```python
# åŸºç¡€åŠ è½½
load_track(track_id, source, speed=1.0, auto_normalize=True, 
          silent_lpadding_ms=0.0, on_complete=None)

# Matcheringä¸“ä¸šåŒ¹é…åŠ è½½
load_track_with_matchering(track_id, file_path, reference_track_id,
                          reference_start_sec, reference_duration_sec=10.0,
                          gentle_matchering=True)

# å¸è½½éŸ³è½¨
unload_track(track_id)

# æ¸…é™¤æ‰€æœ‰éŸ³è½¨
clear_all_tracks()
```

##### æ’­æ”¾æ§åˆ¶

```python
# æ’­æ”¾
play(track_id, fade_in=False, loop=False, seek=None, volume=None)

# å®šæ—¶æ’­æ”¾
play_for_duration(track_id, duration_sec, fade_in=False, fade_out=True)

# åœæ­¢
stop(track_id, fade_out=True, delay_sec=0.0)

# æš‚åœ/æ¢å¤
pause(track_id)
resume(track_id)
```

##### éŸ³é¢‘æ•ˆæœ

```python
# éŸ³é‡æ§åˆ¶
set_volume(track_id, volume)

# é€Ÿåº¦æ§åˆ¶
set_speed(track_id, speed)

# äº¤å‰æ·¡å…¥æ·¡å‡º
crossfade(from_track, to_track, duration=1.0)

# å“åº¦åŒ¹é…
match_loudness(track1_id, track2_id, target_loudness=0.7)
```

##### çŠ¶æ€æŸ¥è¯¢

```python
# è·å–è½¨é“ä¿¡æ¯
get_track_info(track_id)

# æ’­æ”¾çŠ¶æ€
is_track_playing(track_id)
is_track_paused(track_id)

# è·å–æ’­æ”¾ä¸­çš„è½¨é“
get_playing_tracks()
```

## ğŸ¯ åº”ç”¨åœºæ™¯

### ğŸ™ï¸ è¯­éŸ³å¤„ç†
- **æ’­å®¢åˆ¶ä½œ** - å¤šäººè¯­éŸ³æ··éŸ³ï¼Œæ™ºèƒ½å“åº¦åŒ¹é…
- **æœ‰å£°ä¹¦åˆ¶ä½œ** - ç« èŠ‚é—´æ— ç¼åˆ‡æ¢ï¼ŒèƒŒæ™¯éŸ³ä¹èåˆ
- **é…éŸ³å·¥ç¨‹** - è§’è‰²è¯­éŸ³æ›¿æ¢ï¼ŒéŸ³è´¨è‡ªåŠ¨åŒ¹é…
- **è¯­éŸ³åˆæˆ** - TTSè¯­éŸ³ä¸çœŸäººè¯­éŸ³çš„è‡ªç„¶èåˆ

### ğŸµ éŸ³ä¹åˆ¶ä½œ
- **ç°åœºæ¼”å‡º** - å®æ—¶éŸ³é¢‘æ··éŸ³ï¼Œä½å»¶è¿Ÿç›‘å¬
- **éŸ³ä¹åˆ¶ä½œ** - å¤šè½¨å½•éŸ³ï¼Œä¸“ä¸šéŸ³é¢‘å¤„ç†
- **DJæ··éŸ³** - BPMåŒæ­¥ï¼Œäº¤å‰æ·¡å…¥æ·¡å‡º
- **éŸ³é¢‘æ¯å¸¦å¤„ç†** - Matcheringä¸“ä¸šéŸ³è´¨åŒ¹é…

### ğŸ® æ¸¸æˆå¼€å‘
- **èƒŒæ™¯éŸ³ä¹ç³»ç»Ÿ** - åŠ¨æ€éŸ³ä¹åˆ‡æ¢ï¼Œæƒ…å¢ƒéŸ³æ•ˆ
- **3Dç©ºé—´éŸ³é¢‘** - ä½ç½®éŸ³æ•ˆï¼Œç¯å¢ƒå£°æ¨¡æ‹Ÿ
- **è¯­éŸ³èŠå¤©** - å®æ—¶è¯­éŸ³å¤„ç†ï¼Œé™å™ªä¼˜åŒ–
- **éŸ³æ•ˆå¼•æ“** - å¤šå±‚éŸ³æ•ˆæ··åˆï¼Œæ€§èƒ½ä¼˜åŒ–

### ğŸ“º å¤šåª’ä½“åº”ç”¨
- **è§†é¢‘é…éŸ³** - è‡ªåŠ¨éŸ³è§†é¢‘åŒæ­¥ï¼Œå“åº¦æ ‡å‡†åŒ–
- **ç›´æ’­ç³»ç»Ÿ** - å®æ—¶éŸ³é¢‘å¤„ç†ï¼Œå¤šæºæ··éŸ³
- **æ•™è‚²è½¯ä»¶** - äº’åŠ¨éŸ³é¢‘ï¼Œè¯­éŸ³è¯†åˆ«é›†æˆ
- **ä¼šè®®ç³»ç»Ÿ** - å¤šäººè¯­éŸ³å¤„ç†ï¼Œå›å£°æ¶ˆé™¤

## ğŸ”§ é«˜çº§é…ç½®

### æ€§èƒ½ä¼˜åŒ–

```python
# ä½å»¶è¿Ÿé…ç½®ï¼ˆä¸“ä¸šéŸ³é¢‘ï¼‰
engine = AudioEngine(
    sample_rate=96000,      # é«˜é‡‡æ ·ç‡
    buffer_size=256,        # æå°ç¼“å†²åŒº
    channels=2,
    stream_latency='low',
    max_tracks=16
)

# å¤§æ–‡ä»¶å¤„ç†é…ç½®
engine = AudioEngine(
    enable_streaming=True,
    streaming_threshold_mb=25,  # æ›´ç§¯æçš„æµå¼æ’­æ”¾
    buffer_size=2048,          # æ›´å¤§ç¼“å†²åŒº
    max_tracks=4               # é™åˆ¶å¹¶å‘æ•°
)

# ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–é…ç½®
engine = AudioEngine(
    sample_rate=44100,     # æ ‡å‡†é‡‡æ ·ç‡
    buffer_size=1024,      # å¹³è¡¡å»¶è¿Ÿå’Œæ€§èƒ½
    channels=2,
    max_tracks=8,          # é™åˆ¶èµ„æºä½¿ç”¨
    stream_latency='medium'
)
```

### Matcheringé«˜çº§è®¾ç½®

```python
# æ¸©å’Œå¤„ç†ï¼ˆæ¨èç”¨äºè¯­éŸ³ï¼‰
engine.load_track_with_matchering(
    track_id="speech",
    file_path="voice.wav", 
    reference_track_id="main",
    reference_start_sec=15.0,
    gentle_matchering=True        # å‡å°‘é‡‘å±éŸ³è‰²
)

# æ ‡å‡†å¤„ç†ï¼ˆç”¨äºéŸ³ä¹ï¼‰
engine.load_track_with_matchering(
    track_id="music",
    file_path="song.wav",
    reference_track_id="main", 
    reference_start_sec=30.0,
    reference_duration_sec=15.0,  # æ›´é•¿å‚è€ƒç‰‡æ®µ
    gentle_matchering=False       # æ ‡å‡†EQå¤„ç†
)
```

## ğŸ“Š æ€§èƒ½ç‰¹å¾

- **å»¶è¿Ÿæ€§èƒ½**: æœ€ä½ ~5msï¼ˆ256å¸§ç¼“å†²åŒº@48kHzï¼‰
- **å†…å­˜æ•ˆç‡**: æµå¼æ’­æ”¾æ”¯æŒGBçº§æ–‡ä»¶ï¼Œå†…å­˜å ç”¨<100MB
- **CPUåˆ©ç”¨ç‡**: å¤šçº¿ç¨‹ä¼˜åŒ–ï¼Œå…¸å‹å ç”¨<10%ï¼ˆ8è½¨æ··éŸ³ï¼‰
- **æ”¯æŒæ ¼å¼**: WAV, FLAC, MP3, M4A, OGGç­‰ï¼ˆé€šè¿‡soundfileï¼‰
- **é‡‡æ ·ç‡èŒƒå›´**: 8kHz - 192kHz
- **ä½æ·±æ”¯æŒ**: 16-bit, 24-bit, 32-bitï¼ˆæ•´æ•°å’Œæµ®ç‚¹ï¼‰

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**å¯¼å…¥é”™è¯¯**: 
```bash
# ç¡®ä¿å®‰è£…äº†æ‰€æœ‰ä¾èµ–
pip install realtimemix[all]
pip install matchering
```

**éŸ³é¢‘è®¾å¤‡é—®é¢˜**:
```python
# åˆ—å‡ºå¯ç”¨è®¾å¤‡
import sounddevice as sd
print(sd.query_devices())

# æŒ‡å®šè®¾å¤‡
engine = AudioEngine(device=1)  # ä½¿ç”¨è®¾å¤‡1
```

**Matcheringå¤„ç†å¤±è´¥**:
```python
# æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æ ¼å¼å’Œé•¿åº¦
# ç¡®ä¿å‚è€ƒç‰‡æ®µè‡³å°‘1ç§’ä»¥ä¸Š
# é¿å…ä½¿ç”¨å®Œå…¨é™éŸ³çš„å‚è€ƒç‰‡æ®µ
```

**å†…å­˜ä¸è¶³**:
```python
# å¯ç”¨æµå¼æ’­æ”¾
engine = AudioEngine(
    enable_streaming=True,
    streaming_threshold_mb=50
)
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·æŸ¥çœ‹[è´¡çŒ®æŒ‡å—](https://github.com/birchkwok/realtimemix/blob/main/CONTRIBUTING.md)ã€‚

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
git clone https://github.com/birchkwok/realtimemix.git
cd realtimemix
pip install -e .[dev]
pip install matchering

# è¿è¡Œæµ‹è¯•
pytest tests/ -v

# ä»£ç æ ¼å¼åŒ–
black realtimemix/
flake8 realtimemix/
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MITè®¸å¯è¯](LICENSE)ã€‚

## ğŸ™ è‡´è°¢

- [sounddevice](https://github.com/spatialaudio/python-sounddevice) - è·¨å¹³å°éŸ³é¢‘I/O
- [soundfile](https://github.com/bastibe/python-soundfile) - éŸ³é¢‘æ–‡ä»¶è¯»å†™
- [librosa](https://github.com/librosa/librosa) - é«˜è´¨é‡éŸ³é¢‘å¤„ç†
- [matchering](https://github.com/sergree/matchering) - ä¸“ä¸šéŸ³é¢‘åŒ¹é…æŠ€æœ¯
- [numpy](https://github.com/numpy/numpy) - é«˜æ€§èƒ½æ•°å€¼è®¡ç®—

---

**RealtimeMix** - è®©éŸ³é¢‘å¤„ç†å˜å¾—ç®€å•è€Œä¸“ä¸š ğŸµ

