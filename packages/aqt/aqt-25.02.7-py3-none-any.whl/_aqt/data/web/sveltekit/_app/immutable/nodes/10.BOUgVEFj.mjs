var Gt=Object.defineProperty;var Vt=(a,t,e)=>t in a?Gt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var k=(a,t,e)=>Vt(a,typeof t!="symbol"?t+"":t,e);import{j as Pt,k as Ut,m as xt,n as Wt,o as qt,C as et,p as ht,q as Ot,s as Bt}from"../chunks/backend.CuvxjHSt.mjs";import{ax as Yt,ay as Ct,az as Rt,aA as Jt,aB as Kt,aC as Qt,aD as Xt,aE as Zt,aF as te,aG as ee,aH as ae,aI as le,aJ as se,aK as oe,aL as re,aM as ie,aN as ne,aO as ue,aP as de,aQ as ce,aR as wt,aS as pe,aT as me,aU as ve,aV as fe,aW as ge,aX as $e,aY as he,aZ as be,a_ as ye,a$ as _e,J as Tt}from"../chunks/runtime-require.ClQzQQRm.mjs";import{w as mt,r as St}from"../chunks/index.BmKPAsrv.mjs";import{c as ot}from"../chunks/cloneDeep.CIeA7YEG.mjs";import{i as pt,S as ke}from"../chunks/Select.D1WFSjx-.mjs";import{t as W,a as p,b as R,c as yt}from"../chunks/disclose-version.CZXCSga2.mjs";import{i as Q}from"../chunks/legacy.Cvgq_wkp.mjs";import{p as X,l as _t,a as jt,f as x,t as z,g as u,b as Z,n as q,r as S,N as M,m as J,s as K,M as kt,E as N,aD as E,c as rt}from"../chunks/runtime.NF8NW0fQ.mjs";import{p as D,i as Nt}from"../chunks/props.C4_rjmFK.mjs";import{R as ut}from"../chunks/Row.BoykZ5Sj.mjs";import{I as Ne}from"../chunks/ImportPage.vfhX8vHS.mjs";import{a as Ce}from"../chunks/await.Rd555UKU.mjs";import{e as vt,i as ft}from"../chunks/theme.DvYw8rH4.mjs";import{a as A,s as dt,q as B,b as F,p as zt,r as At}from"../chunks/store.CrzbHEEA.mjs";import{T as It}from"../chunks/TitledContainer.e0Zsj5mE.mjs";import{c as at}from"../chunks/Container.C0RC8RQ7.mjs";import{C as gt}from"../chunks/Col.CeswaxYB.mjs";import{H as L,E as nt,a as Y,S as Ie,b as Ft,C as Pe,R as Oe}from"../chunks/EnumSelectorRow.BCzJKMB7.mjs";import{W as we}from"../chunks/Warning.DegpN-vE.mjs";import{T as Te}from"../chunks/TagEditor.BT-G9fQ_.mjs";function Mt(){}function tt(a){return a.notetype.case==="globalNotetype"?a.notetype.value:null}function bt(a){return a.deck.case==="deckId"?a.deck.value:null}class Se{constructor(t,e,l,s){k(this,"path");k(this,"deckNameIds");k(this,"notetypeNameIds");k(this,"defaultDelimiter");k(this,"defaultIsHtml");k(this,"defaultNotetypeId");k(this,"defaultDeckId");k(this,"metadata");k(this,"globalNotetype");k(this,"deckId");k(this,"fieldNames");k(this,"columnOptions");k(this,"lastMetadata");k(this,"lastGlobalNotetype");k(this,"lastDeckId");k(this,"fieldNamesSetter",Mt);k(this,"columnOptionsSetter",Mt);var i;this.path=t,this.deckNameIds=l.entries,this.notetypeNameIds=e.entries,this.lastMetadata=ot(s),this.metadata=mt(s),this.metadata.subscribe(this.onMetadataChanged.bind(this));const o=tt(s);this.lastGlobalNotetype=ot(tt(s)),this.globalNotetype=mt(ot(o)),this.globalNotetype.subscribe(this.onGlobalNotetypeChanged.bind(this)),this.lastDeckId=bt(s),this.deckId=mt(bt(s)),this.deckId.subscribe(this.onDeckIdChanged.bind(this)),this.fieldNames=St(o===null?Promise.resolve([]):Pt({ntid:o.id}).then(r=>r.vals),r=>{this.fieldNamesSetter=r}),this.columnOptions=St(Dt(s),r=>{this.columnOptionsSetter=r}),this.defaultDelimiter=s.delimiter,this.defaultIsHtml=s.isHtml,this.defaultNotetypeId=((i=this.lastGlobalNotetype)==null?void 0:i.id)||null,this.defaultDeckId=this.lastDeckId}doImport(){return Ut({path:this.path,metadata:{...this.lastMetadata,preview:[]}},{alertOnError:!1})}async onMetadataChanged(t){var s,o,i;if(pt(t,this.lastMetadata))return;const e=this.shouldRefetchMetadata(t);e&&(t=await xt({path:this.path,delimiter:t.delimiter,notetypeId:(s=tt(t))==null?void 0:s.id,deckId:(o=bt(t))!=null?o:void 0,isHtml:t.isHtml}));const l=tt(t);this.globalNotetype.set(l),l!==null&&l.id!==((i=tt(this.lastMetadata))==null?void 0:i.id)&&this.fieldNamesSetter(Pt({ntid:l.id}).then(r=>r.vals)),this.shouldRebuildColumnOptions(t)&&this.columnOptionsSetter(Dt(t)),this.lastMetadata=ot(t),e&&this.metadata.set(t)}shouldRefetchMetadata(t){var e,l;return t.delimiter!==this.lastMetadata.delimiter||t.isHtml!==this.lastMetadata.isHtml||((e=tt(t))==null?void 0:e.id)!==((l=tt(this.lastMetadata))==null?void 0:l.id)}shouldRebuildColumnOptions(t){return!pt(t.columnLabels,this.lastMetadata.columnLabels)||!pt(t.preview[0],this.lastMetadata.preview[0])}onGlobalNotetypeChanged(t){pt(t,this.lastGlobalNotetype)||(this.lastGlobalNotetype=ot(t),t!==null&&this.metadata.update(e=>(e.notetype.value=t,e)))}onDeckIdChanged(t){t!==this.lastDeckId&&(this.lastDeckId=t,t!==null&&this.metadata.update(e=>(e.deck.value=t,e)))}}function Dt(a){const t=De(a),e=Me(a);return[{label:Yt(),value:0,disabled:!1}].concat(a.columnLabels.map((l,s)=>(s+=1,s===t?it(Ct(),!0,s):s===e?it(Rt(),!0,s):s===a.guidColumn?it("GUID",!0,s):l===""?it(a.preview[0].vals[s-1],!1,s,!0):it(l,!1,s))))}function it(a,t,e,l){return{label:a?`${e}: ${a}`:e.toString(),shortLabel:l?e.toString():void 0,value:e,disabled:t}}function Me(a){return a.deck.case==="deckColumn"?a.deck.value:null}function De(a){return a.notetype.case==="notetypeColumn"?a.notetype.value:null}const He=async({params:a})=>{const[t,e,l]=await Promise.all([Wt({}),qt({skipEmptyDefault:!1,includeFiltered:!1}),xt({path:a.path},{alertOnError:!1})]);return{state:new Se(a.path,t,e,l)}},_a=Object.freeze(Object.defineProperty({__proto__:null,load:He},Symbol.toStringTag,{value:"Module"}));var Ee=R('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),xe=R('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Ht(a,t){X(t,!1);const e=J();let l=D(t,"label",8),s=D(t,"columnOptions",8),o=D(t,"value",12);_t(()=>(kt(s()),kt(o())),()=>{var $;K(e,($=s().find(m=>m.value===o()))==null?void 0:$.label)}),jt(),Q();var i=xe(),r=x(i);at(r,()=>({"--cols":2})),ut(r.lastChild,{children:($,m)=>{var n=Ee(),I=x(n);at(I,()=>({"--col-size":1})),gt(I.lastChild,{children:(b,v)=>{q();var c=W();z(()=>A(c,l())),p(b,c)},$$slots:{default:!0}}),S(I);var h=M(I,2);at(h,()=>({"--col-size":1})),gt(h.lastChild,{children:(b,v)=>{ke(b,{get label(){return u(e)},get list(){return s()},parser:c=>({content:c.label,value:c.value,disabled:c.disabled}),get value(){return o()},set value(c){o(c)},$$legacy:!0})},$$slots:{default:!0}}),S(h),p($,n)},$$slots:{default:!0}}),S(r),p(a,i),Z()}var Re=R("<!> <!>",1);function je(a,t){X(t,!1);const e=dt(),l=()=>F(m,"$globalNotetype",e),s=()=>F(n,"$fieldNamesPromise",e),o=()=>F(I,"$columnOptions",e),i=()=>F($,"$metadata",e);let r=D(t,"state",8);const $=r().metadata,m=r().globalNotetype,n=r().fieldNames,I=r().columnOptions;Q();var h=E(()=>Jt());It(a,{get title(){return u(h)},children:(b,v)=>{var c=Re(),P=x(c);{var O=y=>{var C=yt(),H=x(C);Ce(H,s,null,(_,G)=>{var j=yt(),lt=x(j);vt(lt,1,()=>u(G),ft,(ct,$t,d)=>{var V=E(()=>d===0?o().slice(1):o());Ht(ct,{get label(){return u($t)},get columnOptions(){return u(V)},get value(){return l().fieldColumns[d]},set value(g){B(m,N(l).fieldColumns[d]=g,N(l))},$$legacy:!0})}),p(_,j)}),p(y,C)};Nt(P,y=>{l()!==null&&y(O)})}var w=M(P,2),f=E(()=>Kt());Ht(w,{get label(){return u(f)},get columnOptions(){return o()},get value(){return i().tagsColumn},set value(y){B($,N(i).tagsColumn=y,N(i))},$$legacy:!0}),p(b,c)},$$slots:{default:!0}}),Z()}function ze(){return[{label:Qt(),value:et.TAB},{label:Xt(),value:et.PIPE},{label:Zt(),value:et.SEMICOLON},{label:te(),value:et.COLON},{label:ee(),value:et.COMMA},{label:ae(),value:et.SPACE}]}function Ae(){return[{label:le(),value:ht.UPDATE},{label:se(),value:ht.PRESERVE},{label:oe(),value:ht.DUPLICATE}]}function Fe(){return[{label:Ct(),value:Ot.NOTETYPE},{label:re(),value:Ot.NOTETYPE_AND_DECK}]}var Le=R('<th class="svelte-ezvffl"> </th>'),Ge=R('<td class="svelte-ezvffl"> </td>'),Ve=R('<tr class="svelte-ezvffl"></tr>'),Ue=R('<div class="outer svelte-ezvffl"><table class="preview svelte-ezvffl"><thead><tr class="svelte-ezvffl"></tr></thead><tbody></tbody></table></div> <!>',1);function We(a,t){X(t,!1);const e=dt(),l=()=>F($,"$metadata",e),s=()=>F(m,"$columnOptions",e),o=J();let i=D(t,"state",8),r=D(t,"maxColumns",8,1e3);const $=i().metadata,m=i().columnOptions;let n=J(),I=J(!1);function h(y){let C=!1;return{rows:y.map(_=>_.vals.length>r()?(C=!0,_.vals.slice(0,r())):_.vals),truncated:C}}_t(()=>(u(n),u(I),l()),()=>{(y=>(K(n,y.rows),K(I,y.truncated)))(h(l().preview))}),_t(()=>(u(I),kt(r())),()=>{K(o,u(I)?ie({count:r()}):"")}),jt(),Q();var b=Ue(),v=x(b),c=rt(v),P=rt(c),O=rt(P);vt(O,5,()=>s().slice(1),ft,(y,C)=>{let H=()=>u(C).label,_=()=>u(C).shortLabel;var G=Le(),j=rt(G,!0);S(G),z(()=>A(j,_()||H())),p(y,G)}),S(O),S(P);var w=M(P);vt(w,5,()=>u(n),ft,(y,C)=>{var H=Ve();vt(H,5,()=>u(C),ft,(_,G)=>{var j=Ge(),lt=rt(j,!0);S(j),z(()=>A(lt,u(G))),p(_,j)}),S(H),p(y,H)}),S(w),S(c),S(v);var f=M(v,2);we(f,{get warning(){return u(o)}}),p(a,b),Z()}var qe=R("<!> <!> <!>",1);function Be(a,t){X(t,!1);const e=dt(),l=()=>F(o,"$metadata",e);let s=D(t,"state",8);const o=s().metadata,i={delimiter:{title:ne(),help:ue(),url:L.TextImporting.root},isHtml:{title:de(),help:ce(),url:L.TextImporting.html}},r=Object.values(i);let $=J(),m=J();function n(h){u($).show(),u(m).to(h)}Q();var I=E(()=>wt());It(a,{get title(){return u(I)},children:(h,b)=>{var v=qe(),c=x(v),P=E(ze);nt(c,{get defaultValue(){return s().defaultDelimiter},get choices(){return u(P)},get disabled(){return l().forceDelimiter},get value(){return l().delimiter},set value(f){B(o,N(l).delimiter=f,N(l))},children:(f,y)=>{Y(f,{$$events:{click:()=>n(Object.keys(i).indexOf("delimiter"))},children:(C,H)=>{q();var _=W();z(()=>A(_,i.delimiter.title)),p(C,_)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var O=M(c,2);Ie(O,{get defaultValue(){return s().defaultIsHtml},get disabled(){return l().forceIsHtml},get value(){return l().isHtml},set value(f){B(o,N(l).isHtml=f,N(l))},children:(f,y)=>{Y(f,{$$events:{click:()=>n(Object.keys(i).indexOf("isHtml"))},children:(C,H)=>{q();var _=W();z(()=>A(_,i.isHtml.title)),p(C,_)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var w=M(O,2);We(w,{get state(){return s()}}),p(h,v)},$$slots:{default:!0,tooltip:(h,b)=>{var v=E(()=>wt());Ft(h,{get title(){return u(v)},get url(){return L.TextImporting.root},slot:"tooltip",helpSections:r,$$events:{mount:c=>{K($,c.detail.modal),K(m,c.detail.carousel)}}})}}}),Z()}var Ye=R('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Je=R('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Et(a,t){X(t,!1);const e=dt(),l=()=>F(r,"$tagsWritable",e);let s=D(t,"tags",12),o=D(t,"keyCombination",8,void 0),i=D(t,"breakpoint",8,"md");const r=mt(s());Q();var $=Je(),m=x($);at(m,()=>({"--cols":13})),ut(m.lastChild,{children:(n,I)=>{var h=Ye(),b=x(h);at(b,()=>({"--col-size":7})),gt(b.lastChild,{get breakpoint(){return i()},children:(c,P)=>{var O=yt(),w=x(O);Bt(w,t,"default",{}),p(c,O)},$$slots:{default:!0}}),S(b);var v=M(b,2);at(v,()=>({"--col-size":6})),gt(v.lastChild,{get breakpoint(){return i()},children:(c,P)=>{Pe(c,{children:(O,w)=>{Te(O,{tags:r,get keyCombination(){return o()},$$events:{tagsupdate:({detail:f})=>s(f.tags)}})},$$slots:{default:!0,revert:(O,w)=>{Oe(O,{slot:"revert",defaultValue:[],get value(){return At(),l()},set value(f){zt(r,f)},$$legacy:!0})}}})},$$slots:{default:!0}}),S(v),p(n,h)},$$slots:{default:!0}}),S(m),p(a,$),Z()}var Ke=R("<!> <!> <!> <!> <!> <!>",1);function Qe(a,t){X(t,!1);const e=dt(),l=()=>F($,"$globalNotetype",e),s=()=>F(m,"$deckId",e),o=()=>F(r,"$metadata",e);let i=D(t,"state",8);const r=i().metadata,$=i().globalNotetype,m=i().deckId,n={notetype:{title:Ct(),help:pe(),url:L.TextImporting.root},deck:{title:Rt(),help:me(),url:L.TextImporting.root},dupeResolution:{title:ve(),help:fe(),url:L.TextImporting.updating},matchScope:{title:ge(),help:$e(),url:L.TextImporting.updating},globalTags:{title:he(),help:be(),url:L.TextImporting.root},updatedTags:{title:ye(),help:_e(),url:L.TextImporting.root}},I=Object.values(n);let h=J(),b=J();function v(P){u(h).show(),u(b).to(P)}Q();var c=E(()=>Tt());It(a,{get title(){return u(c)},children:(P,O)=>{var w=Ke(),f=x(w);{var y=d=>{var V=E(()=>i().notetypeNameIds.map(({id:g,name:U})=>({label:U,value:g})));nt(d,{get defaultValue(){return i().defaultNotetypeId},get choices(){return u(V)},get value(){return l().id},set value(g){B($,N(l).id=g,N(l))},children:(g,U)=>{Y(g,{$$events:{click:()=>v(Object.keys(n).indexOf("notetype"))},children:(T,Lt)=>{q();var st=W();z(()=>A(st,n.notetype.title)),p(T,st)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};Nt(f,d=>{l()!==null&&d(y)})}var C=M(f,2);{var H=d=>{var V=E(()=>i().deckNameIds.map(({id:g,name:U})=>({label:U,value:g})));nt(d,{get defaultValue(){return i().defaultDeckId},get choices(){return u(V)},get value(){return At(),s()},set value(g){zt(m,g)},children:(g,U)=>{Y(g,{$$events:{click:()=>v(Object.keys(n).indexOf("deck"))},children:(T,Lt)=>{q();var st=W();z(()=>A(st,n.deck.title)),p(T,st)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};Nt(C,d=>{s()!==null&&d(H)})}var _=M(C,2),G=E(Ae);nt(_,{defaultValue:0,get choices(){return u(G)},get value(){return o().dupeResolution},set value(d){B(r,N(o).dupeResolution=d,N(o))},children:(d,V)=>{Y(d,{$$events:{click:()=>v(Object.keys(n).indexOf("dupeResolution"))},children:(g,U)=>{q();var T=W();z(()=>A(T,n.dupeResolution.title)),p(g,T)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var j=M(_,2),lt=E(Fe);nt(j,{defaultValue:0,get choices(){return u(lt)},get value(){return o().matchScope},set value(d){B(r,N(o).matchScope=d,N(o))},children:(d,V)=>{Y(d,{$$events:{click:()=>v(Object.keys(n).indexOf("matchScope"))},children:(g,U)=>{q();var T=W();z(()=>A(T,n.matchScope.title)),p(g,T)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var ct=M(j,2);Et(ct,{keyCombination:"Control+T",get tags(){return o().globalTags},set tags(d){B(r,N(o).globalTags=d,N(o))},children:(d,V)=>{Y(d,{$$events:{click:()=>v(Object.keys(n).indexOf("globalTags"))},children:(g,U)=>{q();var T=W();z(()=>A(T,n.globalTags.title)),p(g,T)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var $t=M(ct,2);Et($t,{keyCombination:"Control+Shift+T",get tags(){return o().updatedTags},set tags(d){B(r,N(o).updatedTags=d,N(o))},children:(d,V)=>{Y(d,{$$events:{click:()=>v(Object.keys(n).indexOf("updatedTags"))},children:(g,U)=>{q();var T=W();z(()=>A(T,n.updatedTags.title)),p(g,T)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0}),p(P,w)},$$slots:{default:!0,tooltip:(P,O)=>{var w=E(()=>Tt());Ft(P,{get title(){return u(w)},get url(){return L.TextImporting.root},slot:"tooltip",helpSections:I,$$events:{mount:f=>{K(h,f.detail.modal),K(b,f.detail.carousel)}}})}}}),Z()}var Xe=R("<!> <!> <!>",1);function Ze(a,t){X(t,!1);let e=D(t,"state",8);Q(),Ne(a,{get path(){return e().path},get importer(){return e()},children:(l,s)=>{var o=Xe(),i=x(o);ut(i,{children:(m,n)=>{Be(m,{get state(){return e()}})},$$slots:{default:!0}});var r=M(i,2);ut(r,{children:(m,n)=>{Qe(m,{get state(){return e()}})},$$slots:{default:!0}});var $=M(r,2);ut($,{children:(m,n)=>{je(m,{get state(){return e()}})},$$slots:{default:!0}}),p(l,o)},$$slots:{default:!0}}),Z()}function ka(a,t){X(t,!1);let e=D(t,"data",8);Q(),Ze(a,{get state(){return e().state}}),Z()}export{ka as component,_a as universal};
