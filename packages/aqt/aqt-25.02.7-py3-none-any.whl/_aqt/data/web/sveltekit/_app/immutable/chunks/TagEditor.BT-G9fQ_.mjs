import{a as N,b as L,t as $e,c as Ge}from"./disclose-version.CZXCSga2.mjs";import{i as fe}from"./legacy.Cvgq_wkp.mjs";import{h as rt,e as Ut,i as Kt,b0 as Zt,L as Gt,d as Vt,A as Xt,z as Jt,U as Qt,C as Yt,p as ce,X as mt,I as ee,t as Z,b as ie,_ as Q,f as te,g as e,c as ne,N as V,r as G,aD as O,a_ as Ne,s as u,n as Se,m as I,a1 as en,l as me,a as qe,b1 as ct,M as Ke,aG as Me,Z as tn,b2 as it,a$ as ut}from"./runtime.NF8NW0fQ.mjs";import{s as De,e as E,p as ft,b as Te,a as ue}from"./store.CrzbHEEA.mjs";import{p as w,i as we}from"./props.C4_rjmFK.mjs";import{c as pt}from"./Container.C0RC8RQ7.mjs";import{p as nn,e as _t,i as an}from"./theme.DvYw8rH4.mjs";import{r as sn,as as on,u as ke,q as bt,t as re,by as ln,bz as rn,bA as cn,bB as un}from"./runtime-require.ClQzQQRm.mjs";import{b as yt}from"./IconButton.DdPSxNFx.mjs";import{s as fn,b as q,p as ye,t as dn,v as gn,f as St,I as Le,w as hn,x as vn,S as We,g as je,y as mn,o as pn,a as Tt,z as _n,A as bn,B as yn,C as dt,j as Sn,i as Tn}from"./Shortcut.6Snuvz9J.mjs";import{s as pe,x as wn}from"./backend.CuvxjHSt.mjs";import{c as de,o as wt}from"./index-client.CMnCpbS1.mjs";import{d as kn,w as kt}from"./index.BmKPAsrv.mjs";import{d as Ve,W as Ct,P as $t,D as Fe,B as Cn}from"./Badge.DeIA0KIp.mjs";import{a as $n}from"./input.Cvf2xTFQ.mjs";import{b as Xe}from"./this.COGKo2H1.mjs";import{W as An}from"./WithTooltip.CBYxWk4z.mjs";function Nn(a,t,d){rt&&Ut();var c=a,_=Qt,f,o=Kt()?Zt:Gt;Vt(()=>{o(_,_=t())&&(f&&Xt(f),f=Jt(()=>d(c)))}),rt&&(c=Yt)}function At(a){const t=a.getRootNode();return t.getSelection?t.getSelection():document.getSelection()}function Dn(a){const t=a.rangeCount;return t===0?null:a.getRangeAt(t-1)}const Da=Symbol("direction"),Je=Symbol("tagActionsShortcuts");function Pn(a,t,d){document.execCommand(a,t,d)}function Nt(a,t,d){if(!a.parentNode||a===t)return d;{const c=a.parentNode,_=[Array.prototype.indexOf.call(a.parentNode.childNodes,a),...d];return Nt(c,t,_)}}function gt(a,t){return Nt(a,t,[])}function Qe(a,t){if(t.length===0)return a;if(a.childNodes[t[0]]){const[d,...c]=t;return Qe(a.childNodes[d],c)}else return null}var Ye=(a=>(a[a.Before=-1]="Before",a[a.Equal=0]="Equal",a[a.After=1]="After",a))(Ye||{});function En(a,t){const d=Math.min(a.coordinates.length,t.coordinates.length);for(let c=0;c<=d;c++){if(a.coordinates.length===c)return t.coordinates.length===c?a.offset<t.offset?-1:a.offset>t.offset?1:0:-1;if(t.coordinates.length===c)return 1;if(a.coordinates[c]<t.coordinates[c])return-1;if(a.coordinates[c]>t.coordinates[c])return 1}throw new Error("compareLocations: Should never happen")}function xn(a){const t=At(a),d=Dn(t);if(!d)return null;const c=d.collapsed,f={coordinates:gt(t.anchorNode,a),offset:t.anchorOffset};if(c)return{anchor:f,collapsed:c};const r={coordinates:gt(t.focusNode,a),offset:t.focusOffset},v=En(f,r)===Ye.After?"backward":"forward";return{anchor:f,focus:r,collapsed:c,direction:v}}function In(a){a.empty()}function Rn(a,t,d,c){const _=c.focus,f=_.offset,o=Qe(a,_.coordinates);c.direction==="forward"?(d.setEnd(o,f),t.addRange(d)):(t.addRange(d),t.extend(o,f))}function Wn(a){return xn(a)}function jn(a,t){const d=At(a);In(d);const c=new Range,_=Qe(a,t.anchor.coordinates);c.setStart(_,t.anchor.offset),t.collapsed?(c.collapse(!0),d.addRange(c)):Rn(a,d,c,t)}sn("anki/location",{Position:Ye,restoreSelection:jn,saveSelection:Wn});const se="∷";function Ze(a){return a.replace(/::/g,se)}function Be(a){return a.replace(/\u2237/gu,"::")}function ht(a){let t=a.trim();for(;t.startsWith(":")||t.startsWith(se);)t=t.slice(1).trimStart();for(;t.endsWith(":")||t.endsWith(se);)t=t.slice(0,-1).trimEnd();return t}function He(a){return{id:Math.random().toString(36).substring(2),name:a,selected:!1,flash:()=>{}}}function Bn(a){return a.name}const Ae=kt(null);kn(Ae,a=>()=>a==null?void 0:a.blur());var Mn=L('<input type="text" tabindex="-1" size="1">');function Ln(a,t){ce(t,!1);const d=De(),c=()=>Te(Ae,"$currentTagInput",d);let _=w(t,"id",8,void 0),f=w(t,"class",8,""),o=w(t,"name",12),r=w(t,"input",12),h=w(t,"disabled",8);const v=de();function y(){return r().selectionStart===r().selectionEnd}function C(){return r().selectionStart===0&&r().selectionEnd===0}function m(){return r().selectionStart===r().value.length&&r().selectionEnd===r().value.length}function s(l){r().setSelectionRange(l,l)}function P(){return o().length===0}async function k(l){const T=r().value.length;v("tagjoinprevious"),await Q(),s(r().value.length-T),l.preventDefault()}async function F(l,T){if(T>o().length)return;o().slice(0,T).endsWith(se)&&(o(o().slice(0,T-1)+o().slice(T,o().length)),await Q(),l.preventDefault(),s(T-1),v("taginput"))}function R(l){C()?k(l):F(l,r().selectionStart)}async function W(l){const T=r().value.length;v("tagjoinnext"),await Q(),s(T),l.preventDefault()}function j(l){m()?W(l):F(l,r().selectionStart+2)}function g(){o(ht(o())),o().length===0&&v("tagdelete"),v("tagaccept")}function z(l){v("tagsplit",{start:r().selectionStart,end:r().selectionEnd}),l.preventDefault()}async function D(l,T=!1){const A=r().selectionStart,J=r().selectionEnd,M=o().slice(0,A),oe=o().slice(J,o().length);if(M.endsWith(se)){l.preventDefault(),l.stopPropagation();return}else if(M.endsWith(":")){l.preventDefault(),o(`${M.slice(0,-1)}${se}${o().slice(J,o().length)}`),await Q(),s(A),v("taginput");return}else if(oe.startsWith(":"))l.preventDefault(),o(`${M}${se}${o().slice(J+1,o().length)}`);else{if(T)return;l.preventDefault(),o(`${M}${se}${oe}`)}await Q(),s(A+1),v("taginput")}function p(l){switch(l.code){case"Enter":z(l);break;case"Backspace":y()&&R(l);break;case"Delete":y()&&j(l);break}dn(l)?P()?k(l):C()&&(v("tagmoveprevious"),l.preventDefault()):gn(l)?P()?W(l):m()&&(v("tagmovenext"),l.preventDefault()):l.key===" "?D(l,!1):l.key===":"&&D(l,!0)}function $(l){const T=document.getSelection();l.clipboardData.setData("text/plain",Be(T.toString()))}async function B(l){$(l);const T=r().selectionStart,A=r().selectionEnd;o(o().slice(0,T)+o().slice(A)),await Q(),s(T),v("taginput")}function H(l){if(!l.clipboardData)return;const A=(o()+l.clipboardData.getData("text/plain")).split(/\s+/).map(ht).filter(M=>M.length>0).map(Ze);if(A.length===0)return;const J=A.pop();for(const M of A.reverse())o(M),v("tagadd");o(J)}function X(l){o().length===0&&(l.preventDefault(),l.stopPropagation(),v("tagselectall"))}const{selectAllShortcut:ae}=mt(Je);wt(()=>{fn(X,ae,{target:r()}),r().focus()});function x(l){return ft(Ae,l),{destroy(){c()===l&&ft(Ae,null)}}}fe();var S=Mn();on(S),Xe(S,l=>r(l),()=>r()),ee(()=>$n(S,o)),ee(()=>E("focus",S,function(l){q.call(this,t,l)})),ee(()=>E("blur",S,ye(g))),ee(()=>E("keydown",S,p)),ee(()=>E("keydown",S,function(l){q.call(this,t,l)})),ee(()=>E("keyup",S,function(l){q.call(this,t,l)})),ee(()=>E("input",S,()=>v("taginput"))),ee(()=>E("copy",S,ye($))),ee(()=>E("cut",S,ye(B))),ee(()=>E("paste",S,ye(H))),Ve(S,l=>x==null?void 0:x(l)),Z(()=>{var l;ke(S,"id",_()),bt(S,`tag-input ${(l=f())!=null?l:""} svelte-1nk8ij0`),re(S,"disabled",h())}),N(a,S),ie()}var qn=L("<!> <!>",1),zn=L('<div class="tag-add-button svelte-1fo7hj6" role="button"><!> <span class="tags-info svelte-1fo7hj6"><!></span></div> <!>',1);function On(a,t){ce(t,!1);const d=De(),c=()=>Te(Ae,"$currentTagInput",d);let _=w(t,"keyCombination",8);const f=de();function o(){f("tagappend")}fe();var r=zn(),h=te(r);const v=O(()=>{var k;return(k=ln())!=null?k:""}),y=O(()=>{var k;return(k=je(_()))!=null?k:""});Z(()=>ke(h,"title",`${e(v)} (${e(y)})`));var C=ne(h);St(C,{children:(k,F)=>{var R=qn(),W=te(R);Le(W,{icon:hn});var j=V(W,2);Le(j,{icon:vn}),N(k,R)},$$slots:{default:!0}});var m=V(C,2),s=ne(m);pe(s,t,"default",{}),G(m),G(h);var P=V(h,2);We(P,{get keyCombination(){return _()},$$events:{action:()=>f("tagappend")}}),Z(()=>ke(h,"tabindex",c()?-1:0)),E("click",h,o),E("focus",h,o),N(a,r),ie()}var Fn=L('<div class="tags-selected-button svelte-y9jxqs" role="button" tabindex="0"><!></div>'),Hn=L("<!> <!> <!>",1);function Un(a,t){ce(t,!1);const d=de();let c=I(!1);const{selectAllShortcut:_,copyShortcut:f,removeShortcut:o}=mt(Je);fe(),Ct(a,{get show(){return e(c)},preferredPlacement:"top",portalTarget:document.body,shift:0,children:Ne,$$slots:{default:(r,h)=>{const v=O(()=>h.asReference);var y=Fn(),C=en(()=>pn(()=>u(c,!e(c)))),m=ne(y);St(m,{children:(s,P)=>{Le(s,{icon:mn})},$$slots:{default:!0}}),G(y),Ve(y,s=>{var P;return(P=e(v))==null?void 0:P(s)}),ee(()=>E("click",y,()=>u(c,!e(c)))),ee(()=>E("keydown",y,function(...s){var P;(P=e(C))==null||P.apply(this,s)})),N(r,y)},floating:(r,h)=>{$t(r,{slot:"floating",children:(v,y)=>{var C=Hn(),m=te(C);Fe(m,{$$events:{click:()=>d("tagselectall")},children:(k,F)=>{Se();var R=$e();const W=O(()=>{var g;return(g=rn())!=null?g:""}),j=O(()=>{var g;return(g=je(_))!=null?g:""});Z(()=>ue(R,`${e(W)} (${e(j)})`)),N(k,R)},$$slots:{default:!0}});var s=V(m,2);Fe(s,{$$events:{click:()=>d("tagcopy")},children:(k,F)=>{Se();var R=$e();const W=O(()=>{var g;return(g=cn())!=null?g:""}),j=O(()=>{var g;return(g=je(f))!=null?g:""});Z(()=>ue(R,`${e(W)} (${e(j)})`)),N(k,R)},$$slots:{default:!0}});var P=V(s,2);Fe(P,{$$events:{click:()=>d("tagdelete")},children:(k,F)=>{Se();var R=$e();const W=O(()=>{var g;return(g=un())!=null?g:""}),j=O(()=>{var g;return(g=je(o))!=null?g:""});Z(()=>ue(R,`${e(W)} (${e(j)})`)),N(k,R)},$$slots:{default:!0}}),N(v,C)},$$slots:{default:!0}})}}}),ie()}var Kn=L('<div class="tag-options-button gap svelte-16efk4p"><!></div>');function Zn(a,t){let d=w(t,"badgeHeight",12),c=w(t,"tagsSelected",8),_=w(t,"keyCombination",8);var f=Kn(),o=ne(f);Nn(o,c,r=>{var h=Ge(),v=te(h);{var y=m=>{Un(m,{$$events:{tagselectall(s){q.call(this,t,s)},tagcopy(s){q.call(this,t,s)},tagdelete(s){q.call(this,t,s)}}})},C=m=>{On(m,{get keyCombination(){return _()},$$events:{tagappend(s){q.call(this,t,s)}}})};we(v,m=>{c()?m(y):m(C,!1)})}N(r,h)}),G(f),Tt(f,"offsetHeight",d),E("mousedown",f,ye(function(r){q.call(this,t,r)})),N(a,f)}function Gn(a,t){let d=w(t,"class",8,"");Cn(a,{get class(){var c;return`d-flex align-items-center ms-1 ${(c=d())!=null?c:""}`},iconSize:80,$$events:{click(c){q.call(this,t,c)}},children:(c,_)=>{Le(c,{icon:_n})},$$slots:{default:!0}})}var Vn=L('<button tabindex="-1"><!></button>');function Ue(a,t){ce(t,!1);let d=w(t,"class",8,""),c=w(t,"tagName",8),_=w(t,"tooltip",8,void 0),f=w(t,"selected",8,!1);const o=de();let r=I(!1);function h(){u(r,!0),setTimeout(()=>u(r,!1),300)}let v=I();wt(()=>o("mount",{button:e(v)})),fe();var y=Vn(),C=ne(y);return pe(C,t,"default",{}),G(y),Xe(y,m=>u(v,m),()=>e(v)),Z(()=>{var m;bt(y,`tag d-inline-flex align-items-center text-nowrap ps-2 pe-1 ${(m=d())!=null?m:""} svelte-1ywoj88`),ke(y,"title",_()),ke(y,"data-addon-tag",c()),re(y,"selected",f()),re(y,"flashing",e(r))}),E("mousemove",y,function(m){q.call(this,t,m)}),E("click",y,function(m){q.call(this,t,m)}),N(a,y),yt(t,"flash",h),ie({flash:h})}var Xn=L(" <!>",1),Jn=L("<span> </span> <!>",1),Qn=L("<span> </span> <!>",1),Yn=L('<div class="svelte-11ejbji"><!></div>');function ea(a,t){ce(t,!1);const d=De(),c=()=>Te(nn,"$pageTheme",d),_=I();let f=w(t,"name",8),o=w(t,"class",8,""),r=w(t,"tooltip",8),h=w(t,"selected",12),v=w(t,"active",8),y=w(t,"shorten",8),C=w(t,"flash",12);const m=de();let s=I(!1),P=I(!1);function k($){u(s,bn($)),u(P,yn($))}function F(){e(P)?m("tagrange"):e(s)?m("tagselect"):m("tagclick")}function R($){const B=$.split(se);return B.length===1?$:`…${se}`+B[B.length-1]}function W($){return $.split(se).length>1}const j="tag-icon-hover";me(()=>(e(s),e(P)),()=>{u(_,e(s)||e(P))}),qe(),fe();var g=Yn();E("keydown",ct.body,k),E("keyup",ct.body,k);var z=ne(g);{var D=$=>{Ue($,{get class(){return o()},get tagName(){return f()},$$events:{mousemove:k,click:F},children:(B,H)=>{Se();var X=Xn(),ae=te(X),x=V(ae);pe(x,t,"default",{get selectMode(){return e(_)},hoverClass:j}),Z(()=>{var S;return ue(ae,`${(S=f())!=null?S:""} `)}),N(B,X)},$$slots:{default:!0}})},p=$=>{var B=Ge(),H=te(B);{var X=x=>{An(x,{get tooltip(){return r()},trigger:"hover",placement:"top",children:Ne,$$slots:{default:(S,l)=>{const T=O(()=>l.createTooltip);Ue(S,{get class(){return o()},get tagName(){return f()},get flash(){return C()},set flash(A){C(A)},get selected(){return h()},set selected(A){h(A)},$$events:{mousemove:k,click:F,mount:A=>e(T)(A.detail.button)},children:(A,J)=>{var M=Jn(),oe=te(M),U=ne(oe,!0);Z(()=>ue(U,R(f()))),G(oe);var Y=V(oe,2);pe(Y,t,"default",{get selectMode(){return e(_)},hoverClass:j}),N(A,M)},$$slots:{default:!0},$$legacy:!0})}}})},ae=x=>{Ue(x,{get class(){return o()},get tagName(){return f()},get flash(){return C()},set flash(S){C(S)},get selected(){return h()},set selected(S){h(S)},$$events:{mousemove:k,click:F},children:(S,l)=>{var T=Qn(),A=te(T),J=ne(A,!0);G(A);var M=V(A,2);pe(M,t,"default",{get selectMode(){return e(_)},hoverClass:j}),Z(()=>ue(J,f())),N(S,T)},$$slots:{default:!0},$$legacy:!0})};we(H,x=>{y()&&W(f())?x(X):x(ae,!1)},!0)}N($,B)};we(z,$=>{v()?$(D):$(p,!1)})}G(g),Z(()=>{re(g,"select-mode",e(_)),re(g,"night-mode",c().isDark),re(g,"empty",f()==="")}),N(a,g),ie()}function ta(a,t){ce(t,!1);let d=w(t,"name",8),c=w(t,"class",8,""),_=w(t,"tooltip",8),f=w(t,"selected",8),o=w(t,"active",8),r=w(t,"shorten",8),h=w(t,"flash",8);const v=de();function y(){v("tagdelete")}fe(),ea(a,{get name(){return d()},get class(){return c()},get tooltip(){return _()},get selected(){return f()},get active(){return o()},get shorten(){return r()},get flash(){return h()},$$events:{tagrange(C){q.call(this,t,C)},tagselect(C){q.call(this,t,C)},tagclick:()=>v("tagedit")},children:Ne,$$slots:{default:(C,m)=>{const s=O(()=>m.selectMode),P=O(()=>m.hoverClass);Gn(C,{get class(){return e(P)},$$events:{click:k=>{e(s)||(y(),k.stopPropagation())}}})}}}),ie()}var na=L('<div class="tag-spacer svelte-1k3couf" role="textbox" tabindex="-1"><br></div>');function aa(a,t){var d=na();E("click",d,function(c){q.call(this,t,c)}),N(a,d)}var sa=L('<div tabindex="-1" class="autocomplete-item svelte-1pjq6zk" role="button"><!></div>');function vt(a,t){ce(t,!1);let d=w(t,"selected",8,!1),c=w(t,"active",8,!1),_=w(t,"suggestion",8),f=I();me(()=>(Ke(d()),e(f)),()=>{d()&&e(f)&&e(f).scrollIntoViewIfNeeded({behavior:"smooth",block:"start"})}),qe();var o=sa(),r=ne(o);pe(r,t,"default",{}),G(o),Xe(o,h=>u(f,h),()=>e(f)),Z(()=>{ke(o,"data-addon-suggestion",_()),re(o,"selected",d()),re(o,"active",c())}),E("mousedown",o,ye(function(h){q.call(this,t,h)})),E("mouseup",o,function(h){q.call(this,t,h)}),E("mouseenter",o,function(h){q.call(this,t,h)}),E("mouseleave",o,function(h){q.call(this,t,h)}),N(a,o),ie()}var oa=L('<span class="autocomplete-reference svelte-1bkz961"><!></span>'),la=L('<div class="autocomplete-menu svelte-1bkz961"></div>'),ra=L('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function ca(a,t){ce(t,!1);const d=De(),c=()=>Te(f(),"$show",d);let _=w(t,"suggestionsPromise",8),f=w(t,"show",8),o=I([]),r=I(null),h=I(!1);const v=de();function y(){e(r)===null?u(r,0):e(r)>=e(o).length-1?u(r,null):Me(r)}function C(){e(r)===null?u(r,e(o).length-1):e(r)===0?u(r,null):Me(r,-1)}async function m(){var p;v("select",{selected:e(o)[(p=e(r))!=null?p:-1]})}async function s(){y(),await m()}async function P(){C(),await m()}async function k(){var p;e(o).length&&(u(h,!0),v("choose",{chosen:e(o)[(p=e(r))!=null?p:-1]}),await Q(),f().set(!1))}async function F(){await Q(),v("update")}function R(){return e(r)!==null}function W(){return{selectPrevious:P,selectNext:s,chooseSelected:k,update:F,hasSelected:R}}function j(p){u(r,p),u(h,!0)}function g(p){j(p)}async function z(p){u(h,!1),v("select",{selected:e(o)[p]})}function D(p,$){p.buttons===1&&j($)}me(()=>(Ke(_()),Ke(f()),dt),()=>{_().then(p=>{f().set(p.length>0),dt()&&navigator.userAgent.match(/Chrome\/77/)&&(p=p.slice(0,10)),u(o,p)})}),qe(),fe(),Ct(a,{keepOnKeyup:!0,get show(){return c()},preferredPlacement:"top",portalTarget:document.body,$$events:{close:()=>f().set(!1)},children:Ne,$$slots:{default:(p,$)=>{const B=O(()=>$.asReference);var H=oa(),X=ne(H);pe(X,t,"default",{createAutocomplete:W}),G(H),Ve(H,ae=>{var x;return(x=e(B))==null?void 0:x(ae)}),N(p,H)},floating:(p,$)=>{var B=ra(),H=te(B);pt(H,()=>({"--popover-padding-inline":"0"})),$t(H.lastChild,{slot:"floating",children:(X,ae)=>{var x=la();_t(x,5,()=>e(o),an,(S,l,T)=>{var A=Ge(),J=te(A);{var M=U=>{vt(U,{selected:!0,get active(){return e(h)},get suggestion(){return e(l)},$$events:{mousedown:()=>g(T),mouseup:()=>{z(T),k()},mouseenter:Y=>D(Y,T),mouseleave:()=>u(h,!1)},children:(Y,Pe)=>{Se();var ge=$e();Z(()=>ue(ge,e(l))),N(Y,ge)},$$slots:{default:!0}})},oe=U=>{vt(U,{get suggestion(){return e(l)},$$events:{mousedown:()=>g(T),mouseup:()=>{z(T),k()},mouseenter:Y=>D(Y,T)},children:(Y,Pe)=>{Se();var ge=$e();Z(()=>ue(ge,e(l))),N(Y,ge)},$$slots:{default:!0}})};we(J,U=>{T===e(r)?U(M):U(oe,!1)})}N(S,A)}),G(x),N(X,x)},$$slots:{default:!0}}),G(H),N(p,B)}}}),ie()}var ia=L("<!> <!> <!>",1),ua=L('<div class="tag-relative svelte-1tsu84n"><!> <!></div>'),fa=L('<!> <div class="tag-editor svelte-1tsu84n"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <!> <!></div>',1);function Pa(a,t){ce(t,!1);const d=De(),c=()=>Te(h(),"$tags",d),_=()=>Te(k,"$show",d),f=I(),o=I(),r=I();let h=w(t,"tags",8),v=w(t,"keyCombination",8,"Control+Shift+T");const y="Control+A",C="Control+C",m="Backspace";tn(Je,{selectAllShortcut:y,copyShortcut:C,removeShortcut:m});let s=I();function P(n){u(s,n.map(i=>He(Ze(i))))}const k=kt(!1),F=de(),R=Promise.resolve([]);let W=I(R);function j(){const n=e(s).map(i=>i.name).map(Be);F("tagsupdate",{tags:n}),u(W,R)}let g=I(null),z=null,D=I(""),p=I(),$=I(),B=I(!1);async function H(n){const{tags:i}=await wn({input:n,matchLimit:500});return i}const X=/^:?([^:].*?[^:]):?$/;function ae(){const i=e(s)[e(g)].name;if(u(B,i.length===0),e(B))u(W,R);else{const b=Be(i),K=X.test(b)?b.replace(X,"$1"):b;u(W,H(K).then(le=>(u(B,le.length===0),le.map(Ze))))}}function x(n){const i=e(s)[e(g)];u(D,n!=null?n:i.name);const b=e(p).value.length;e(p).setSelectionRange(b,b)}async function S(n){n.name=e(D),u(s,e(s)),await Q(),e(p)&&e($).update()}function l(n){z===null&&(z=n)}function T(){_e();const n=e(s)[e(s).length-1];(!n||n.name.length>0)&&A(e(s).length-1,"");const i=e(g)===null;u(g,null),i&&et()}function A(n,i){e(s).splice(n+1,0,He(i)),u(s,e(s)),l(n+1)}function J(n){const i=e(s).map(Bn);i.splice(n,1);const b=i.indexOf(e(D));return b>=0?(e(s)[b>=n?b+1:b].flash(),!1):!0}async function M(n,i,b){const K=e(D).slice(0,i),le=e(D).slice(b);u(D,K),await Q(),A(n,le),u(g,null),await Q(),n!==e(g)&&e(p).setSelectionRange(0,0)}function oe(n){J(n)&&(e(s).splice(n,0,He(e(D))),Me(g),u(s,e(s)))}function U(n){const i=e(s).splice(n,1)[0];return u(s,e(s)),z!==null&&z>n&&z--,i}function Y(n){return n===0}function Pe(n){return n===e(s).length-1}function ge(n){if(Y(n))return;const i=U(n-1);u(D,i.name+e(D)),Me(g,-1),S(e(s)[e(g)])}function Dt(n){if(Pe(n))return;const i=U(n+1);u(D,e(D)+i.name),S(e(s)[e(g)])}function Pt(n){Y(n)||(z=n-1,u(g,null),e(p).blur())}async function Et(n){if(Pe(n)){e(D).length!==0&&(A(n,""),u(g,null));return}z=n+1,u(g,null),e(p).blur(),await Q(),e(p).setSelectionRange(0,0)}function xt(n,i){e(s).includes(n)&&(J(i)||U(i))}function et(){u(g,z),z=null}function It(n){if(Sn(n)){e($).selectPrevious(),n.preventDefault();return}else if(Tn(n)){e($).selectNext(),n.preventDefault();return}switch(n.code){case"Tab":if(_())n.shiftKey?e($).selectPrevious():e($).selectNext();else break;n.preventDefault();break;case"Enter":e($).chooseSelected(),n.preventDefault();break}}let Ce=null,Ee=null;function tt(n){ut(s,e(s)[n].selected=!e(s)[n].selected),u(s,e(s)),Ce=n}function Rt(n){if(Ce===null){tt(n);return}Ee=n;const i=Math.min(Ce,Ee),b=Math.max(Ce,Ee);for(let K=i;K<=b;K++)ut(s,e(s)[K].selected=!0);u(s,e(s))}function _e(){u(s,e(s).map(n=>({...n,selected:!1}))),Ce=null,Ee=null}function Wt(n){const i=n.currentTarget;(n.relatedTarget===null||!i.contains(n.relatedTarget))&&_e()}function jt(n){const i=document.createElement("textarea");i.value=n,i.setAttribute("readonly",""),i.style.position="absolute",i.style.left="-9999px",document.body.appendChild(i),i.select(),Pn("copy"),document.body.removeChild(i)}function ze(){for(const n of e(s))n.selected=!0;u(s,e(s))}function nt(){const n=e(s).filter(i=>i.selected).map(i=>Be(i.name)).join(`
`);jt(n),_e()}function at(){e(s).map((n,i)=>[n.selected,i]).filter(([n])=>n).reverse().forEach(([,n])=>U(n)),_e(),j()}let Oe=I(),xe=I();me(()=>c(),()=>{P(c())}),me(()=>(e(Oe),e(xe)),()=>{u(f,Math.floor(e(Oe)/e(xe)))}),me(()=>(e(o),e(f)),()=>{u(o,e(o)||e(f)>2)}),me(()=>e(s),()=>{u(r,e(s).some(n=>n.selected))}),qe(),fe();var st=fa(),ot=te(st);{var Bt=n=>{var i=ia(),b=te(i);We(b,{keyCombination:y,$$events:{action:ze}});var K=V(b,2);We(K,{keyCombination:C,$$events:{action:nt}});var le=V(K,2);We(le,{keyCombination:m,$$events:{action:at}}),N(n,i)};we(ot,n=>{e(r)&&n(Bt)})}var Ie=V(ot,2),Re=ne(Ie);pt(Re,()=>({"--icon-align":"baseline"})),Zn(Re.lastChild,{get tagsSelected(){return e(r)},get keyCombination(){return v()},get badgeHeight(){return e(xe)},set badgeHeight(n){u(xe,n)},$$events:{tagselectall:ze,tagcopy:nt,tagdelete:at,tagappend:T},$$legacy:!0}),G(Re);var lt=V(Re,2);_t(lt,3,()=>e(s),n=>n.id,(n,i,b)=>{var K=ua(),le=ne(K),Lt=O(()=>e(b)===e(g)?e(D):e(i).name),qt=O(()=>e(b)===e(g));ta(le,{class:"ms-0",get name(){return e(Lt)},get tooltip(){return e(i).name},get active(){return e(qt)},get shorten(){return e(o)},get flash(){return e(i).flash},set flash(he){e(i).flash=he,it(()=>e(s))},get selected(){return e(i).selected},set selected(he){e(i).selected=he,it(()=>e(s))},$$events:{tagedit:()=>{u(g,e(b)),_e()},tagselect:()=>tt(e(b)),tagrange:()=>Rt(e(b)),tagdelete:()=>{_e(),U(e(b)),j()}},$$legacy:!0});var zt=V(le,2);{var Ot=he=>{ca(he,{get suggestionsPromise(){return e(W)},show:k,$$events:{update:ae,select:({detail:ve})=>x(ve.selected),choose:({detail:ve})=>{x(ve.chosen),M(e(b),ve.chosen.length,ve.chosen.length)}},children:Ne,$$slots:{default:(ve,Ft)=>{const Ht=O(()=>Ft.createAutocomplete);Ln(ve,{get id(){return e(i).id},class:"position-absolute start-0 top-0 bottom-0 ps-2 py-0",get disabled(){return e(B)},get name(){return e(D)},set name(be){u(D,be)},get input(){return e(p)},set input(be){u(p,be)},$$events:{focus:()=>{F("tagsFocused"),u(D,e(i).name),u($,e(Ht)())},keydown:It,keyup:()=>{e(D).length===0&&(k==null||k.set(!1))},taginput:()=>S(e(i)),tagsplit:({detail:be})=>M(e(b),be.start,be.end),tagadd:()=>oe(e(b)),tagdelete:()=>U(e(b)),tagselectall:async()=>{e(s).length<=1||(e(p).blur(),await Q(),ze())},tagjoinprevious:()=>ge(e(b)),tagjoinnext:()=>Dt(e(b)),tagmoveprevious:()=>Pt(e(b)),tagmovenext:()=>Et(e(b)),tagaccept:()=>{xt(e(i),e(b)),e(i)&&S(e(i)),j(),et()}},$$legacy:!0})}}})};we(zt,he=>{e(b)===e(g)&&he(Ot)})}G(K),Z(()=>re(K,"hide-tag",e(b)===e(g))),N(n,K)});var Mt=V(lt,2);return aa(Mt,{$$events:{click:T}}),G(Ie),E("focusout",Ie,Wt),Tt(Ie,"offsetHeight",n=>u(Oe,n)),N(a,st),yt(t,"appendEmptyTag",T),ie({appendEmptyTag:T})}export{Pa as T,Da as d,Pn as e};
