<?xml version="1.0" ?>
<!--
  Copyright 2017-2020 Akretion France (http://www.akretion.com/)
  @author: Alexis de Lattre <alexis.delattre@akretion.com>
  License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
-->
<odoo>
    <record id="view_partner_form" model="ir.ui.view">
        <field name="name">chorus.res.partner.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="account.view_partner_property_form" />
        <field name="arch" type="xml">
            <field name="ref" position="after">
                <field
                    name="fr_chorus_service_id"
                    invisible="not parent_id or invoice_sending_method != 'fr_chorus'"
                    domain="[('partner_id', '=', parent_id)]"
                    context="{'default_partner_id': parent_id}"
                />
            </field>
            <xpath
                expr="//field[@name='child_ids']/form//label[@for='street']"
                position="before"
            >
                <field
                    name="fr_chorus_service_id"
                    invisible="type != 'invoice' or parent.invoice_sending_method != 'fr_chorus'"
                    domain="[('partner_id', '=', parent.id)]"
                    context="{'default_partner_id': parent.id}"
                />
            </xpath>
            <group id="invoice_send_settings" position="inside">
                <button
                    name="fr_chorus_identifier_and_required_button"
                    type="object"
                    string="Get Chorus Info and Services"
                    colspan="2"
                    class="btn-primary"
                    groups="l10n_fr_chorus_account.group_chorus_api"
                    invisible="invoice_sending_method != 'fr_chorus' or fr_chorus_required"
                />
                <label
                    for="fr_chorus_required"
                    invisible="invoice_sending_method != 'fr_chorus'"
                />
                <div
                    name="fr_chorus_required"
                    invisible="invoice_sending_method != 'fr_chorus'"
                    class="o_row"
                >
                    <field name="fr_chorus_required" />
                    <button
                        name="fr_chorus_identifier_and_required_button"
                        type="object"
                        string="Update"
                        class="btn-link mb-1 px-0"
                        icon="fa-refresh"
                        groups="l10n_fr_chorus_account.group_chorus_api"
                        invisible="not fr_chorus_required"
                        help="Update Info Required for Chorus and Chorus Services"
                    />
                </div>
                <field
                    name="fr_chorus_identifier"
                    groups="l10n_fr_chorus_account.group_chorus_api_debug"
                    invisible="invoice_sending_method != 'fr_chorus'"
                />
                <button
                    type="action"
                    class="btn-link"
                    name="%(chorus_partner_service_action)d"
                    invisible="fr_chorus_required not in ('service', 'service_or_engagement', 'service_and_engagement')"
                    context="{'search_default_partner_id': id, 'default_partner_id': id}"
                    colspan="2"
                >
                    <field
                        name="fr_chorus_service_count"
                        string="Chorus Services"
                        widget="statinfo"
                    />
                </button>
            </group>
            <xpath expr="//field[@name='child_ids']/kanban" position="inside">
                <field name="fr_chorus_service_id" />
            </xpath>
            <xpath
                expr="//field[@name='child_ids']/kanban/templates/t[@t-name='card']//div[@t-if='record.mobile.raw_value']"
                position="after"
            >
                <div t-if="record.fr_chorus_service_id.raw_value">Chorus Service: <field
                    name="fr_chorus_service_id"
                /></div>
            </xpath>
        </field>
    </record>
</odoo>
