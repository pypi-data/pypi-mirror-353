<?xml version="1.0" encoding="utf-8" ?>
<!--
  Copyright 2017-2020 Akretion France (http://www.akretion.com/)
  @author: Alexis de Lattre <alexis.delattre@akretion.com>
  License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
-->
<odoo>
    <record id="view_move_form" model="ir.ui.view">
        <field name="name">Chorus support on Customer Invoice form view</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form" />
        <field name="arch" type="xml">
            <field name="partner_shipping_id" position="before">
                <field
                    name="chorus_service_code"
                    invisible="invoice_sending_method != 'fr_chorus'"
                />
            </field>
            <button name="action_invoice_sent" position="after">
                <button
                    name="%(account_invoice_chorus_send_action)d"
                    type="action"
                    invisible="chorus_flow_id or state != 'posted' or invoice_sending_method != 'fr_chorus'"
                    string="Send to Chorus"
                    class="btn-primary"
                    groups="l10n_fr_chorus_account.group_chorus_api"
                />
            </button>
            <notebook position="inside">
                <page
                    name="fr-chorus"
                    string="Chorus Pro"
                    invisible="invoice_sending_method != 'fr_chorus'"
                    groups="l10n_fr_chorus_account.group_chorus_api"
                >
                    <group name="chorus-tab">
                        <group name="chorus-main">
                            <field name="chorus_flow_id" />
                            <field
                                name="chorus_identifier"
                                groups="l10n_fr_chorus_account.group_chorus_api_debug"
                            />
                            <label
                                for="chorus_status"
                                invisible="not chorus_identifier"
                            />
                            <div
                                name="chorus_status"
                                invisible="not chorus_identifier"
                                class="o_row"
                            >
                                <field name="chorus_status" />
                                <button
                                    name="chorus_update_invoice_status"
                                    type="object"
                                    string="Update"
                                    help="Update Chorus Invoice Status"
                                    invisible="not chorus_identifier"
                                    class="btn-link mb-1 px-0"
                                    icon="fa-refresh"
                                />
                            </div>
                            <field
                                name="chorus_status_date"
                                invisible="not chorus_identifier"
                            />
                        </group>
                        <group name="chorus-attachments" string="Attachments">
                            <field
                                name="chorus_attachment_ids"
                                widget="many2many_binary"
                                nolabel="1"
                                colspan="2"
                                readonly="state != 'draft'"
                            />
                        </group>
                    </group>
                </page>
            </notebook>
        </field>
    </record>
    <record id="view_invoice_tree" model="ir.ui.view">
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_invoice_tree" />
        <field name="arch" type="xml">
            <field name="status_in_payment" position="after">
                <field
                    name="chorus_status"
                    optional="hide"
                    column_invisible="context.get('default_move_type') not in ('out_invoice', 'out_refund')"
                />
            </field>
            <field name="invoice_date" position="before">
                <field
                    name="chorus_service_code"
                    optional="hide"
                    column_invisible="context.get('default_move_type') not in ('out_invoice', 'out_refund')"
                />
            </field>
            <header position="inside">
                <button
                    name="%(account_invoice_chorus_send_action)d"
                    type="action"
                    string="Send to Chorus"
                    groups="l10n_fr_chorus_account.group_chorus_api"
                />
            </header>
        </field>
    </record>
    <record id="view_account_invoice_filter" model="ir.ui.view">
        <field name="name">Chorus groupby on Invoice search view</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter" />
        <field name="arch" type="xml">
            <filter name="status" position="after">
                <filter
                    string="Chorus Status"
                    name="chorus_status_groupby"
                    context="{'group_by': 'chorus_status'}"
                    groups="l10n_fr_chorus_account.group_chorus_api"
                />
            </filter>
        </field>
    </record>
</odoo>
