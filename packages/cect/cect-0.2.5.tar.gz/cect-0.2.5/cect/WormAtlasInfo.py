from cect import print_

# Data taken from https://www.wormatlas.org/colorcode.htm

VERTICAL_ELLIPSE = "\u2b2e"

WA_COLORS = {}

WA_COLORS["Hermaphrodite"] = {}


# MUSCLE
WA_COLORS["Hermaphrodite"]["Muscle"] = {}
WA_COLORS["Hermaphrodite"]["Muscle"]["intestinal muscle"] = "#006600"
WA_COLORS["Hermaphrodite"]["Muscle"]["vulval muscle"] = "#99cc66"
WA_COLORS["Hermaphrodite"]["Muscle"]["body wall muscle"] = "#336600"
WA_COLORS["Hermaphrodite"]["Muscle"]["uterine muscle"] = "#99cc00"
WA_COLORS["Hermaphrodite"]["Muscle"]["sphincter and anal depressor muscle"] = "#669900"
WA_COLORS["Hermaphrodite"]["Muscle"]["odd numbered pharyngeal muscle"] = "#33cC00"
WA_COLORS["Hermaphrodite"]["Muscle"]["even numbered pharyngeal muscle"] = "#ccf199"

# ALIMENTARY SYSTEM
WA_COLORS["Hermaphrodite"]["Alimentary System"] = {}
WA_COLORS["Hermaphrodite"]["Alimentary System"][
    "marginal cells (mc) of the pharynx"
] = "#cc33cc"
WA_COLORS["Hermaphrodite"]["Alimentary System"]["intestinal cells"] = "#ffccff"

# REPRODUCTIVE SYSTEM
WA_COLORS["Hermaphrodite"]["Reproductive System"] = {}
WA_COLORS["Hermaphrodite"]["Reproductive System"]["vulval epithelium"] = "#9999ff"
WA_COLORS["Hermaphrodite"]["Reproductive System"]["germline"] = "#003366"
WA_COLORS["Hermaphrodite"]["Reproductive System"]["DTC and somatic gonad"] = "#9966ff"
WA_COLORS["Hermaphrodite"]["Reproductive System"]["embryo"] = "#6699cc"
WA_COLORS["Hermaphrodite"]["Reproductive System"]["uterus"] = "#99cccc"
WA_COLORS["Hermaphrodite"]["Reproductive System"]["spermatheca"] = "#3399ff"
WA_COLORS["Hermaphrodite"]["Reproductive System"]["spermatheca-uterine valve"] = (
    "#666699"
)

# NERVOUS TISSUE
WA_COLORS["Hermaphrodite"]["Nervous Tissue"] = {}
WA_COLORS["Hermaphrodite"]["Nervous Tissue"]["interneuron"] = "#ff3300"
WA_COLORS["Hermaphrodite"]["Nervous Tissue"][
    "General code for neuronal tissue if subtype is unspecified"
] = "#ff3300"
WA_COLORS["Hermaphrodite"]["Nervous Tissue"]["motor neuron"] = "#9966cc"
WA_COLORS["Hermaphrodite"]["Nervous Tissue"]["sensory neuron"] = "#ff66cc"
WA_COLORS["Hermaphrodite"]["Nervous Tissue"]["polymodal neuron"] = "#cc0033"
WA_COLORS["Hermaphrodite"]["Nervous Tissue"]["neuron with unknown function"] = "#990033"


# EXCRETORY SYSTEM
WA_COLORS["Hermaphrodite"]["Excretory System"] = {}
WA_COLORS["Hermaphrodite"]["Excretory System"]["excretory pore cell"] = "#ecf781"
WA_COLORS["Hermaphrodite"]["Excretory System"]["duct cell"] = "#cc9966"
WA_COLORS["Hermaphrodite"]["Excretory System"]["gland cell"] = "#9999cc"
WA_COLORS["Hermaphrodite"]["Excretory System"]["excretory cell"] = "#cc3366"
WA_COLORS["Hermaphrodite"]["Excretory System"]["excretory duct"] = "#cccc99"


# EPITHELIAL TISSUE
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"] = {}
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"]["hypodermis"] = "#dcc3ac"
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"]["seam cell"] = "#cc6633"
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"]["socket cell, XXX cells"] = "#ff9999"
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"][
    "sheath cell other than amphid sheath and phasmid"
] = "#339999"
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"]["amphid sheath and phasmid sheath"] = (
    "#01fecc"
)
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"][
    "pharyngeal-intestinal valve, intestinal rectal valve"
] = "#996633"
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"]["arcade cell"] = "#cccc00"
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"]["pharyngeal epithelium"] = "#996699"
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"][
    "rectal epithelium (U, F, K, K', Y, B)"
] = "#996666"
WA_COLORS["Hermaphrodite"]["Epithelial Tissue"]["rectal gland, pharyngeal glands"] = (
    "#ccccff"
)


# OTHER TISSUES
WA_COLORS["Hermaphrodite"]["Other Tissues"] = {}
WA_COLORS["Hermaphrodite"]["Other Tissues"]["pseudocoelomic space"] = "#ffffcc"
WA_COLORS["Hermaphrodite"]["Other Tissues"]["basement membrane"] = "#ff9900"
WA_COLORS["Hermaphrodite"]["Other Tissues"]["GLR cell"] = "#cc9900"
WA_COLORS["Hermaphrodite"]["Other Tissues"]["coeloemocyte"] = "#ffcc00"
WA_COLORS["Hermaphrodite"]["Other Tissues"]["head mesodermal cell"] = "#ff6633"


WA_COLORS["Male"] = {}

# MUSCLE
WA_COLORS["Male"]["Muscle"] = {}
WA_COLORS["Male"]["Muscle"]["diagonal muscles"] = "#66cc66"
WA_COLORS["Male"]["Muscle"]["anterior outer longitudinal muscles"] = "#666633"
WA_COLORS["Male"]["Muscle"]["posterior outer longitudinal muscles"] = "#999933"
WA_COLORS["Male"]["Muscle"]["anterior inner longitudinal muscles"] = "#99cc33"
WA_COLORS["Male"]["Muscle"]["posterior inner longitudinal muscles"] = "#ccff33"
WA_COLORS["Male"]["Muscle"]["caudal inner longitudinal muscles"] = "#99cc99"
WA_COLORS["Male"]["Muscle"]["spicule retractor muscles"] = "#669966"
WA_COLORS["Male"]["Muscle"]["spicule protractor muscles"] = "#99ff99"
WA_COLORS["Male"]["Muscle"]["gubernacular retractor muscles"] = "#99ffcc"
WA_COLORS["Male"]["Muscle"]["gubernacular erector muscles"] = "#66ff33"
WA_COLORS["Male"]["Muscle"]["anterior oblique muscles"] = "#33cc99"
WA_COLORS["Male"]["Muscle"]["posterior oblique muscles"] = "#66cc99"


# REPRODUCTIVE SYSTEM
WA_COLORS["Male"]["Reproductive System"] = {}
WA_COLORS["Male"]["Reproductive System"]["vas deferens"] = "#66cccc"
WA_COLORS["Male"]["Reproductive System"]["seminal vesicle"] = "#6699ff"
WA_COLORS["Male"]["Reproductive System"]["proctodeum"] = "#996666"

# EPITHELIAL TISSUE
WA_COLORS["Male"]["Epithelial Tissue"] = {}
WA_COLORS["Male"]["Epithelial Tissue"][
    "sheath cell (spicules, hook or post-cloacal sensilla)"
] = "#339999"
WA_COLORS["Male"]["Epithelial Tissue"][
    "socket cell (spicules, hook or post-cloacal sensilla)"
] = "#ff9999"
WA_COLORS["Male"]["Epithelial Tissue"]["ray structural cell"] = "#006666"


if __name__ == "__main__":
    from PIL import ImageColor
    import png

    filename = "docs/Colors.html"

    with open(filename, "w") as f:
        f.write(
            """<html>
  <head>
    <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      font-family: Arial, sans-serif; 
    }
    td {
    text-align: center;
    }

    </style>
    </head>
    <body>
"""
        )
        f.write("    <h2><i>C. elegans</i> cells</h2>\n---\n\n")
        f.write("    <table>\n\n")

        max_col = 4
        for sex in WA_COLORS:
            f.write(
                '\n        <tr><td colspan=%i style="height:30px"><b>%s</b></td></tr>\n'
                % (max_col, sex.upper())
            )

            for cell_class in WA_COLORS[sex]:
                f.write(
                    '\n        <tr><td colspan=%i style="height:30px"><b>%s</b></td></tr>\n\n            <tr>'
                    % (max_col, cell_class)
                )

                count = 0
                for cell_type in WA_COLORS[sex][cell_class]:
                    if "General code" not in cell_type:
                        color = WA_COLORS[sex][cell_class][cell_type][1:]
                        rgb_color = ImageColor.getcolor("#%s" % color.upper(), "RGB")

                        print(f"Generating {sex}/{cell_class}/{color}/{rgb_color}...")

                        # From: https://stackoverflow.com/questions/8554282/creating-a-png-file-in-python

                        width = 20
                        height = 20
                        img = []

                        for y in range(height):
                            row = ()
                            for x in range(width):
                                row = row + rgb_color
                            img.append(row)
                        with open("docs/images/%s.png" % color, "wb") as img_file:
                            w = png.Writer(width, height, greyscale=False)
                            w.write(img_file, img)

                        # https://stackoverflow.com/questions/3942878
                        if (
                            float(rgb_color[0]) / 256 * 0.299
                            + float(rgb_color[1]) / 256 * 0.587
                            + float(rgb_color[2]) / 256 * 0.2
                        ) > 0.35:
                            fcolor = "#000000"
                        else:
                            fcolor = "#ffffff"

                        count += 1
                        link_text = cell_type[0].upper() + cell_type[1:]
                        # link_text = f'<img src="images/{color}.png"/>{link_text}'
                        print(link_text)
                        f.write(
                            f'\n                <td style="background-color:#{color};color:{fcolor};">{link_text}</td>\n'
                        )
                        if count >= max_col:
                            f.write("\n                </tr><tr>\n")
                            count = 0

        f.write(
            """</tr></table></body>
</html>"""
        )

    print_("Written to: %s" % filename)
