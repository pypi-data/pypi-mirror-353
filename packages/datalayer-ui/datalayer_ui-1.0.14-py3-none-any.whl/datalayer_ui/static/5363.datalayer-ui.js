"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[5363],{35363:(e,t,n)=>{n.r(t),n.d(t,{DocumentEdit:()=>Yt,default:()=>$t});var s=n(9387),o=n(20568),i=n(3345),r=n(90537),l=n(98754),a=n(99180),c=n(93054),d=n(64315),u=n(24860),f=n(92243),m=n(3556),h=n(80006),p=n(38621),g=n(64699),x=n(70312),y=n(25035),b=n(29325),_=n(61497),v=n(9765),j=n(94789),k=n(94439),C=n(6246),N=n(4674),S=n(60083),w=n(12532),E=n(46333),A=n(53439),T=n(90043),P=n(78031),F=n(45838),L=n(50337),D=n(64166),I=n(59798),O=n(53140),R=n(12953),z=n(57615),M=n(57804),J=n(63475),B=n(97430),W=n(63646),q=n(70508),U=n(43016),Y=n(26369),$=n(12224),K=n(10457),H=n(94625),Z=n(86871),Q=n(43860),G=n(5755),V=n(18924),X=n(6111),ee=n(59910),te=n(77003),ne=n(86390),se=n(42371),oe=n(69522),ie=n(9366);function re(e,t){if(!e)throw new Error("Internal Lexical error: invariant() is meant to be replaced at compile time. There is no runtime version. Error: "+t)}var le=n(48832),ae=n(2993);function ce(e,t,n,s){return e.slice(0,t)+s+e.slice(t+n)}function de(e){const t=(0,le.nsf)(e);return re(null!==t,"could not find node by key"),t}function ue(e){const t=e.getParent();if(null!==t){const n=e.getWritable(),s=t.getWritable(),o=e.getPreviousSibling(),i=e.getNextSibling();if(null===o)if(null!==i){const e=i.getWritable();s.__first=i.__key,e.__prev=null}else s.__first=null;else{const e=o.getWritable();if(null!==i){const t=i.getWritable();t.__prev=e.__key,e.__next=t.__key}else e.__next=null;n.__prev=null}if(null===i)if(null!==o){const e=o.getWritable();s.__last=o.__key,e.__next=null}else s.__last=null;else{const e=i.getWritable();if(null!==o){const t=o.getWritable();t.__next=e.__key,e.__prev=t.__key}else e.__prev=null;n.__next=null}s.__size--,n.__parent=null}}const fe=new Set(["__key","__parent","__next","__prev"]),me=new Set(["__first","__last","__size"]),he=new Set(["__cachedText"]),pe=new Set(["__text"]);function ge(e,t,n){if(fe.has(e))return!0;if((0,le.kFe)(t)){if(pe.has(e))return!0}else if((0,le.ff4)(t)&&(me.has(e)||(0,le.hVZ)(t)&&he.has(e)))return!0;const s=t.constructor,o=n.excludedProperties.get(s);return null!=o&&o.has(e)}function xe(e,t,n,s){const o=s.__type,i=e.nodeProperties;let r=i.get(o);void 0===r&&(r=Object.keys(s).filter((t=>!ge(t,s,e))),i.set(o,r));const l=e.editor.constructor;for(let o=0;o<r.length;o++){const i=r[o],a=null===n?void 0:n[i];let c=s[i];if(a!==c){if(c instanceof l){const t=e.docsMap;let n;if(a instanceof l){const e=a._key;n=t.get(e),t.delete(e)}const o=n||new ie.JA,i=o.guid;c._key=i,t.set(i,o),c=o,e.editor.update((()=>{s.markDirty()}))}t instanceof ie.T5?t.set(i,c):t.setAttribute(i,c)}}}function ye(e,t,n,s){const o=null===s?t instanceof ie.T5?Array.from(t.keys()):Object.keys(t.getAttributes()):Array.from(s);let i;for(let s=0;s<o.length;s++){const r=o[s];if(ge(r,n,e))continue;const l=n[r];let a=t instanceof ie.T5?t.get(r):t.getAttribute(r);if(l!==a){if(a instanceof ie.JA){const t=e.docsMap;l instanceof ie.JA&&t.delete(l.guid);const n=(0,le.ieJ)(),s=a.guid;n._key=s,t.set(s,a),a=n}void 0===i&&(i=n.getWritable()),i[r]=a}}}function be(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _e(e,t,n,s){const o=new ve(e,t,n,s);return e._collabNode=o,o}class ve{constructor(e,t,n,s){be(this,"_map",void 0),be(this,"_key",void 0),be(this,"_parent",void 0),be(this,"_text",void 0),be(this,"_type",void 0),be(this,"_normalized",void 0),this._key="",this._map=e,this._parent=n,this._text=t,this._type=s,this._normalized=!1}getPrevNode(e){if(null===e)return null;const t=e.get(this._key);return(0,le.kFe)(t)?t:null}getNode(){const e=(0,le.nsf)(this._key);return(0,le.kFe)(e)?e:null}getSharedType(){return this._map}getType(){return this._type}getKey(){return this._key}getSize(){return this._text.length+(this._normalized?0:1)}getOffset(){return this._parent.getChildOffset(this)}spliceText(e,t,n){const s=this._parent._xmlText,o=this.getOffset()+1+e;0!==t&&s.delete(o,t),""!==n&&s.insert(o,n)}destroy(e){e.collabNodes.delete(this._key)}syncPropertiesAndTextFromLexical(e,t,n){const s=this.getPrevNode(n),o=t.__text;if(xe(e,this._map,s,t),null!==s){const e=s.__text;e!==o&&(!function(e,t,n,s){const o=(0,le.vJq)();let i=s.length;if((0,le.I2P)(o)&&o.isCollapsed()){const e=o.anchor;e.key===t&&(i=e.offset)}const r=function(e,t,n){const s=e.length,o=t.length;let i=0,r=0;for(;i<s&&i<o&&e[i]===t[i]&&i<n;)i++;for(;r+i<s&&r+i<o&&e[s-r-1]===t[o-r-1];)r++;for(;r+i<s&&r+i<o&&e[i]===t[i];)i++;return{index:i,insert:t.slice(i,o-r),remove:s-i-r}}(n,s,i);e.spliceText(r.index,r.remove,r.insert)}(this,t.__key,e,o),this._text=o)}}syncPropertiesAndTextFromYjs(e,t){const n=this.getNode();re(null!==n,"syncPropertiesAndTextFromYjs: could not find text node"),ye(e,this._map,n,t);const s=this._text;n.__text!==s&&(n.getWritable().__text=s)}}function je(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ke(e,t){const n=new Ce(e,t);return e._collabNode=n,n}class Ce{constructor(e,t){je(this,"_map",void 0),je(this,"_key",void 0),je(this,"_parent",void 0),je(this,"_type",void 0),this._key="",this._map=e,this._parent=t,this._type="linebreak"}getNode(){const e=(0,le.nsf)(this._key);return(0,le.wH$)(e)?e:null}getKey(){return this._key}getSharedType(){return this._map}getType(){return this._type}getSize(){return 1}getOffset(){return this._parent.getChildOffset(this)}destroy(e){e.collabNodes.delete(this._key)}}function Ne(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Se(e,t,n){const s=new we(e,t,n);return e._collabNode=s,s}class we{constructor(e,t,n){Ne(this,"_xmlElement",void 0),Ne(this,"_key",void 0),Ne(this,"_parent",void 0),Ne(this,"_type",void 0),this._key="",this._xmlElement=e,this._parent=t,this._type=n}getPrevNode(e){if(null===e)return null;const t=e.get(this._key);return(0,le.Cyw)(t)?t:null}getNode(){const e=(0,le.nsf)(this._key);return(0,le.Cyw)(e)?e:null}getSharedType(){return this._xmlElement}getType(){return this._type}getKey(){return this._key}getSize(){return 1}getOffset(){return this._parent.getChildOffset(this)}destroy(e){e.collabNodes.delete(this._key)}syncPropertiesFromLexical(e,t,n){const s=this.getPrevNode(n);xe(e,this._xmlElement,s,t)}syncPropertiesFromYjs(e,t){const n=this.getNode();re(null!==n,"syncPropertiesFromYjs: could not find decorator node"),ye(e,this._xmlElement,n,t)}}function Ee(e,t,n){const s=t.__type;let o;if((0,le.ff4)(t))o=Le(new ie.ZQ,n,s),o.syncPropertiesFromLexical(e,t,null),o.syncChildrenFromLexical(e,t,null,null,null);else if((0,le.kFe)(t))o=_e(new ie.T5,t.__text,n,s),o.syncPropertiesAndTextFromLexical(e,t,null);else if((0,le.wH$)(t)){const e=new ie.T5;e.set("__type","linebreak"),o=ke(e,n)}else(0,le.Cyw)(t)?(o=Se(new ie.WF,n,s),o.syncPropertiesFromLexical(e,t,null)):re(!1,"Expected text, element, decorator, or linebreak node");return o._key=t.__key,o}function Ae(e,t,n){const s=t.getType(),o=e.editor._nodes.get(s);re(void 0!==o,"Node %s is not registered");const i=new o.klass;if(i.__parent=n,t._key=i.__key,t instanceof De){const n=t._xmlText;t.syncPropertiesFromYjs(e,null),t.applyChildrenYjsDelta(e,n.toDelta()),t.syncChildrenFromYjs(e)}else t instanceof ve?t.syncPropertiesAndTextFromYjs(e,null):t instanceof we&&t.syncPropertiesFromYjs(e,null);return e.collabNodes.set(i.__key,t),i}function Te(e,t,n){const s=t._collabNode;if(void 0===s){const s=e.editor._nodes,o=function(e){const t=e instanceof ie.T5?e.get("__type"):e.getAttribute("__type");return re(null!=t,"Expected shared type to include type attribute"),t}(t);re(void 0!==s.get(o),"Node %s is not registered");const i=t.parent,r=void 0===n&&null!==i?Te(e,i):n||null;if(re(r instanceof De,"Expected parent to be a collab element node"),t instanceof ie.ZQ)return Le(t,r,o);if(t instanceof ie.T5)return"linebreak"===o?ke(t,r):_e(t,"",r,o);if(t instanceof ie.WF)return Se(t,r,o)}return s}function Pe(e,t,n){let s=0,o=0;const i=e._children,r=i.length;for(;o<r;o++){const e=i[o],l=s;if(s+=e.getSize(),(n?s>=t:s>t)&&e instanceof ve){let n=t-l-1;return n<0&&(n=0),{length:s-t,node:e,nodeIndex:o,offset:n}}if(s>t)return{length:0,node:e,nodeIndex:o,offset:l};if(o===r-1)return{length:0,node:null,nodeIndex:o+1,offset:l+1}}return{length:0,node:null,nodeIndex:0,offset:0}}function Fe(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Le(e,t,n){const s=new De(e,t,n);return e._collabNode=s,s}class De{constructor(e,t,n){Fe(this,"_key",void 0),Fe(this,"_children",void 0),Fe(this,"_xmlText",void 0),Fe(this,"_type",void 0),Fe(this,"_parent",void 0),this._key="",this._children=[],this._xmlText=e,this._type=n,this._parent=t}getPrevNode(e){if(null===e)return null;const t=e.get(this._key);return(0,le.ff4)(t)?t:null}getNode(){const e=(0,le.nsf)(this._key);return(0,le.ff4)(e)?e:null}getSharedType(){return this._xmlText}getType(){return this._type}getKey(){return this._key}isEmpty(){return 0===this._children.length}getSize(){return 1}getOffset(){const e=this._parent;return re(null!==e,"getOffset: could not find collab element node"),e.getChildOffset(this)}append(e){const t=this._xmlText,n=this._children,s=n[n.length-1],o=void 0!==s?s.getOffset()+s.getSize():0;if(e instanceof De)t.insertEmbed(o,e._xmlText);else if(e instanceof ve){const n=e._map;null===n.parent&&t.insertEmbed(o,n),t.insert(o+1,e._text)}else e instanceof Ce?t.insertEmbed(o,e._map):e instanceof we&&t.insertEmbed(o,e._xmlElement);this._children.push(e)}splice(e,t,n,s){const o=this._children,i=o[t];if(void 0===i)return re(void 0!==s,"splice: could not find collab element node"),void this.append(s);const r=i.getOffset();re(-1!==r,"splice: expected offset to be greater than zero");const l=this._xmlText;if(0!==n&&l.delete(r,i.getSize()),s instanceof De)l.insertEmbed(r,s._xmlText);else if(s instanceof ve){const e=s._map;null===e.parent&&l.insertEmbed(r,e),l.insert(r+1,s._text)}else s instanceof Ce?l.insertEmbed(r,s._map):s instanceof we&&l.insertEmbed(r,s._xmlElement);if(0!==n){const s=o.slice(t,t+n);for(let t=0;t<s.length;t++)s[t].destroy(e)}void 0!==s?o.splice(t,n,s):o.splice(t,n)}getChildOffset(e){let t=0;const n=this._children;for(let s=0;s<n.length;s++){const o=n[s];if(o===e)return t;t+=o.getSize()}return-1}destroy(e){const t=e.collabNodes,n=this._children;for(let t=0;t<n.length;t++)n[t].destroy(e);t.delete(this._key)}syncPropertiesFromLexical(e,t,n){xe(e,this._xmlText,this.getPrevNode(n),t)}_syncChildFromLexical(e,t,n,s,o,i){const r=this._children[t],l=de(n);r instanceof De&&(0,le.ff4)(l)?(r.syncPropertiesFromLexical(e,l,s),r.syncChildrenFromLexical(e,l,s,o,i)):r instanceof ve&&(0,le.kFe)(l)?r.syncPropertiesAndTextFromLexical(e,l,s):r instanceof we&&(0,le.Cyw)(l)&&r.syncPropertiesFromLexical(e,l,s)}syncChildrenFromLexical(e,t,n,s,o){const i=this.getPrevNode(n),r=null===i?[]:(0,ae.rB)(i,n),l=(0,ae.rB)(t,null),a=r.length-1,c=l.length-1,d=e.collabNodes;let u,f,m=0,h=0;for(;m<=a&&h<=c;){const t=r[m],i=l[h];if(t===i)this._syncChildFromLexical(e,h,i,n,s,o),m++,h++;else{void 0===u&&(u=new Set(r)),void 0===f&&(f=new Set(l));const n=f.has(t),s=u.has(i);if(n){const t=Ee(e,de(i),this);d.set(i,t),s?(this.splice(e,h,1,t),m++,h++):(this.splice(e,h,0,t),h++)}else this.splice(e,h,1),m++}}const p=m>a,g=h>c;if(p&&!g)for(;h<=c;++h){const t=l[h],n=Ee(e,de(t),this);this.append(n),d.set(t,n)}else if(g&&!p)for(let t=this._children.length-1;t>=h;t--)this.splice(e,t,1)}syncPropertiesFromYjs(e,t){const n=this.getNode();re(null!==n,"syncPropertiesFromYjs: could not find element node"),ye(e,this._xmlText,n,t)}applyChildrenYjsDelta(e,t){const n=this._children;let s=0;for(let o=0;o<t.length;o++){const i=t[o],r=i.insert,l=i.delete;if(null!=i.retain)s+=i.retain;else if("number"==typeof l){let e=l;for(;e>0;){const{node:t,nodeIndex:o,offset:i,length:r}=Pe(this,s,!1);if(t instanceof De||t instanceof Ce||t instanceof we)n.splice(o,1),e-=1;else{if(!(t instanceof ve))break;{const s=Math.min(e,r),l=0!==o?n[o-1]:null,a=t.getSize();if(0===i&&r===a){n.splice(o,1);const e=ce(t._text,i,s-1,"");e.length>0&&(l instanceof ve?l._text+=e:this._xmlText.delete(i,e.length))}else t._text=ce(t._text,i,s,"");e-=s}}}}else{if(null==r)throw new Error("Unexpected delta format");if("string"==typeof r){const{node:e,offset:t}=Pe(this,s,!0);e instanceof ve?e._text=ce(e._text,t,0,r):this._xmlText.delete(t,r.length),s+=r.length}else{const t=r,{nodeIndex:o}=Pe(this,s,!1),i=Te(e,t,this);n.splice(o,0,i),s+=1}}}}syncChildrenFromYjs(e){const t=this.getNode();re(null!==t,"syncChildrenFromYjs: could not find element node");const n=t.__key,s=(0,ae.rB)(t,null),o=[],i=s.length,r=this._children,l=r.length,a=e.collabNodes,c=new Set;let d,u,f=0,m=null;l!==i&&(u=t.getWritable());for(let i=0;i<l;i++){const h=s[f],p=r[i],g=p.getNode(),x=p._key;if(null!==g&&h===x){const t=(0,le.kFe)(g);if(c.add(h),t)if(p._key=h,p instanceof De){const t=p._xmlText;p.syncPropertiesFromYjs(e,null),p.applyChildrenYjsDelta(e,t.toDelta()),p.syncChildrenFromYjs(e)}else p instanceof ve?p.syncPropertiesAndTextFromYjs(e,null):p instanceof we?p.syncPropertiesFromYjs(e,null):p instanceof Ce||re(!1,"syncChildrenFromYjs: expected text, element, decorator, or linebreak collab node");o[i]=h,m=g,f++}else{if(void 0===d){d=new Set;for(let e=0;e<l;e++){const t=r[e]._key;""!==t&&d.add(t)}}if(null!==g&&void 0!==h&&!d.has(h)){ue(de(h)),i--,f++;continue}u=t.getWritable();const s=Ae(e,p,n),c=s.__key;if(a.set(c,p),o[i]=c,null===m){const e=u.getFirstChild();if(u.__first=c,null!==e){const t=e.getWritable();t.__prev=c,s.__next=t.__key}}else{const e=m.getWritable(),t=m.getNextSibling();if(e.__next=c,s.__prev=m.__key,null!==t){const e=t.getWritable();e.__prev=c,s.__next=e.__key}}i===l-1&&(u.__last=c),u.__size++,m=s}}for(let t=0;t<i;t++){const n=s[t];if(!c.has(n)){const t=de(n),s=e.collabNodes.get(n);void 0!==s&&s.destroy(e),ue(t)}}}}const Ie=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],Oe=Ie[Math.floor(Math.random()*Ie.length)],Re=(0,s.createContext)({clientID:0,color:Oe[1],collaboratorName:Oe[0],docsMap:new Map,notebooksMap:new Map,isCollaborationActive:!1});var ze=n(45222),Me=n(48905),Je=n(16181),Be=n(81390),We=n(64991),qe=n(27639);function Ue(e,t){const n=t.collabNodes.get(e.key);if(void 0===n)return null;let s=e.offset,o=n.getSharedType();if(n instanceof ve){o=n._parent._xmlText;const e=n.getOffset();if(-1===e)return null;s=e+1+s}else if(n instanceof De&&"element"===e.type){const t=e.getNode();re((0,le.ff4)(t),"Element point must be an element node");let n=0,o=0,i=t.getFirstChild();for(;null!==i&&o++<s;)(0,le.kFe)(i)?n+=i.getTextContentSize()+1:n++,i=i.getNextSibling();s=n}return(0,ie.SF)(o,s)}function Ye(e,t){return(0,ie.IT)(e,t.doc)}function $e(e,t){if(null===e){if(null!=t)return!0}else if(null===t||!(0,ie.uG)(e,t))return!0;return!1}function Ke(e,t){return{color:t,name:e,selection:null}}function He(e,t){const n=e.cursorsContainer;if(null!==n){const e=t.selections,s=e.length;for(let t=0;t<s;t++)n.removeChild(e[t])}}function Ze(e,t){const n=t.selection;null!==n&&He(e,n)}function Qe(e,t,n,s,o){const i=e.color,r=document.createElement("span");r.style.cssText=`position:absolute;top:0;bottom:0;right:-1px;width:1px;background-color:${i};z-index:10;`;const l=document.createElement("span");return l.textContent=e.name,l.style.cssText=`position:absolute;left:-2px;top:-16px;background-color:${i};color:#fff;line-height:12px;font-size:12px;padding:2px;font-family:Arial;font-weight:bold;white-space:nowrap;`,r.appendChild(l),{anchor:{key:t,offset:n},caret:r,color:i,focus:{key:s,offset:o},name:l,selections:[]}}function Ge(e,t,n,s){const o=e.editor,i=o.getRootElement(),r=e.cursorsContainer;if(null===r||null===i)return;const l=r.offsetParent;if(null===l)return;const a=l.getBoundingClientRect(),c=t.selection;if(null===n)return null===c?void 0:(t.selection=null,void He(e,c));t.selection=n;const d=n.caret,u=n.color,f=n.selections,m=n.anchor,h=n.focus,p=m.key,g=h.key,x=s.get(p),y=s.get(g);if(null===x||null===y)return;let b;if(x===y&&(0,le.wH$)(x))b=[o.getElementByKey(p).getBoundingClientRect()];else{const e=(0,qe.cb)(o,x,m.offset,y,h.offset);if(null===e)return;b=(0,qe.zT)(o,e)}const _=f.length,v=b.length;for(let e=0;e<v;e++){const t=b[e];let n=f[e];if(void 0===n){n=document.createElement("span"),f[e]=n;const t=document.createElement("span");n.appendChild(t),r.appendChild(n)}const s=`position:absolute;top:${t.top-a.top}px;left:${t.left-a.left}px;height:${t.height}px;width:${t.width}px;pointer-events:none;z-index:5;`;n.style.cssText=s,n.firstChild.style.cssText=`${s}left:0;top:0;background-color:${u};opacity:0.3;`,e===v-1&&d.parentNode!==n&&n.appendChild(d)}for(let e=_-1;e>=v;e--){const t=f[e];r.removeChild(t),f.pop()}}function Ve(e,t){const{anchorPos:n,focusPos:s}=t;let o=null,i=0,r=null,l=0;if(null!==n&&null!==s){const t=Ye(n,e),a=Ye(s,e);null!==t&&null!==a&&([o,i]=et(t.type,t.index),[r,l]=et(a.type,a.index))}return{anchorCollabNode:o,anchorOffset:i,focusCollabNode:r,focusOffset:l}}function Xe(e,t,n){if(e.key!==t||e.offset!==n){let s=(0,le.nsf)(t);if(null!==s&&!(0,le.ff4)(s)&&!(0,le.kFe)(s)){const e=s.getParentOrThrow();t=e.getKey(),n=s.getIndexWithinParent(),s=e}e.set(t,n,(0,le.ff4)(s)?"element":"text")}}function et(e,t){const n=e._collabNode;if(void 0===n)return[null,0];if(n instanceof De){const{node:e,offset:s}=Pe(n,t,!0);return null===e?[n,0]:[e,s]}return[null,0]}function tt(e,t,n,s){const o=t.awareness,i=o.getLocalState();if(null===i)return;const{anchorPos:r,focusPos:l,name:a,color:c,focusing:d,awarenessData:u}=i;let f=null,m=null;(null!==s&&(null===r||s.is(n))||null!==n)&&((0,le.I2P)(s)&&(f=Ue(s.anchor,e),m=Ue(s.focus,e)),($e(r,f)||$e(l,m))&&o.setLocalState({...i,anchorPos:f,awarenessData:u,color:c,focusPos:m,focusing:d,name:a}))}function nt(e,t){const n=t.awareness.getLocalState();if(null===n)return;const{anchorCollabNode:s,anchorOffset:o,focusCollabNode:i,focusOffset:r}=Ve(e,n);if(null!==s&&null!==i){const e=s.getKey(),t=i.getKey(),n=(0,le.vJq)();if(!(0,le.I2P)(n))return;Xe(n.anchor,e,o),Xe(n.focus,t,r)}}function st(e,t){const n=Array.from(t.awareness.getStates()),s=e.clientID,o=e.cursors,i=e.editor._editorState._nodeMap,r=new Set;for(let t=0;t<n.length;t++){const l=n[t],[a,c]=l;if(a!==s){r.add(a);const{name:t,color:n,focusing:s}=c;let l=null,d=o.get(a);if(void 0===d&&(d=Ke(t,n),o.set(a,d)),s){const{anchorCollabNode:t,anchorOffset:n,focusCollabNode:s,focusOffset:o}=Ve(e,c);if(null!==t&&null!==s){const e=t.getKey(),i=s.getKey();if(l=d.selection,null===l)l=Qe(d,e,n,i,o);else{const t=l.anchor,s=l.focus;t.key=e,t.offset=n,s.key=i,s.offset=o}}}Ge(e,d,l,i)}}const l=Array.from(o.keys());for(let t=0;t<l.length;t++){const n=l[t];if(!r.has(n)){const t=o.get(n);void 0!==t&&(Ze(e,t),o.delete(n))}}}function ot(e,t){const n=t._nodeMap.get(e);if(!n)return void(0,le.NiT)().selectStart();const s=n.__prev;let o=null;s&&(o=(0,le.nsf)(s)),null===o&&null!==n.__parent&&(o=(0,le.nsf)(n.__parent)),null!==o?null!==o&&o.isAttached()?o.selectEnd():ot(o.__key,t):(0,le.NiT)().selectStart()}function it(e){const t=e.anchor,n=e.focus;let s=!1;try{const e=t.getNode(),o=n.getNode();(!e.isAttached()||!o.isAttached()||(0,le.kFe)(e)&&t.offset>e.getTextContentSize()||(0,le.kFe)(o)&&n.offset>o.getTextContentSize())&&(s=!0)}catch(e){s=!0}return s}function rt(e,t){const{target:n}=t,s=Te(e,n);if(s instanceof De&&t instanceof ie.zN){const{keysChanged:n,childListChanged:o,delta:i}=t;n.size>0&&s.syncPropertiesFromYjs(e,n),o&&(s.applyChildrenYjsDelta(e,i),s.syncChildrenFromYjs(e))}else if(s instanceof ve&&t instanceof ie.Cr){const{keysChanged:n}=t;n.size>0&&s.syncPropertiesAndTextFromYjs(e,n)}else if(s instanceof we&&t instanceof ie.xz){const{attributesChanged:n}=t;n.size>0&&s.syncPropertiesFromYjs(e,n)}else re(!1,"Expected text, element, or decorator event")}function lt(e,t,n,s){const o=e.editor,i=o._editorState;n.forEach((e=>e.delta)),o.update((()=>{for(let t=0;t<n.length;t++){const s=n[t];rt(e,s)}const s=(0,le.vJq)();if((0,le.I2P)(s))if(it(s)){const n=i._selection;(0,le.I2P)(n)&&(nt(e,t),it(s))&&ot(s.anchor.key,i),tt(e,t,n,(0,le.vJq)())}else nt(e,t)}),{onUpdate:()=>{st(e,t),o.update((()=>{0===(0,le.NiT)().getChildrenSize()&&(0,le.NiT)().append((0,le.lJ7)())}))},skipTransforms:!0,tag:s?"historic":"collaboration"})}const at=(0,le.guI)("COLLAB_CONNECTED_COMMAND"),ct=(0,le.guI)("TOGGLE_COLLAB_CONNECT_COMMAND"),dt=(0,le.guI)("PROMPT_AI_AGENT");function ut(e,t,n,s,o){e.awareness.setLocalState({anchorPos:null,awarenessData:o,color:n,focusPos:null,focusing:s,name:t})}function ft(e,t,n,s,o){const{awareness:i}=e;let r=i.getLocalState();null!==r?(r.focusing=s,i.setLocalState(r)):ut(e,t,n,s,o)}var mt=n(18683);function ht(e,t,n,o,i,r,l,a,c,d,u,f,m,h){const{addAIAgent:p}=(0,Be.Ks)(),{createAIAgent:g}=(0,We.w)(),x=(0,s.useRef)(!1),y=(0,s.useCallback)((()=>n.connect()),[n]),b=(0,s.useCallback)((()=>{try{n.disconnect()}catch(e){}}),[n]),_=y(),v=(0,s.useCallback)((()=>o.connect()),[o]),j=(0,s.useCallback)((()=>{try{o.disconnect()}catch(e){}}),[o]),k=v();return(0,s.useEffect)((()=>{const{root:s}=c,{awareness:o}=n,u=n=>{!function(e,t){if(e.update((()=>{const e=(0,le.NiT)();e.clear(),e.select()}),{tag:"skip-collab"}),null===t.cursors)return;const n=t.cursors;if(null===n)return;const s=t.cursorsContainer;if(null===s)return;const o=Array.from(n.values());for(let e=0;e<o.length;e++){const t=o[e].selection;if(t&&null!=t.selections){const n=t.selections;for(let t=0;t<n.length;t++)s.removeChild(n[e])}}}(e,c),d(n),i.set(t,n),x.current=!0};n.on("reload",u);const f=({status:t})=>{e.dispatchCommand(at,"connected"===t)};n.on("status",f);const p=t=>{a&&t&&s.isEmpty()&&0===s._xmlText._length&&!1===x.current&&function(e,t){e.update((()=>{const n=(0,le.NiT)();if(n.isEmpty())if(t)switch(typeof t){case"string":{const n=e.parseEditorState(t);e.setEditorState(n,{tag:"history-merge"});break}case"object":e.setEditorState(t,{tag:"history-merge"});break;case"function":e.update((()=>{(0,le.NiT)().isEmpty()&&t(e)}),{tag:"history-merge"})}else{const t=(0,le.lJ7)();n.append(t);const{activeElement:s}=document;(null!==(0,le.vJq)()||null!==s&&s===e.getRootElement())&&t.select()}}),{tag:"history-merge"})}(e,m),x.current=!1};n.on("sync",p);const g=()=>{st(c,n)};o.on("update",g);const y=e.registerUpdateListener((({prevEditorState:e,editorState:t,dirtyLeaves:s,dirtyElements:o,normalizedNodes:i,tags:r})=>{!1===r.has("skip-collab")&&function(e,t,n,s,o,i,r,l){!function(e,t){e.doc.transact(t,e)}(e,(()=>{s.read((()=>{if(l.has("collaboration")||l.has("historic"))return void(r.size>0&&function(e,t){const n=Array.from(t),s=e.collabNodes,o=[];for(let e=0;e<n.length;e++){const t=n[e],i=(0,le.nsf)(t),r=s.get(t);if(r instanceof ve)if((0,le.kFe)(i))o.push([r,i.__text]);else{const e=r.getOffset();if(-1===e)continue;const n=r._parent;r._normalized=!0,n._xmlText.delete(e,1),s.delete(t);const o=n._children,i=o.indexOf(r);o.splice(i,1)}}for(let e=0;e<o.length;e++){const[t,n]=o[e];t instanceof ve&&"string"==typeof n&&(t._text=n)}}(e,r));if(o.has("root")){const t=n._nodeMap,s=(0,le.NiT)(),r=e.root;r.syncPropertiesFromLexical(e,s,t),r.syncChildrenFromLexical(e,s,t,o,i)}const s=(0,le.vJq)(),a=n._selection;tt(e,t,a,s)}))}))}(c,n,e,t,o,s,i,r)})),v=(e,t)=>{const s=t.origin;if(s!==c){const t=s instanceof ie.ad;lt(c,n,e,t)}};return s.getSharedType().observeDeep(v),ut(n,r,l,document.activeElement===e.getRootElement(),h||{}),c.notebook.changed.connect(((t,n)=>{let s=n.cellsChange;s&&Array.isArray(s)&&s.forEach((t=>{const n=t.insert;if(n){const t=n[0];console.log("------------ cell",t);const s=t.metadata;if(s.datalayer&&s.datalayer.ai&&s.datalayer.ai.skip)return void console.log("------------ skip");const o=t.source;"code"===t.cell_type?(e.dispatchCommand(le.XKQ,void 0),e.dispatchCommand(U.JO,{code:o,outputs:[],autoStart:!0,loading:""})):e.update((()=>{const e=(0,le.vJq)(),t=(0,le.lJ7)(),n=(0,le.sTu)();e?.insertNodes([t,n]),(0,Me.Wn)(o,Me.Rm,t),n.selectEnd()}),{discrete:!0})}}))})),()=>{!1===x.current&&(_?_.then(b):b(),k?k.then(j):j()),n.off("sync",p),n.off("status",f),n.off("reload",u),o.off("update",g),s.getSharedType().unobserveDeep(v),i.delete(t),y()}}),[c,l,y,b,i,e,t,m,r,n,a,h,d,u]),(0,s.useEffect)((()=>e.registerCommand(dt,(e=>((async()=>{const e=(0,le.vJq)(),t=e?.getTextContent()||"Create a matplotlib example";await g(c.id,"notebook_memory"),p({documentId:c.id});const n=(0,Je.f)(),s=c.notebook;0===s.cells.length&&s.addCell({cell_type:"code",source:"1+1",metadata:{datalayer:{ai:{skip:!0}}}});const o=s.cells[0],i=o.getMetadata("datalayer")??{},r=i.ai??{prompts:[],messages:[]},l=r.prompts??[];l.push({id:n,prompt:t,username:"",timestamp:Date.now()}),r.prompts=l,i.ai=r,o.setMetadata("datalayer",i)})(),!1)),1)),[v,j,e]),(0,s.useEffect)((()=>e.registerCommand(ct,(e=>(e?(console.log("Collaboration connected!"),y()):(console.log("Collaboration disconnected!"),b()),!0)),le.jZM)),[y,b,e]),(0,s.useMemo)((()=>(0,ze.createPortal)((0,mt.jsx)("div",{ref:e=>{c.cursorsContainer=e}}),f&&f.current||document.body)),[c,f])}var pt=n(73105);function gt({editor:e,id:t,lexicalProvider:n,notebookProvider:o,docsMap:i,name:r,color:l,shouldBootstrap:a,cursorsContainerRef:c,initialEditorState:d,awarenessData:u,collaborationContext:f,binding:m,setDoc:h,setNotebook:p}){const g=ht(e,t,n,o,i,r,l,a,m,h,p,c,d,u);return f.clientID=m.clientID,function(e,t){const n=(0,s.useMemo)((()=>function(e,t){return new ie.ad(t,{trackedOrigins:new Set([e,null])})}(t,t.root.getSharedType())),[t]);(0,s.useEffect)((()=>(0,pt.Sd)(e.registerCommand(le.ZKf,(()=>(n.undo(),!0)),le.jZM),e.registerCommand(le.V30,(()=>(n.redo(),!0)),le.jZM))));const o=(0,s.useCallback)((()=>{n.clear()}),[n]);(0,s.useEffect)((()=>{const t=()=>{e.dispatchCommand(le.KfJ,n.undoStack.length>0),e.dispatchCommand(le.WWb,n.redoStack.length>0)};return n.on("stack-item-added",t),n.on("stack-item-popped",t),n.on("stack-cleared",t),()=>{n.off("stack-item-added",t),n.off("stack-item-popped",t),n.off("stack-cleared",t)}}),[e,n])}(e,m),function(e,t,n,o,i){(0,s.useEffect)((()=>(0,pt.Sd)(e.registerCommand(le.$7r,(()=>(ft(t,n,o,!0,i||{}),!1)),le.jZM),e.registerCommand(le.I2H,(()=>(ft(t,n,o,!1,i||{}),!1)),le.jZM))),[o,e,n,t,i])}(e,n,r,l,u),g}function xt({awarenessData:e,cursorColor:t,cursorsContainerRef:n,excludedProperties:o,id:i,initialEditorState:r,name:l,providersFactory:a,shouldBootstrap:c}){const d=function(e,t){const n=(0,s.useContext)(Re);return null!=e&&(n.collaboratorName=e),null!=t&&(n.color=t),n}(l,t),{docsMap:u,notebooksMap:f,collaboratorName:m,color:h}=d,p=(0,s.useRef)(!1),g=(0,s.useRef)(!1),[x]=(0,k.DF)(),[y,b]=(0,s.useState)(),[_,v]=(0,s.useState)(),[j,C]=(0,s.useState)(u.get(i)),[N,S]=(0,s.useState)(f.get(i)),[w,E]=(0,s.useState)();return(0,s.useEffect)((()=>(d.isCollaborationActive=!0,()=>{null===x._parentEditor&&(d.isCollaborationActive=!1)})),[d,x]),(0,s.useEffect)((()=>{if(g.current)return;g.current=!0;const e=a(i,u,f).then((e=>{const t=e[0],n=e[1];return b(t),v(n),[t,n]}));return()=>{e.then((e=>{e[0].disconnect(),e[1].disconnect()}))}}),[i,a,u]),(0,s.useEffect)((()=>{if(!y||!_)return;if(p.current)return;p.current=!0;const e=function(e,t,n,s,o,i,r){re(null!=n,"createBinding: doc is null or undefined"),re(null!=o,"createBinding: notebook is null or undefined");const l=Le(n.get("root",ie.ZQ),null,"root");return l._key="root",{clientID:n.clientID,collabNodes:new Map,cursors:new Map,cursorsContainer:null,doc:n,docsMap:s,editor:e,excludedProperties:r||new Map,id:t,nodeProperties:new Map,notebook:o,notebooksMap:i,root:l}}(x,i,j||u.get(i),u,N||f.get(i),f,o);return E(e),()=>{e.root.destroy(e)}}),[x,y,_,i,u,f,j,o]),y&&_&&w?(0,mt.jsx)(gt,{awarenessData:e,binding:w,collaborationContext:d,color:h,cursorsContainerRef:n,docsMap:u,editor:x,id:i,initialEditorState:r,name:m,lexicalProvider:y,notebookProvider:_,setDoc:C,setNotebook:S,shouldBootstrap:c}):(0,mt.jsx)(mt.Fragment,{})}var yt=n(14537),bt=n(75987);async function _t({url:e,token:t}){const n={Accept:"application/json"};t&&(n.Authorization=`Bearer ${t}`);const s=await fetch(e,{method:"GET",headers:n,credentials:t?"include":"omit",mode:"cors",cache:"no-store"});if(s.ok){const t=(await s.json()).sessionId;return console.log("Session ID retrieved for WebSocket URL",e.replace(/^http/,"ws")+"?sessionId="+t),t}throw console.error("Failed to fetch session ID.",s),new Error("Failed to fetch session ID.")}const vt=[["Arabian","#7d0000"],["Appaloosa","#640000"],["Friesian","#990000"],["Thoroughbred","#bf0000"],["Warmblood","#bf4000"],["Saddlebred","#004000"],["Mustang","#007f00"],["Trakehner","#407f00"],["Quarter Horse","#7f7f00"],["Clydesdale","#000099"],["Paint","#0000bf"],["Icelandic","#0000ff"],["Andalusian","#004040"],["Tennessee Walker","#404040"],["Ukrainian Riding Horse","#7f0040"],["Percheron","#bf0040"]];var jt=n(94410);const kt=function(){const e=[];for(const[t,n]of Object.entries(W.mF))e.push([t,n]);return e}(),Ct=new Set(["paragraph","quote","code","h1","h2","ul","ol"]),Nt={code:"Code Block",h1:"Large Heading",h2:"Small Heading",h3:"Heading",h4:"Heading",h5:"Heading",ol:"Numbered List",paragraph:"Normal",quote:"Quote",ul:"Bulleted List"};function St(){return(0,mt.jsx)("div",{className:"divider"})}function wt(e,t){null===t?(e.style.opacity="0",e.style.top="-1000px",e.style.left="-1000px"):(e.style.opacity="1",e.style.top=`${t.top+t.height+window.pageYOffset+10}px`,e.style.left=t.left+window.pageXOffset-e.offsetWidth/2+t.width/2+"px")}function Et({editor:e}){const t=(0,s.useRef)(null),n=(0,s.useRef)(null),o=(0,s.useRef)(!1),[i,r]=(0,s.useState)(""),[l,a]=(0,s.useState)(!1),[c,d]=(0,s.useState)(null),u=(0,s.useCallback)((()=>{const n=(0,le.vJq)();if((0,le.I2P)(n)){const e=At(n),t=e.getParent();(0,_.FJ)(t)?r(t.getURL()):(0,_.FJ)(e)?r(e.getURL()):r("")}const s=t.current,i=window.getSelection(),l=document.activeElement;if(null===s)return;const c=e.getRootElement();if(null!==n&&!i?.isCollapsed&&null!==c&&c.contains(i?.anchorNode)){const e=i?.getRangeAt(0);let t;if(i?.anchorNode===c){let e=c;for(;null!=e.firstElementChild;)e=e.firstElementChild;t=e.getBoundingClientRect()}else t=e?.getBoundingClientRect();o.current||wt(s,t),d(n)}else l&&"link-input"===l.className||(wt(s,null),d(null),a(!1),r(""));return!0}),[e]);return(0,s.useEffect)((()=>(0,pt.Sd)(e.registerUpdateListener((({editorState:e})=>{e.read((()=>{u()}))})),e.registerCommand(le.MvL,(()=>(u(),!0)),1))),[e,u]),(0,s.useEffect)((()=>{e.getEditorState().read((()=>{u()}))}),[e,u]),(0,s.useEffect)((()=>{l&&n.current&&n.current.focus()}),[l]),(0,mt.jsx)("div",{ref:t,className:"link-editor",children:l?(0,mt.jsx)("input",{ref:n,className:"link-input",value:i,onChange:e=>{r(e.target.value)},onKeyDown:t=>{"Enter"===t.key?(t.preventDefault(),null!==c&&(""!==i&&e.dispatchCommand(_.yW,i),a(!1))):"Escape"===t.key&&(t.preventDefault(),a(!1))}}):(0,mt.jsx)(mt.Fragment,{children:(0,mt.jsxs)("div",{className:"link-input",children:[(0,mt.jsx)("a",{href:i,target:"_blank",rel:"noopener noreferrer",children:i}),(0,mt.jsx)("div",{className:"link-edit",role:"button",tabIndex:0,onMouseDown:e=>e.preventDefault(),onClick:()=>{a(!0)}})]})})})}function At(e){const t=e.anchor,n=e.focus,s=e.anchor.getNode(),o=e.focus.getNode();return s===o?s:e.isBackward()?(0,qe.Nx)(n)?s:o:(0,qe.Nx)(t)?o:s}function Tt({editor:e,blockType:t,toolbarRef:n,setShowBlockOptionsDropDown:o}){const i=(0,s.useRef)(null);return(0,s.useEffect)((()=>{const e=n.current,t=i.current;if(null!==e&&null!==t){const{top:n,left:s}=e.getBoundingClientRect();t.style.top=`${n+40}px`,t.style.left=`${s}px`}}),[i,n]),(0,s.useEffect)((()=>{const e=i.current,t=n.current;if(null!==e&&null!==t){const n=n=>{const s=n.target;e.contains(s)||t.contains(s)||o(!1)};return document.addEventListener("click",n),()=>{document.removeEventListener("click",n)}}}),[i,o,n]),(0,mt.jsxs)("div",{className:"dropdown",ref:i,children:[(0,mt.jsxs)("button",{className:"item",onClick:()=>{"jupyter-output"!==t&&e.update((()=>{const t=(0,le.vJq)(),n=t?.getTextContent()||"";e.dispatchCommand(U.JO,{code:n,outputs:n?[]:H.Cc})})),o(!1)},children:[(0,mt.jsx)("span",{className:"icon code"}),(0,mt.jsx)("span",{className:"text",children:"Jupyter Cell"}),"jupyter"===t&&(0,mt.jsx)("span",{className:"active"})]}),(0,mt.jsxs)("button",{className:"item",onClick:()=>{"paragraph"!==t&&e.update((()=>{const e=(0,le.vJq)();(0,le.I2P)(e)&&(0,qe.AH)(e,(()=>(0,le.lJ7)()))})),o(!1)},children:[(0,mt.jsx)("span",{className:"icon paragraph"}),(0,mt.jsx)("span",{className:"text",children:"Normal"}),"paragraph"===t&&(0,mt.jsx)("span",{className:"active"})]}),(0,mt.jsxs)("button",{className:"item",onClick:()=>{"h1"!==t&&e.update((()=>{const e=(0,le.vJq)();(0,le.I2P)(e)&&(0,qe.AH)(e,(()=>(0,x.fi)("h1")))})),o(!1)},children:[(0,mt.jsx)("span",{className:"icon large-heading"}),(0,mt.jsx)("span",{className:"text",children:"Large Heading"}),"h1"===t&&(0,mt.jsx)("span",{className:"active"})]}),(0,mt.jsxs)("button",{className:"item",onClick:()=>{"h2"!==t&&e.update((()=>{const e=(0,le.vJq)();(0,le.I2P)(e)&&(0,qe.AH)(e,(()=>(0,x.fi)("h2")))})),o(!1)},children:[(0,mt.jsx)("span",{className:"icon small-heading"}),(0,mt.jsx)("span",{className:"text",children:"Small Heading"}),"h2"===t&&(0,mt.jsx)("span",{className:"active"})]}),(0,mt.jsxs)("button",{className:"item",onClick:()=>{"ul"!==t?e.dispatchCommand(b.q7):e.dispatchCommand(b.uS),o(!1)},children:[(0,mt.jsx)("span",{className:"icon bullet-list"}),(0,mt.jsx)("span",{className:"text",children:"Bullet List"}),"ul"===t&&(0,mt.jsx)("span",{className:"active"})]}),(0,mt.jsxs)("button",{className:"item",onClick:()=>{"ol"!==t?e.dispatchCommand(b.x):e.dispatchCommand(b.uS),o(!1)},children:[(0,mt.jsx)("span",{className:"icon numbered-list"}),(0,mt.jsx)("span",{className:"text",children:"Numbered List"}),"ol"===t&&(0,mt.jsx)("span",{className:"active"})]}),(0,mt.jsxs)("button",{className:"item",onClick:()=>{"quote"!==t&&e.update((()=>{const e=(0,le.vJq)();(0,le.I2P)(e)&&(0,qe.AH)(e,(()=>(0,x.xi)()))})),o(!1)},children:[(0,mt.jsx)("span",{className:"icon quote"}),(0,mt.jsx)("span",{className:"text",children:"Quote"}),"quote"===t&&(0,mt.jsx)("span",{className:"active"})]}),(0,mt.jsxs)("button",{className:"item",onClick:()=>{"youtube"!==t&&e.update((()=>{const e=(0,le.vJq)();if((0,le.I2P)(e)){const t=e.getTextContent().split("v=");e.removeText(),(0,pt.Pe)((0,q.YJ)(t[t.length-1]))}})),o(!1)},children:[(0,mt.jsx)("i",{className:"icon youtube"}),(0,mt.jsx)("span",{className:"text",children:"YouTube Video"}),"youtube"===t&&(0,mt.jsx)("span",{className:"active"})]}),(0,mt.jsxs)("button",{className:"item",onClick:()=>{"equation"!==t&&e.update((()=>{const t=(0,le.vJq)();if((0,le.I2P)(t)){const n=t.getTextContent().replaceAll("$","");t.removeText(),e.dispatchCommand(Q.x,{equation:n,inline:!0})}})),o(!1)},children:[(0,mt.jsx)("i",{className:"icon equation"}),(0,mt.jsx)("span",{className:"text",children:"Equation"}),"equation"===t&&(0,mt.jsx)("span",{className:"active"})]})]})}function Pt(){const[e]=(0,k.DF)(),[t,n]=(0,s.useState)(e),o=(0,s.useRef)(null),[i,r]=(0,s.useState)(!1),[l,a]=(0,s.useState)(!1),[c,d]=(0,s.useState)("paragraph"),[u,f]=(0,s.useState)(null),[m,h]=(0,s.useState)(!1),[p,g]=(0,s.useState)(""),[y,v]=(0,s.useState)(!1),[j,C]=(0,s.useState)(!1),[N,S]=(0,s.useState)(!1),[w,E]=(0,s.useState)(!1),[A,T]=(0,s.useState)(!1),[P,F]=(0,s.useState)(!1),[L,D]=(0,s.useState)(!1),I=(0,s.useCallback)((()=>{const t=(0,le.vJq)();if((0,le.I2P)(t)){const n=t.anchor.getNode(),s="root"===n.getKey()?n:n.getTopLevelElementOrThrow(),o=s.getKey();if(null!==e.getElementByKey(o))if(f(o),(0,b.HY)(s)){const e=(0,pt.eu)(n,b.v5),t=e?e.getTag():s.getTag();d(t)}else{const e=(0,x.Pi)(s)?s.getTag():s.getType();d(e),(0,M.x_)(s)&&g(s.getLanguage()||(0,W.z8)())}S(t.hasFormat("bold")),E(t.hasFormat("italic")),T(t.hasFormat("underline")),F(t.hasFormat("strikethrough")),D(t.hasFormat("code")),v((0,qe.LP)(t));const i=At(t),r=i.getParent();(0,_.FJ)(r)||(0,_.FJ)(i)?C(!0):C(!1)}}),[e]);(0,s.useEffect)((()=>(0,pt.Sd)(e.registerUpdateListener((({editorState:e})=>{e.read((()=>{I()}))})),e.registerCommand(le.MvL,((e,t)=>(I(),!1)),1),e.registerCommand(le.KfJ,(e=>(r(e),!1)),1),e.registerCommand(le.WWb,(e=>(a(e),!1)),1))),[e,I]);const O=(0,s.useCallback)((e=>{t.update((()=>{if(null!==u){const t=(0,le.nsf)(u);(0,M.x_)(t)&&t.setLanguage(e)}}))}),[t,u]),R=(0,s.useCallback)((()=>{j?e.dispatchCommand(_.yW,null):e.dispatchCommand(_.yW,"https://")}),[e,j]);return(0,mt.jsxs)("div",{className:"toolbar",ref:o,children:[(0,mt.jsx)("button",{disabled:!i,onClick:()=>{e.dispatchCommand(le.ZKf,void 0)},className:"toolbar-item spaced","aria-label":"Undo",children:(0,mt.jsx)("i",{className:"format undo"})}),(0,mt.jsx)("button",{disabled:!l,onClick:()=>{e.dispatchCommand(le.V30,void 0)},className:"toolbar-item","aria-label":"Redo",children:(0,mt.jsx)("i",{className:"format redo"})}),(0,mt.jsx)(St,{}),Ct.has(c)&&(0,mt.jsxs)(mt.Fragment,{children:[(0,mt.jsxs)("button",{className:"toolbar-item block-controls",onClick:()=>h(!m),"aria-label":"Formatting Options",children:[(0,mt.jsx)("span",{className:"icon block-type "+c}),(0,mt.jsx)("span",{className:"text",children:Nt[c]}),(0,mt.jsx)("i",{className:"chevron-down"})]}),m&&(0,ze.createPortal)((0,mt.jsx)(Tt,{editor:e,blockType:c,toolbarRef:o,setShowBlockOptionsDropDown:h}),document.body),(0,mt.jsx)(St,{})]}),"jupyter-code"===c?(0,mt.jsx)(mt.Fragment,{children:(0,mt.jsx)(jt.Ck,{buttonClassName:"toolbar-item code-language",buttonLabel:(0,W.$D)(p),buttonAriaLabel:"Select language",children:kt.map((([e,t])=>{return(0,mt.jsx)(jt.Ho,{className:"item "+(n=e===p,n?"active dropdown-item-active":""),onClick:()=>O(e),children:(0,mt.jsx)("span",{className:"text",children:t})},e);var n}))})}):(0,mt.jsxs)(mt.Fragment,{children:[(0,mt.jsx)("button",{onClick:()=>{e.dispatchCommand(le.mB,"bold")},className:"toolbar-item spaced "+(N?"active":""),"aria-label":"Format Bold",children:(0,mt.jsx)("i",{className:"format bold"})}),(0,mt.jsx)("button",{onClick:()=>{e.dispatchCommand(le.mB,"italic")},className:"toolbar-item spaced "+(w?"active":""),"aria-label":"Format Italics",children:(0,mt.jsx)("i",{className:"format italic"})}),(0,mt.jsx)("button",{onClick:()=>{e.dispatchCommand(le.mB,"underline")},className:"toolbar-item spaced "+(A?"active":""),"aria-label":"Format Underline",children:(0,mt.jsx)("i",{className:"format underline"})}),(0,mt.jsx)("button",{onClick:()=>{e.dispatchCommand(le.mB,"strikethrough")},className:"toolbar-item spaced "+(P?"active":""),"aria-label":"Format Strikethrough",children:(0,mt.jsx)("i",{className:"format strikethrough"})}),(0,mt.jsx)("button",{onClick:()=>{e.dispatchCommand(le.mB,"code")},className:"toolbar-item spaced "+(L?"active":""),"aria-label":"Insert Code",children:(0,mt.jsx)("i",{className:"format code"})}),(0,mt.jsx)("button",{onClick:R,className:"toolbar-item spaced "+(j?"active":""),"aria-label":"Insert Link",children:(0,mt.jsx)("i",{className:"format link"})}),j&&(0,ze.createPortal)((0,mt.jsx)(Et,{editor:e}),document.body),(0,mt.jsx)(St,{}),(0,mt.jsx)("button",{onClick:()=>{e.dispatchCommand(le.fUS,"left")},className:"toolbar-item spaced","aria-label":"Left Align",children:(0,mt.jsx)("i",{className:"format left-align"})}),(0,mt.jsx)("button",{onClick:()=>{e.dispatchCommand(le.fUS,"center")},className:"toolbar-item spaced","aria-label":"Center Align",children:(0,mt.jsx)("i",{className:"format center-align"})}),(0,mt.jsx)("button",{onClick:()=>{e.dispatchCommand(le.fUS,"right")},className:"toolbar-item spaced","aria-label":"Right Align",children:(0,mt.jsx)("i",{className:"format right-align"})}),(0,mt.jsx)("button",{onClick:()=>{e.dispatchCommand(le.fUS,"justify")},className:"toolbar-item","aria-label":"Justify Align",children:(0,mt.jsx)("i",{className:"format justify-align"})}),(0,mt.jsx)(St,{}),(0,mt.jsx)("button",{onClick:()=>{e.dispatchCommand(dt,!0)},className:"toolbar-item","aria-label":"Prompt AI Agent",children:(0,mt.jsx)("i",{className:"format sparkle",children:"*"})})," "]})]})}var Ft=n(320),Lt=n(44536);function Dt(){return(0,mt.jsx)("div",{className:"editor-placeholder",children:"Welcome to the Datalayer editor to code and analyse data with AI."})}const It={namespace:"Datalayer Literate Editor",theme:O.$,onError(e){throw e},nodes:[_.k_,v.iK,R.HS,P.ZZ,x.jL,D.fS,z.K1,M.ZD,J.NH,B._F,W.LX,_.Db,b.YW,b.v5,j.y6,x.dJ,y.B9,y.HA,y.py,q.K$]},Ot=()=>{const{setEditor:e}=(0,g.uw)(),[t]=(0,k.DF)();return(0,s.useEffect)((()=>(e(t),()=>e(void 0))),[t]),null},Rt=e=>{const{id:t}=e,{configuration:n}=(0,Ft._O)(),{token:o}=(0,Lt.Y)(),[i,r]=(0,s.useState)(null),[l,a]=(0,s.useState)(null),[c,d]=(0,s.useState)((()=>function(){const e=vt[Math.floor(Math.random()*vt.length)];return{color:e[1],name:e[0]}}())),[u,f]=(0,s.useState)(!1),[m,h]=(0,s.useState)([]),p=(0,s.useRef)(null),g=(0,s.useCallback)((()=>{const e=l.awareness;h(Array.from(e.getStates().entries()).map((([e,{color:t,name:n}])=>({color:t,name:n,userId:e}))))}),[l]);(0,s.useEffect)((()=>{if(null!==l)return l.awareness.on("update",g),()=>l.awareness.off("update",g)}),[l,g]);const x=(0,s.useCallback)((async(e,t,s)=>{const i=await async function(e,t,n,s){const o="doc_memory",i=`${e}/api/spacer/v1/rooms`,r=function(e,t){let n=t.get(e);return void 0===n?(n=new ie.JA,t.set(e,n)):n.load(),n}(t,n);return await _t({url:i.replace(/^ws/,"http")+`/${t}?type=${o}`,token:s}).then((e=>new yt.$R(i,t,r,{disableBc:!0,connect:!1,params:{sessionId:e,token:s,type:o}})))}(n.spacerRunUrl,e,t,o),r=await async function(e,t,n,s){const o="notebook_memory",i=`${e}/api/spacer/v1/rooms`,r=function(e,t){let n=t.get(e);return void 0===n?(n=bt.Xn.create(),t.set(e,n)):n.ydoc.load(),n}(t,n);return await _t({url:i.replace(/^ws/,"http")+`/${t}?type=${o}`,token:s}).then((e=>new yt.$R(i,t,r.ydoc,{disableBc:!0,connect:!1,params:{sessionId:e,token:s,type:o}})))}(n.spacerRunUrl,e,s,o);return i.on("status",(e=>{f("connected"===e.status||"connected"in e&&!0===e.connected)})),setTimeout((()=>a(i)),0),[i,r]}),[]);return(0,mt.jsx)(C.n,{initialConfig:It,children:(0,mt.jsx)("div",{className:"editor-shell",children:(0,mt.jsxs)("div",{className:"editor-container",children:[(0,mt.jsx)(Pt,{}),(0,mt.jsxs)("div",{className:"editor-inner",children:[(0,mt.jsx)(N.$,{contentEditable:(0,mt.jsx)("div",{className:"editor-scroller",children:(0,mt.jsx)("div",{className:"editor",ref:e=>{null!==e&&r(e)},children:(0,mt.jsx)(S.a,{})})}),placeholder:(0,mt.jsx)(Dt,{}),ErrorBoundary:I.R}),(0,mt.jsx)(F.D,{onChange:function(e){}}),(0,mt.jsx)(xt,{id:t,providersFactory:x,shouldBootstrap:!1,name:c.name,cursorColor:c.color,cursorsContainerRef:p}),(0,mt.jsx)(w.x,{}),(0,mt.jsx)(E.A,{}),(0,mt.jsx)(T.Q,{}),(0,mt.jsx)(L.A,{}),(0,mt.jsx)(U.hM,{}),(0,mt.jsx)(A.W,{}),(0,mt.jsx)(Y.p,{}),(0,mt.jsx)($.i,{maxDepth:7}),(0,mt.jsx)(K.L,{}),(0,mt.jsx)(H._4,{}),(0,mt.jsx)(Z.u,{}),(0,mt.jsx)(Q.fo,{}),(0,mt.jsx)(G.GO,{}),(0,mt.jsx)(V.C,{}),(0,mt.jsx)(X.LX,{}),(0,mt.jsx)(ee.EZ,{}),(0,mt.jsx)(Ot,{}),(0,mt.jsx)(te.jR,{providerFactory:void 0}),i&&(0,mt.jsxs)(mt.Fragment,{children:[(0,mt.jsx)(ne.q,{anchorElem:i}),(0,mt.jsx)(se.U,{anchorElem:i}),(0,mt.jsx)(oe.x,{anchorElem:i})]})]})]})})})};var zt=n(17810),Mt=n(54087),Jt=n(97734),Bt=n(23530),Wt=n(27199),qt=n(41046);const Ut=()=>(0,mt.jsx)(l.A,{display:"flex",children:(0,mt.jsx)(l.A,{children:(0,mt.jsx)(a.Q,{variant:"invisible",size:"small",leadingVisual:p.iKr,onClick:()=>qt.xK.getState().save(new Date),children:"Save"})})}),Yt=()=>{const{documentId:e}=(0,o.g)();if(!e)return(0,mt.jsx)(mt.Fragment,{});const t=(0,zt.J)(),{hideBackdrop:n,setItem:x,showBackdrop:y,space:b,triggerItemsRefresh:_}=(0,Wt.l5)(),{documentSaveRequest:v}=(0,qt.q3)(),{editor:j}=(0,g.uw)(),{cloneDocument:k,deleteItem:C,getDocument:N,refreshDocument:S,updateDocument:w,updateDocumentModel:E}=(0,Mt.E)(),{enqueueToast:A}=(0,Jt.d)(),T=(0,Bt.Z)(),P=(0,i.S)(),[F,L]=(0,s.useState)("none"),[D,I]=(0,s.useState)(),[O,R]=(0,s.useState)({name:"",nameConfirm:"",description:""}),[z,M]=(0,s.useState)({name:void 0,nameConfirm:void 0,description:void 0});(0,s.useEffect)((()=>{if(j&&D&&D.model){const e=j.parseEditorState(D.model);j.setEditorState(e),j.focus((()=>{}),{defaultSelection:"rootStart"})}}),[e,D,j]),(0,s.useEffect)((()=>("properties"!==F&&(y(),S(e).then((t=>{if(t.success){const t=N(e);t?(I(t),x(t),R({name:t.name,nameConfirm:"",description:t.description})):T("/")}})).finally((()=>{n()}))),()=>{I(void 0),x(void 0)})),[e]),(0,s.useEffect)((()=>{v&&D&&j&&D&&(I({...D,model:j.getEditorState().toJSON()}),y("Saving the document..."),E(e,j.getEditorState().toJSON()).then((e=>{e.success&&A("The document is successfully updated.",{variant:"success"})})).finally((()=>{n()})))}),[v]),(0,s.useEffect)((()=>{M({...z,name:void 0===O.name?void 0:O.name.length>2,nameConfirm:O.nameConfirm===D?.name,description:void 0===O.description?void 0:O.description.length>2})}),[O]);const J=(0,s.useCallback)((async s=>{P({title:"Are you sure?",content:"Please confirm you want to clone this document in your private library."}).then((s=>{s&&(y(),k(e).then((e=>{n(),e.success&&(A(e.message,{variant:"success"}),_(),T(`/${t.handle}/library/documents`))})).finally((()=>{n()})))}))}),[P,D]);return(0,mt.jsxs)(mt.Fragment,{children:[(0,mt.jsxs)(r.z,{"aria-label":"Document Editor",children:[(0,mt.jsx)(r.z.TitleArea,{variant:"subtitle",children:(0,mt.jsx)(r.z.Title,{children:"Document Editor"})}),(0,mt.jsxs)(r.z.Actions,{children:[D&&(0,mt.jsx)(l.A,{children:(0,mt.jsx)(Ut,{})}),D&&b&&(0,mt.jsx)(l.A,{ml:3,children:(0,mt.jsx)(a.Q,{variant:"invisible",size:"small",leadingVisual:p.Nc$,onClick:J,children:"Clone"})}),(0,mt.jsx)(a.Q,{variant:"invisible",size:"small",leadingVisual:p.L64,onClick:e=>{L("properties"===F?"none":"properties")},children:"Properties"},"properties")]})]}),(0,mt.jsxs)(c.O7,{children:[D&&"properties"===F&&(0,mt.jsx)(c.O7.Pane,{"aria-label":"Document Properties",position:"start",children:(0,mt.jsx)(mt.Fragment,{children:(0,mt.jsx)(l.A,{display:"grid",gridTemplateColumns:"1fr 1fr",children:(0,mt.jsxs)(l.A,{children:[(0,mt.jsxs)(l.A,{sx:{label:{marginTop:2}},children:[(0,mt.jsxs)(d.A,{children:[(0,mt.jsx)(d.A.Label,{children:"Name"}),(0,mt.jsx)(u.A,{block:!0,value:O.name,onChange:e=>{R((t=>({...t,name:e.target.value})))}}),!1===z.name&&(0,mt.jsx)(d.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,mt.jsxs)(d.A,{children:[(0,mt.jsx)(d.A.Label,{children:"Description"}),(0,mt.jsx)(f.Ay,{block:!0,value:O.description,onChange:e=>{R((t=>({...t,description:e.target.value})))}}),!1===z.description&&(0,mt.jsx)(d.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,mt.jsx)(d.A,{children:(0,mt.jsx)(a.Q,{variant:"primary",disabled:!z.name||!z.description,sx:{marginTop:2},onClick:async()=>{y(),w(e,O.name,O.description).then((e=>{e.success&&(A("The document is successfully updated.",{variant:"success"}),_(),I({...D,name:O.name,description:O.description}))})).finally((()=>{n()}))},children:"Update Document Properties"})})]}),(0,mt.jsxs)(l.A,{sx:{marginTop:3},children:[(0,mt.jsx)(m.A,{as:"h2",sx:{fontSize:4,fontWeight:"normal",color:"danger.fg",mb:2},children:"Danger zone"}),(0,mt.jsxs)(l.A,{sx:{border:"1px solid",borderColor:"danger.emphasis",borderRadius:2,p:3,alignItems:"center",justifyContent:"space-between",gap:3},children:[(0,mt.jsxs)(l.A,{sx:{display:"grid",gap:1},children:[(0,mt.jsx)(h.A,{sx:{fontSize:1,fontWeight:"bold",color:"danger.fg"},children:"Confirm the notebook name to delete"}),(0,mt.jsx)(d.A,{children:(0,mt.jsx)(u.A,{block:!0,value:O.nameConfirm,onChange:e=>{R((t=>({...t,nameConfirm:e.target.value})))}})}),(0,mt.jsx)(h.A,{sx:{fontSize:1,color:"fg.muted"},children:"This operation is not reversible."})]}),(0,mt.jsx)(a.Q,{variant:"danger",disabled:!z.nameConfirm,onClick:async()=>{y("Deleting the document..."),C(D.id).then((e=>{e.success&&(A("The document is successfully deleted.",{variant:"success"}),T("/my-library"))})).finally((()=>{n()}))},children:"Delete document"})]})]})]})})})}),(0,mt.jsx)(c.O7.Content,{"aria-label":"Document Editor",width:"full",padding:"none",children:D&&D.model&&(0,mt.jsx)(l.A,{style:{display:"block",marginLeft:"auto",marginRight:"auto",width:"80%"},children:(0,mt.jsx)(Rt,{id:e})})})]})]})},$t=Yt},64991:(e,t,n)=>{n.d(t,{w:()=>r});var s=n(49370),o=n(320),i=n(63711);const r=(e="api/ai-agents/v1")=>{const{configuration:t}=(0,o._O)(),{requestRun:n}=(0,s.X)({notifyOnError:!1});return{createAIAgent:(s,o,r,l,a,{signal:c,baseUrl:d=e}={})=>n({url:i.URLExt.join(t.aiagentsRunUrl,d,"agents"),method:"POST",body:{room_id:s,room_type:o,runtime:{ingress:r,token:l,kernel_id:a}},signal:c}),getAIAgents:({signal:s,baseUrl:o=e}={})=>n({url:i.URLExt.join(t.aiagentsRunUrl,o,"agents"),method:"GET",signal:s}),deleteAIAgent:(s,{signal:o,baseUrl:r=e}={})=>n({url:i.URLExt.join(t.aiagentsRunUrl,r,"agents",s),method:"DELETE",signal:o}),getAIAgent:(s,{signal:o,baseUrl:r=e}={})=>n({url:i.URLExt.join(t.aiagentsRunUrl,r,"agents",s),method:"GET",signal:o}),patchAIAgent:(s,o,r,l,{signal:a,baseUrl:c=e}={})=>n({url:i.URLExt.join(t.aiagentsRunUrl,c,"agents",s),method:"PATCH",body:{runtime:o&&r&&l?{ingress:o,token:r,kernel_id:l}:null},signal:a})}}},81390:(e,t,n)=>{n.d(t,{Ks:()=>r});var s=n(97283),o=n(7282);const i=(0,s.y)((e=>({aiAgents:[],addAIAgent:t=>{e((e=>e.aiAgents.includes(t)?{}:{aiAgents:e.aiAgents.concat([t])}))},deleteAIAgent:t=>{e((e=>({aiAgents:e.aiAgents.filter((e=>e.documentId===t))})))},updateAIAgent:(t,n)=>{e((e=>{const s=e.aiAgents.findIndex((e=>e.documentId===t));return s>=0?(e.aiAgents[s].runtimeId=n,{aiAgents:[...e.aiAgents]}):{}}))}})));function r(e){return(0,o.Pj)(i,e)}}}]);